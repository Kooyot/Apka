<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<meta name="theme-color" content="#ff6b2b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>DIET MASTER V7 ‚Äî ULTRA</title>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js" defer></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Outfit:wght@300;400;500;600;700;800;900&display=swap');
:root{
--bg:#06090f;--bg2:#0c1018;--bg3:#131a28;--bg4:#1a2336;--bg5:#243048;
--or:#ff6b2b;--or2:#ff8f5e;--or-g:rgba(255,107,43,.1);
--gr:#34d399;--gr-g:rgba(52,211,153,.1);
--rd:#f87171;--rd-g:rgba(248,113,113,.1);
--bl:#60a5fa;--bl-g:rgba(96,165,250,.1);
--pr:#a78bfa;--pr-g:rgba(167,139,250,.1);
--cy:#22d3ee;--cy-g:rgba(34,211,238,.1);
--yl:#fbbf24;--yl-g:rgba(251,191,36,.1);
--t1:#f0f2f5;--t2:#94a3b8;--t3:#475569;
--brd:rgba(255,255,255,.06);--brd2:rgba(255,107,43,.25);
--rad:16px;--rad2:12px;--rad3:8px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--t1);line-height:1.6;min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg2)}::-webkit-scrollbar-thumb{background:var(--bg5);border-radius:2px}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(12,16,24,.92);border-bottom:1px solid var(--brd2);display:flex;align-items:center;padding:0 14px;z-index:100;gap:10px;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
.hbtn{width:40px;height:40px;border-radius:var(--rad3);border:none;background:var(--or);color:#fff;font-size:1.2em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;flex-shrink:0}
.hbtn:active{transform:scale(.9)}.hbtn.x{background:var(--rd)}
.htitle{flex:1;overflow:hidden}.htitle h1{font-family:'JetBrains Mono',monospace;font-size:.85em;color:var(--or);white-space:nowrap;letter-spacing:-.02em}.htitle span{font-size:.65em;color:var(--t3);font-family:'JetBrains Mono',monospace}
.hbadge{background:var(--bg3);border:1px solid var(--brd);padding:3px 8px;border-radius:16px;font-family:'JetBrains Mono',monospace;font-size:.7em;color:var(--t2);white-space:nowrap}
.hbadge b{color:var(--or)}

/* NAV */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:98;opacity:0;pointer-events:none;transition:.3s}.overlay.on{opacity:1;pointer-events:auto}
nav{position:fixed;top:56px;left:0;width:260px;height:calc(100vh - 56px);background:var(--bg2);border-right:1px solid var(--brd);z-index:99;transform:translateX(-100%);transition:.3s;overflow-y:auto;padding:10px}
nav.on{transform:translateX(0)}
.nlbl{font-size:.58em;color:var(--t3);text-transform:uppercase;letter-spacing:.15em;margin:12px 0 5px 10px;font-weight:700}
.nbtn{display:block;width:100%;padding:10px 12px;background:transparent;border:1px solid transparent;border-radius:var(--rad3);color:var(--t2);font-size:.85em;font-weight:600;text-align:left;cursor:pointer;transition:.2s;margin-bottom:2px;font-family:'Outfit',sans-serif}
.nbtn:hover{background:var(--or-g);border-color:var(--brd2);color:var(--t1)}
.nbtn.on{background:linear-gradient(135deg,var(--or),var(--or2));color:#fff;border-color:transparent}
.nbtn span{margin-right:6px}

/* MAIN */
main{padding:72px 14px 40px;max-width:880px;margin:0 auto}
.sec{display:none;animation:secIn .35s cubic-bezier(.22,.61,.36,1)}.sec.on{display:block}
@keyframes secIn{0%{opacity:0;transform:translateY(16px) scale(.98)}100%{opacity:1;transform:translateY(0) scale(1)}}

/* NAV ICONS */
.nbtn .ni{display:inline-flex;width:20px;height:20px;align-items:center;justify-content:center;margin-right:6px;vertical-align:middle}
.nbtn .ni svg{width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.nbtn.on .ni svg{stroke:#fff}

/* CARD HOVER */
.c{background:var(--bg3);border:1px solid var(--brd);border-radius:var(--rad);padding:16px;margin-bottom:14px;transition:border-color .25s,box-shadow .25s}
.c:hover{border-color:var(--brd2);box-shadow:0 4px 24px rgba(255,107,43,.06)}

/* QA RIPPLE */
.qa{position:relative;overflow:hidden}
.qa::after{content:'';position:absolute;inset:0;background:radial-gradient(circle at var(--x,50%) var(--y,50%),rgba(255,107,43,.15) 0%,transparent 60%);opacity:0;transition:opacity .4s}
.qa:active::after{opacity:1}

/* BTN RIPPLE */
.btn{position:relative;overflow:hidden}
.btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,.15);transform:scaleX(0);transform-origin:left;transition:transform .3s}
.btn:active::after{transform:scaleX(1)}

/* SMOOTH MEAL CARD ENTER */
.mc{transition:opacity .2s,transform .2s}

/* PILL PRESS */
.pill{transition:all .15s cubic-bezier(.22,.61,.36,1)}
.pill:active{transform:scale(.92)}

/* PROGRESS RING GLOW */
.pring svg{transition:filter .5s}

/* SHOPPING GENERATOR */
.shopgen{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:14px;margin-top:14px}
.shopgen h3{color:var(--or);font-size:.9em;margin-bottom:10px}
.sg-days{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px}
.sg-day{padding:6px 12px;border:2px solid var(--brd);border-radius:var(--rad3);font-size:.78em;font-weight:600;cursor:pointer;transition:.2s;background:var(--bg3);color:var(--t2)}
.sg-day:hover{border-color:var(--or)}
.sg-day.sel{background:var(--or-g);border-color:var(--or);color:var(--or)}
.sg-result{margin-top:12px}
.sg-item{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--brd);font-size:.82em}
.sg-item:last-child{border-bottom:none}
.sg-item .sg-n{flex:1;color:var(--t1)}.sg-item .sg-a{color:var(--gr);font-weight:600;font-family:'JetBrains Mono',monospace}

/* TOAST UPGRADE */
.toast{backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}

/* MODAL */
.modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;display:none;align-items:center;justify-content:center;padding:16px}
.modal-ov.on{display:flex}
.modal{background:var(--bg2);border:1px solid var(--brd2);border-radius:var(--rad);padding:20px;max-width:400px;width:100%;max-height:80vh;overflow-y:auto;animation:secIn .25s ease}
.modal h3{color:var(--or);margin-bottom:12px;font-size:1em}
.modal .mbody{margin-bottom:14px}
.modal .mbtns{display:flex;gap:8px;flex-wrap:wrap}

/* PANTRY */
.pantry-item{display:grid;grid-template-columns:1fr auto auto;gap:8px;padding:10px;background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad3);margin-bottom:6px;align-items:center;transition:border-color .2s}
.pantry-item:hover{border-color:var(--brd2)}
.pantry-item .pi-name{font-weight:600;font-size:.88em}
.pantry-item .pi-cat{font-size:.65em;color:var(--t3)}
.pantry-item .pi-amt{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--gr);font-size:.9em;text-align:right;white-space:nowrap}
.pantry-item .pi-btns{display:flex;gap:4px}
.pantry-item .pi-btn{width:28px;height:28px;border-radius:var(--rad3);border:1px solid var(--brd);background:var(--bg3);color:var(--t2);font-size:.75em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.15s}
.pantry-item .pi-btn:hover{border-color:var(--or);color:var(--or)}
.pantry-item .pi-btn.del:hover{border-color:var(--rd);color:var(--rd)}
.pantry-item.low{border-color:var(--yl)}
.pantry-item.low .pi-amt{color:var(--yl)}
.pantry-item.empty{border-color:var(--rd);opacity:.5}
.pantry-item.empty .pi-amt{color:var(--rd)}
.pantry-cat-hdr{color:var(--or);font-weight:700;font-size:.82em;margin:12px 0 6px;padding:4px 0;border-bottom:1px solid var(--brd)}
.pantry-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.pantry-warn{background:var(--yl-g);border:1px solid rgba(251,191,36,.3);border-radius:var(--rad3);padding:8px 10px;margin-bottom:6px;font-size:.82em;color:var(--yl)}

/* NAV SMOOTH */
nav{transition:transform .35s cubic-bezier(.22,.61,.36,1)}
.overlay{transition:opacity .35s}
.ch{display:flex;align-items:center;gap:8px;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid var(--brd)}.ch h2{font-size:1em;font-weight:700;color:var(--or);flex:1}.ch .ico{width:32px;height:32px;background:var(--or-g);border-radius:var(--rad3);display:flex;align-items:center;justify-content:center;font-size:1em;flex-shrink:0}

/* GRIDS */
.g2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
@media(max-width:700px){.g2{grid-template-columns:1fr}}
@media(max-width:500px){.g3{grid-template-columns:repeat(2,1fr)}.g4{grid-template-columns:repeat(2,1fr)}}

/* STAT BOXES */
.sb{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:12px 8px;text-align:center}
.sv{font-size:1.5em;font-weight:800;color:var(--or);font-family:'JetBrains Mono',monospace}
.sl{font-size:.6em;color:var(--t3);text-transform:uppercase;margin-top:2px;font-weight:600}
.sb.gr .sv{color:var(--gr)}.sb.bl .sv{color:var(--bl)}.sb.cy .sv{color:var(--cy)}.sb.rd .sv{color:var(--rd)}.sb.yl .sv{color:var(--yl)}.sb.pr .sv{color:var(--pr)}

/* MACRO GRID */
.mg{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.mb{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:10px 4px;text-align:center}
.mb .v{font-size:1.3em;font-weight:800;font-family:'JetBrains Mono',monospace}
.mb .l{font-size:.58em;color:var(--t3);text-transform:uppercase;margin-top:1px}
.mb.kc .v{color:#fca5a5}.mb.pr .v{color:#93c5fd}.mb.ca .v{color:#fde047}.mb.fa .v{color:#c4b5fd}
@media(max-width:500px){.mg{grid-template-columns:repeat(2,1fr)}}

/* BADGES */
.badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:.68em;font-weight:700;font-family:'JetBrains Mono',monospace}
.badge.std{background:var(--bg4);color:var(--t2)}.badge.ref{background:var(--gr-g);color:var(--gr)}.badge.psm{background:var(--rd-g);color:var(--rd)}.badge.org{background:var(--pr-g);color:var(--pr)}

/* PROGRESS RING */
.pring{position:relative;width:160px;height:160px;margin:0 auto}
.pring svg{transform:rotate(-90deg);filter:drop-shadow(0 0 10px rgba(255,107,43,.3))}
.pring circle{fill:none;stroke-width:10;stroke-linecap:round}
.pring .trk{stroke:var(--bg4)}.pring .fil{stroke:url(#og);transition:stroke-dashoffset .8s ease}
.pctr{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.pctr .kg{font-size:2em;font-weight:800;font-family:'JetBrains Mono',monospace}
.pctr .lb{font-size:.75em;color:var(--t3)}
.pctr .tgt{margin-top:3px;padding:2px 8px;background:var(--or);border-radius:10px;font-size:.6em;font-weight:700}

/* WEEK SELECTOR */
.wsel{display:flex;gap:6px;margin-bottom:12px}
.wsel .ws{flex:1;padding:8px;background:var(--bg4);border:2px solid var(--brd);border-radius:var(--rad3);color:var(--t2);font-weight:700;font-size:.8em;cursor:pointer;transition:.2s;text-align:center;font-family:'Outfit',sans-serif}
.wsel .ws:hover{border-color:var(--or)}.wsel .ws.on{background:var(--or);color:#fff;border-color:var(--or)}

/* TABS / DAY SELECTOR */
.tabs{display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap}
.tab{padding:8px 14px;background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad3);color:var(--t2);font-weight:600;font-size:.82em;cursor:pointer;transition:.2s;font-family:'Outfit',sans-serif}
.tab:hover{border-color:var(--or)}.tab.on{background:var(--or);color:#fff;border-color:var(--or)}
.tab.ref{border-color:var(--gr)}.tab.ref.on{background:var(--gr);color:#000}
.tab.psm{border-color:var(--rd)}.tab.psm.on{background:var(--rd)}
.tab.org{border-color:var(--pr)}.tab.org.on{background:var(--pr)}

/* MEAL CARDS */
.mc{background:var(--bg4);border:1px solid var(--brd);border-left:4px solid var(--or);border-radius:var(--rad2);padding:12px;margin-bottom:8px}
.mc.ref{border-left-color:var(--gr)}.mc.psm{border-left-color:var(--rd)}.mc.org{border-left-color:var(--pr)}
.mc .mt{font-size:.72em;color:var(--or2);font-weight:700;font-family:'JetBrains Mono',monospace;margin-bottom:2px}
.mc .mn{font-weight:700;font-size:.92em;margin-bottom:5px}
.mc .mm{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:6px}
.mc .mi{font-size:.8em;color:var(--t2);line-height:1.7}
.mc .mi strong{color:var(--t1)}
.mbdg{display:inline-block;padding:1px 7px;border-radius:10px;font-size:.68em;font-weight:600;font-family:'JetBrains Mono',monospace}
.mbdg.kc{background:rgba(239,68,68,.12);color:#fca5a5}.mbdg.bp{background:rgba(59,130,246,.12);color:#93c5fd}
.mbdg.wg{background:rgba(234,179,8,.12);color:#fde047}.mbdg.tl{background:rgba(168,85,247,.12);color:#c4b5fd}

/* MACRO SUMMARY BAR */
.msbar{background:linear-gradient(135deg,var(--or),var(--or2));border-radius:var(--rad2);padding:12px;margin-top:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center}
.msbar .i .l{font-size:.58em;opacity:.85;text-transform:uppercase}.msbar .i .v{font-size:1.2em;font-weight:800;font-family:'JetBrains Mono',monospace}
@media(max-width:500px){.msbar{grid-template-columns:repeat(2,1fr)}}

/* SHOPPING */
.scat{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:12px;margin-bottom:8px}
.scat .sh{display:flex;align-items:center;gap:8px;font-weight:700;color:var(--or);cursor:pointer;margin-bottom:8px;font-size:.92em}
.scat .sh .arr{margin-left:auto;transition:.2s}.scat .sh.col .arr{transform:rotate(-90deg)}
.sitems{display:block}.sitems.hid{display:none}
.si{display:grid;grid-template-columns:20px 1fr auto auto;gap:8px;padding:6px 0;border-bottom:1px solid var(--brd);font-size:.82em;align-items:center}
.si:last-child{border-bottom:none}
.si.chk{opacity:.3}.si.chk .sn{text-decoration:line-through}
.schk{width:16px;height:16px;border:2px solid var(--brd);border-radius:3px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s}
.schk:hover{border-color:var(--or)}.schk.on{background:var(--gr);border-color:var(--gr)}
.schk.on::after{content:'‚úì';color:#fff;font-size:.6em;font-weight:700}
.sq{color:var(--gr);font-weight:600;text-align:right;font-size:.82em}
.sp{color:var(--t3);font-family:'JetBrains Mono',monospace;min-width:40px;text-align:right;font-size:.82em}
.stot{background:linear-gradient(135deg,var(--or),var(--or2));border-radius:var(--rad2);padding:12px 16px;display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-weight:700}
.stot .v{font-size:1.4em;font-weight:800;font-family:'JetBrains Mono',monospace}

/* SUPP PILLS */
.spblk{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:12px;margin-bottom:8px}
.spblk .hd{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.spblk .tm{background:var(--or-g);padding:2px 8px;border-radius:5px;font-family:'JetBrains Mono',monospace;font-size:.78em;color:var(--or);font-weight:700}
.spblk .lb{color:var(--t2);font-size:.85em}
.pills{display:flex;flex-wrap:wrap;gap:5px}
.pill{padding:4px 10px;background:var(--bg2);border:1px solid var(--brd);border-radius:16px;font-size:.75em;cursor:pointer;transition:.2s}
.pill:hover{border-color:var(--or)}.pill.tk{background:var(--gr-g);border-color:var(--gr);color:var(--gr)}

/* WATER */
.wbot{position:relative;width:100px;height:240px;background:var(--bg4);border:3px solid var(--cy);border-radius:8px 8px 24px 24px;overflow:hidden;margin:0 auto 14px}
.wbot::before{content:'';position:absolute;top:-12px;left:24px;width:50px;height:16px;background:var(--bg4);border:3px solid var(--cy);border-bottom:none;border-radius:4px 4px 0 0}
.wlvl{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(180deg,#22d3ee,#0891b2);transition:.5s}
.wbtns{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:10px}
.wbtn{padding:6px 14px;background:var(--bg4);border:2px solid var(--cy);border-radius:18px;color:var(--cy);font-weight:600;cursor:pointer;transition:.2s;font-size:.82em;font-family:'Outfit',sans-serif}
.wbtn:hover{background:var(--cy);color:var(--bg)}
.wbtn.min{border-color:var(--rd);color:var(--rd)}.wbtn.min:hover{background:var(--rd);color:#fff}

/* CHART */
.chrt{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:12px;height:220px}

/* HISTORY */
.hi{display:flex;align-items:center;padding:7px 0;border-bottom:1px solid var(--brd);font-size:.85em}
.hi:last-child{border-bottom:none}
.hi .dt{flex:1;color:var(--t2)}.hi .wt{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--or);margin-right:8px}
.hi .ch{font-family:'JetBrains Mono',monospace;font-size:.8em;min-width:50px;text-align:right;margin-right:5px}
.hi .ch.dn{color:var(--gr)}.hi .ch.up{color:var(--rd)}
.hi .del{background:none;border:none;color:var(--t3);cursor:pointer;opacity:0;transition:.2s;font-size:.9em}.hi:hover .del{opacity:1}

/* ALERTS */
.al{padding:10px 12px;border-radius:var(--rad2);margin:8px 0;font-size:.85em}
.al.info{background:var(--bl-g);border-left:4px solid var(--bl)}
.al.ok{background:var(--gr-g);border-left:4px solid var(--gr)}
.al.warn{background:var(--yl-g);border-left:4px solid var(--yl)}
.al.err{background:var(--rd-g);border-left:4px solid var(--rd)}
.al.cyn{background:var(--cy-g);border-left:4px solid var(--cy)}

/* BUTTONS */
.btn{padding:8px 16px;background:var(--or);border:none;border-radius:var(--rad3);color:#fff;font-family:'Outfit',sans-serif;font-weight:600;cursor:pointer;transition:.2s;font-size:.85em}
.btn:hover{filter:brightness(1.15)}.btn:active{transform:scale(.97)}
.btn.out{background:transparent;border:1px solid var(--brd);color:var(--t2)}.btn.out:hover{border-color:var(--or);color:var(--t1)}
.btn.sm{padding:5px 10px;font-size:.78em}.btn.gr{background:var(--gr)}.btn.rd{background:var(--rd)}.btn.cy{background:var(--cy);color:var(--bg)}

/* INPUTS */
.ig{margin-bottom:10px}.ig label{display:block;margin-bottom:3px;color:var(--t3);font-size:.78em;font-weight:600}
.ig input,.ig select{width:100%;padding:8px;background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad3);color:var(--t1);font-family:'JetBrains Mono',monospace;font-size:.85em}
.ig input:focus,.ig select:focus{outline:none;border-color:var(--or)}
.fr{display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap}.fr .ig{flex:1;min-width:100px;margin-bottom:0}

/* TOAST */
.toast{position:fixed;bottom:16px;right:16px;padding:8px 14px;background:var(--bg3);border:1px solid var(--brd);border-radius:var(--rad2);box-shadow:0 4px 16px rgba(0,0,0,.5);display:flex;align-items:center;gap:6px;transform:translateY(80px);opacity:0;transition:.3s;z-index:200;font-size:.85em}
.toast.on{transform:translateY(0);opacity:1}.toast.ok{border-left:4px solid var(--gr)}.toast.er{border-left:4px solid var(--rd)}

/* TIMER */
.tdisp{font-family:'JetBrains Mono',monospace;font-size:4em;font-weight:700;color:var(--or);text-shadow:0 0 25px rgba(255,107,43,.35);text-align:center;margin:16px 0}
.tpreset{display:flex;flex-wrap:wrap;justify-content:center;gap:5px;margin-top:14px}
.tpb{padding:6px 12px;background:var(--bg4);border:1px solid var(--brd);border-radius:16px;color:var(--t2);font-size:.78em;cursor:pointer;transition:.2s;font-family:'Outfit',sans-serif}
.tpb:hover{border-color:var(--or);color:var(--t1)}

/* QUICK ACTIONS */
.qa{display:flex;align-items:center;gap:8px;padding:9px 10px;background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);margin-bottom:5px;cursor:pointer;transition:.2s}
.qa:hover{background:var(--bg5);transform:translateX(2px);border-color:var(--brd2)}
.qa .i{font-size:1.1em}.qa .t{flex:1}.qa .tt{font-weight:600;font-size:.88em}.qa .ds{font-size:.68em;color:var(--t3)}.qa .ar{color:var(--t3)}

/* BLOOD RESULTS TABLE */
.brt{width:100%;border-collapse:collapse;font-size:.8em;margin:6px 0}
.brt th,.brt td{padding:7px 6px;text-align:left;border-bottom:1px solid var(--brd)}
.brt th{color:var(--or);font-weight:700;background:var(--bg4);font-size:.85em}
.brt td{color:var(--t2)}
.brt .ok-val{color:var(--gr)}.brt .warn-val{color:var(--yl)}.brt .bad-val{color:var(--rd)}

/* MEAL PREP */
.mp-day{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:12px;margin-bottom:8px}
.mp-day .mp-h{font-weight:700;color:var(--or);font-size:.9em;margin-bottom:6px}
.mp-day .mp-i{font-size:.82em;color:var(--t2);padding:3px 0;border-bottom:1px solid var(--brd)}
.mp-day .mp-i:last-child{border-bottom:none}

/* TABLE generic */
table.gen{width:100%;border-collapse:collapse;font-size:.8em;margin:6px 0}
table.gen th,table.gen td{padding:7px 6px;text-align:left;border-bottom:1px solid var(--brd)}
table.gen th{color:var(--or);font-weight:700;background:var(--bg4)}
table.gen td{color:var(--t2)}


/* MEAL CHECKBOX */
.mchk-row{display:flex;align-items:center;gap:8px;margin-top:8px;padding-top:6px;border-top:1px solid var(--brd)}
.mchk-btn{padding:4px 12px;border-radius:16px;font-size:.75em;font-weight:600;cursor:pointer;transition:.2s;border:1px solid var(--brd);background:var(--bg3);color:var(--t2);font-family:'Outfit',sans-serif}
.mchk-btn:hover{border-color:var(--gr);color:var(--gr)}
.mchk-btn.done{background:var(--gr-g);border-color:var(--gr);color:var(--gr)}
.mchk-lbl{font-size:.72em;color:var(--t3)}

/* COMPLIANCE BAR */
.cbar{display:flex;gap:3px;align-items:flex-end;height:50px;margin-top:10px}
.cbar-d{flex:1;border-radius:3px 3px 0 0;transition:.3s;min-width:0;position:relative}
.cbar-d .cbar-v{position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:.55em;color:var(--t3);font-family:'JetBrains Mono',monospace;white-space:nowrap}
.cbar-lbl{display:flex;gap:3px;margin-top:2px}.cbar-lbl span{flex:1;text-align:center;font-size:.55em;color:var(--t3)}

/* SCALE TOGGLE */
.scale-wrap{display:flex;gap:5px;align-items:center;margin-top:6px}
.scale-btn{padding:3px 10px;border-radius:12px;font-size:.72em;font-weight:700;cursor:pointer;transition:.2s;border:1px solid var(--brd);background:var(--bg3);color:var(--t2);font-family:'JetBrains Mono',monospace}
.scale-btn:hover{border-color:var(--yl)}
.scale-btn.on{background:var(--yl-g);border-color:var(--yl);color:var(--yl)}

/* AUTO WEEK INDICATOR */
.aw-bar{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad3);padding:8px 12px;margin-bottom:10px;display:flex;align-items:center;gap:8px;font-size:.82em}
.aw-bar .aw-wk{font-weight:800;color:var(--or);font-family:'JetBrains Mono',monospace}
.aw-bar .aw-day{color:var(--t2)}
.aw-set{font-size:.72em;color:var(--or);cursor:pointer;margin-left:auto;text-decoration:underline}

/* NOTIF BANNER */
.notif-bar{background:var(--yl-g);border:1px solid rgba(251,191,36,.3);border-radius:var(--rad3);padding:10px 12px;margin-bottom:10px;display:flex;align-items:center;gap:8px;font-size:.82em}
.notif-bar button{padding:5px 12px;border-radius:16px;border:none;font-weight:600;cursor:pointer;font-size:.8em;font-family:'Outfit',sans-serif}
.notif-bar .nb-yes{background:var(--or);color:#fff}.notif-bar .nb-no{background:var(--bg4);color:var(--t2)}

/* PWA install */
.pwa-bar{background:var(--or-g);border:1px solid var(--brd2);border-radius:var(--rad3);padding:10px 12px;margin-bottom:10px;display:flex;align-items:center;gap:8px;font-size:.82em;display:none}
.pwa-bar button{padding:5px 12px;border-radius:16px;border:none;background:var(--or);color:#fff;font-weight:600;cursor:pointer;font-size:.8em}

/* OFFLINE BAR */
.offline-bar{position:fixed;top:56px;left:0;right:0;background:var(--rd);color:#fff;text-align:center;padding:6px;font-size:.78em;font-weight:700;z-index:97;transform:translateY(-100%);transition:.3s}
.offline-bar.on{transform:translateY(0)}

/* SCANNER */
#scanReader{width:100%;max-width:400px;margin:0 auto;border-radius:var(--rad2);overflow:hidden}
#scanReader video{border-radius:var(--rad2)}
.scan-result{background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad2);padding:14px;margin-top:12px}
.scan-result .sr-name{font-weight:700;font-size:1.05em;color:var(--or);margin-bottom:8px}
.scan-result .sr-brand{font-size:.82em;color:var(--t2);margin-bottom:8px}
.scan-macro{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:8px}
.scan-macro .sm{background:var(--bg3);border-radius:var(--rad3);padding:8px 4px;text-align:center}
.scan-macro .sm .v{font-size:1.2em;font-weight:800;font-family:'JetBrains Mono',monospace;color:var(--or)}
.scan-macro .sm .l{font-size:.6em;color:var(--t3);text-transform:uppercase}
.scan-hist{margin-top:12px;max-height:300px;overflow-y:auto}
.scan-hi{display:flex;align-items:center;gap:8px;padding:8px;background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad3);margin-bottom:4px;font-size:.82em;cursor:pointer;transition:.2s}
.scan-hi:hover{border-color:var(--or)}
.scan-hi .sh-n{flex:1;font-weight:600}.scan-hi .sh-k{color:var(--or);font-family:'JetBrains Mono',monospace}

/* PHOTO DIARY */
.photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.photo-card{position:relative;border-radius:var(--rad3);overflow:hidden;aspect-ratio:1;background:var(--bg4);border:1px solid var(--brd)}
.photo-card img{width:100%;height:100%;object-fit:cover}
.photo-card .pc-info{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,.8));padding:4px 6px;font-size:.6em;color:#fff}
.photo-card .pc-del{position:absolute;top:4px;right:4px;background:var(--rd);border:none;color:#fff;width:20px;height:20px;border-radius:50%;font-size:.65em;cursor:pointer;opacity:0;transition:.2s}
.photo-card:hover .pc-del{opacity:1}
#photoCapture{display:none}

/* FULLSCREEN TIMER */
.fs-timer{position:fixed;inset:0;background:var(--bg);z-index:200;display:none;flex-direction:column;align-items:center;justify-content:center}
.fs-timer.on{display:flex}
.fs-timer .fs-time{font-family:'JetBrains Mono',monospace;font-size:min(25vw,120px);font-weight:800;color:var(--or);text-shadow:0 0 60px rgba(255,107,43,.4)}
.fs-timer .fs-lbl{font-size:1.2em;color:var(--t2);margin-bottom:20px}
.fs-timer .fs-btns{display:flex;gap:12px}

/* THEME TOGGLE */
body.light{--bg:#f5f5f5;--bg2:#fff;--bg3:#f0f0f0;--bg4:#e8e8e8;--bg5:#ddd;--t1:#111;--t2:#555;--t3:#888;--brd:rgba(0,0,0,.1);--brd2:rgba(255,107,43,.3)}
.theme-btn{width:36px;height:36px;border-radius:var(--rad3);border:1px solid var(--brd);background:var(--bg3);color:var(--t2);font-size:1em;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;flex-shrink:0}
.theme-btn:active{transform:scale(.9)}

/* SHAKE HINT */
.shake-hint{font-size:.7em;color:var(--t3);text-align:center;margin-top:6px;opacity:.6}

/* KALKULATOR / MEAL EDITOR */
.calc-search{display:flex;gap:6px;margin-bottom:10px}
.calc-search input{flex:1}
.calc-results{max-height:300px;overflow-y:auto;margin-bottom:10px}
.calc-prod{display:flex;align-items:center;gap:8px;padding:8px;background:var(--bg4);border:1px solid var(--brd);border-radius:var(--rad3);margin-bottom:4px;cursor:pointer;transition:.2s;font-size:.85em}
.calc-prod:hover{border-color:var(--or);transform:translateX(2px)}
.calc-prod .cp-name{flex:1;font-weight:600}.calc-prod .cp-macro{font-size:.75em;color:var(--t3);font-family:'JetBrains Mono',monospace}
.calc-prod img{width:36px;height:36px;border-radius:6px;object-fit:cover}
.basket{border:1px solid var(--brd2);border-radius:var(--rad);padding:12px;margin-top:10px}
.basket-item{display:grid;grid-template-columns:1fr auto auto 28px;gap:6px;padding:6px 0;border-bottom:1px solid var(--brd);font-size:.85em;align-items:center}
.basket-item:last-child{border-bottom:none}
.basket-item .bi-n{font-weight:600}.basket-item .bi-m{font-family:'JetBrains Mono',monospace;font-size:.78em;color:var(--t3)}
.basket-item .bi-a{color:var(--gr);font-weight:600;font-size:.82em}
.basket-total{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:10px;text-align:center}
.basket-total .bt{background:var(--bg4);border-radius:var(--rad3);padding:8px 4px}
.basket-total .bt .v{font-size:1.1em;font-weight:800;font-family:'JetBrains Mono',monospace}
.basket-total .bt .l{font-size:.6em;color:var(--t3);text-transform:uppercase}
.bt.warn-or .v{color:var(--yl)}.bt.warn-rd .v{color:var(--rd)}
.meal-ed-ing{display:grid;grid-template-columns:1fr 70px 50px 28px;gap:4px;padding:5px 0;border-bottom:1px solid var(--brd);font-size:.85em;align-items:center}
.meal-ed-ing:last-child{border-bottom:none}
.meal-ed-ing input{background:var(--bg4);border:1px solid var(--brd);border-radius:4px;color:var(--t1);padding:4px;font-family:'JetBrains Mono',monospace;font-size:.85em;width:100%}
.bal-warn{padding:6px 8px;border-radius:6px;font-size:.78em;margin-top:6px}
.bal-warn.or{background:var(--yl-g,rgba(251,191,36,.12));border-left:3px solid var(--yl);color:var(--yl)}
.bal-warn.rd{background:rgba(255,71,87,.12);border-left:3px solid var(--rd);color:var(--rd)}
.bal-warn.ok{background:rgba(45,212,160,.12);border-left:3px solid var(--gr);color:var(--gr)}
.override-badge{display:inline-block;padding:2px 6px;border-radius:8px;font-size:.65em;font-weight:700;background:rgba(34,211,238,.15);color:var(--cy);margin-left:6px}
.sub-list{max-height:200px;overflow-y:auto;margin-top:6px}
.sub-item{display:flex;align-items:center;gap:6px;padding:5px;background:var(--bg3);border:1px solid var(--brd);border-radius:6px;margin-bottom:3px;cursor:pointer;font-size:.82em;transition:.2s}
.sub-item:hover{border-color:var(--gr);background:var(--bg4)}
.cp-add-row{display:flex;gap:4px;flex-wrap:wrap;padding:8px;background:var(--bg3);border-radius:var(--rad3);margin-top:8px}
.cp-add-row input{flex:1;min-width:60px;padding:6px;background:var(--bg4);border:1px solid var(--brd);border-radius:4px;color:var(--t1);font-size:.82em}

@media(max-width:600px){
main{padding:64px 8px 28px}.hbadge{display:none}header{padding:0 8px;gap:6px}
.photo-grid{grid-template-columns:repeat(2,1fr)}
.scan-macro{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<svg width="0" height="0"><defs><linearGradient id="og" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#ff6b2b"/><stop offset="100%" stop-color="#ff8f5e"/></linearGradient></defs></svg>
<div class="offline-bar" id="offBar">üì° Brak internetu ‚Äî tryb offline</div>
<div class="toast" id="toast"><span id="tIco"></span><span id="tMsg"></span></div>
<div class="overlay" id="ov" onclick="navC()"></div>
<header>
<button class="hbtn" id="mbtn" onclick="navT()">‚ò∞</button>
<div class="htitle"><h1>DIET MASTER V7</h1><span>~303 z≈Ç/tyg ‚Ä¢ T<span id="hWk">1</span></span></div>
<div class="hbadge">üíß <b id="hw">0</b>L</div>
<div class="hbadge">‚öñÔ∏è <b id="hwt">100.0</b>kg</div>
<button class="theme-btn" id="themeBtn" onclick="toggleTheme()">üåô</button>
</header>
<nav id="nav">
<div class="nlbl">G≈Ç√≥wne</div>
<button class="nbtn on" data-s="dash"><span class="ni"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></span>Dashboard</button>
<button class="nbtn" data-s="plan"><span class="ni"><svg viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h12"/><circle cx="20" cy="18" r="2"/></svg></span>Jad≈Çospis</button>
<button class="nbtn" data-s="shop"><span class="ni"><svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg></span>Zakupy</button>
<button class="nbtn" data-s="pantry"><span class="ni"><svg viewBox="0 0 24 24"><path d="M3 3h18v4H3z"/><path d="M3 7v14h18V7"/><path d="M8 11h8"/><path d="M8 15h5"/></svg></span>Spi≈ºarnia</button>
<button class="nbtn" data-s="waga"><span class="ni"><svg viewBox="0 0 24 24"><path d="M12 3a4 4 0 014 4H8a4 4 0 014-4z"/><path d="M5 7h14l-1 14H6L5 7z"/></svg></span>Waga</button>
<div class="nlbl">Narzƒôdzia</div>
<button class="nbtn" data-s="woda"><span class="ni"><svg viewBox="0 0 24 24"><path d="M12 2L5 10c-1.5 2-2 4-2 6a9 9 0 0018 0c0-2-.5-4-2-6L12 2z"/></svg></span>Nawodnienie</button>
<button class="nbtn" data-s="supp"><span class="ni"><svg viewBox="0 0 24 24"><rect x="6" y="2" width="12" height="20" rx="4"/><line x1="6" y1="10" x2="18" y2="10"/></svg></span>Suplementy</button>
<button class="nbtn" data-s="psmf"><span class="ni"><svg viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10"/></svg></span>Protok√≥≈Ç PSMF</button>
<button class="nbtn" data-s="prep"><span class="ni"><svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12h20C22 6.5 17.5 2 12 2z"/><path d="M2 14h20v2a4 4 0 01-4 4H6a4 4 0 01-4-4v-2z"/></svg></span>Meal Prep</button>
<button class="nbtn" data-s="timer"><span class="ni"><svg viewBox="0 0 24 24"><circle cx="12" cy="13" r="8"/><path d="M12 9v4l2 2"/><path d="M9 2h6"/><path d="M12 2v2"/></svg></span>Timer</button>
<button class="nbtn" data-s="scan"><span class="ni"><svg viewBox="0 0 24 24"><path d="M3 7V5a2 2 0 012-2h2M17 3h2a2 2 0 012 2v2M21 17v2a2 2 0 01-2 2h-2M7 21H5a2 2 0 01-2-2v-2"/><line x1="7" y1="8" x2="7" y2="16"/><line x1="11" y1="8" x2="11" y2="16"/><line x1="15" y1="8" x2="15" y2="16"/></svg></span>Skaner EAN</button>
<button class="nbtn" data-s="calc"><span class="ni"><svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="10" y2="10"/><line x1="12" y1="10" x2="14" y2="10"/><line x1="8" y1="14" x2="10" y2="14"/><line x1="12" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="16" y2="18"/></svg></span>Kalkulator Makro</button>
<button class="nbtn" data-s="photos"><span class="ni"><svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><circle cx="12" cy="12" r="3"/><path d="M8 5l1-2h6l1 2"/></svg></span>Foto Posi≈Çk√≥w</button>
<div class="nlbl">Dane</div>
<button class="nbtn" data-s="blood"><span class="ni"><svg viewBox="0 0 24 24"><path d="M12 2L7 10c-1 1.5-2 3.5-2 5.5A7 7 0 0019 15.5c0-2-1-4-2-5.5L12 2z"/><path d="M9 15a3 3 0 003 3"/></svg></span>Wyniki Krwi</button>
<button class="nbtn" data-s="zabka"><span class="ni"><svg viewBox="0 0 24 24"><path d="M3 3h18v18H3z"/><path d="M3 9h18M9 3v18"/></svg></span>Plan B ‚Äî ≈ªabka</button>
<button class="nbtn" data-s="dataio"><span class="ni"><svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span>Backup / Eksport</button>
</nav>
<main>

<!-- DASHBOARD -->
<section id="dash" class="sec on">
<div id="notifBar" class="notif-bar" style="display:none">
<span>üîî</span><span>W≈ÇƒÖcz powiadomienia (elektrolity, posi≈Çki, supl.)</span>
<button class="nb-yes" onclick="notifReq()">W≈ÇƒÖcz</button><button class="nb-no" onclick="notifDismiss()">Nie</button>
</div>
<div id="pwaBar" class="pwa-bar">
<span>üì±</span><span>Zainstaluj jako aplikacjƒô na telefonie</span>
<button onclick="pwaInstall()">Instaluj</button><button class="nb-no" onclick="this.parentElement.style.display='none'">√ó</button>
</div>
<div class="aw-bar" id="awBar">
<span class="aw-wk" id="awWk">T1</span>
<span class="aw-day" id="awDay">PON ‚Ä¢ Dzie≈Ñ 1</span>
<span class="aw-set" id="awSet" onclick="awConfig()">‚öôÔ∏è Ustaw start</span>
</div>
<div class="g2">
<div class="c"><div class="ch"><div class="ico">üéØ</div><h2>Postƒôp</h2></div>
<div style="text-align:center">
<div class="pring"><svg width="160" height="160"><circle class="trk" cx="80" cy="80" r="70"/><circle class="fil" cx="80" cy="80" r="70" stroke-dasharray="440" stroke-dashoffset="440" id="pRing"/></svg><div class="pctr"><div class="kg" id="cWt">100.0</div><div class="lb">kg</div><div class="tgt">CEL: 82 KG</div></div></div>
<div class="g2" style="margin-top:12px"><div class="sb gr"><div class="sv" id="lostK">0.0</div><div class="sl">kg stracone</div></div><div class="sb"><div class="sv" id="leftK">18.0</div><div class="sl">kg do celu</div></div></div>
</div></div>
<div class="c"><div class="ch"><div class="ico">üìà</div><h2>Dzisiejsze makra</h2><span class="badge std" id="dayBdg">STANDARD</span></div>
<div class="mg"><div class="mb kc"><div class="v" id="dKc">‚Äî</div><div class="l">Kalorie</div></div><div class="mb pr"><div class="v" id="dP">‚Äî</div><div class="l">Bia≈Çko</div></div><div class="mb ca"><div class="v" id="dW">‚Äî</div><div class="l">Wƒôgle</div></div><div class="mb fa"><div class="v" id="dT">‚Äî</div><div class="l">T≈Çuszcz</div></div></div>
<div class="g2" style="margin-top:12px"><div class="sb cy"><div class="sv" id="dWat">0.0</div><div class="sl">üíß woda (L)</div></div><div class="sb bl"><div class="sv" id="dStr">0</div><div class="sl">üçΩÔ∏è posi≈Çki dzi≈õ</div></div></div>
</div></div>
<div class="g2" style="margin-top:12px">
<div class="c"><div class="ch"><div class="ico">‚ö°</div><h2>Szybkie akcje</h2></div>
<div class="qa" onclick="go('woda')"><span class="i">üíß</span><div class="t"><div class="tt">Dodaj wodƒô</div><div class="ds">Cel: 5L+</div></div><span class="ar">‚Üí</span></div>
<div class="qa" onclick="go('waga')"><span class="i">‚öñÔ∏è</span><div class="t"><div class="tt">Zapisz wagƒô</div><div class="ds">Codziennie rano</div></div><span class="ar">‚Üí</span></div>
<div class="qa" onclick="go('prep')"><span class="i">üç≥</span><div class="t"><div class="tt">Meal Prep</div><div class="ds">Co gotowaƒá dzi≈õ</div></div><span class="ar">‚Üí</span></div>
<div class="qa" onclick="go('supp')"><span class="i">üíä</span><div class="t"><div class="tt">Suplementy</div><div class="ds">Odznacz wziƒôte</div></div><span class="ar">‚Üí</span></div>
</div>
<div class="c"><div class="ch"><div class="ico">üì¶</div><h2>Spi≈ºarnia</h2><span style="font-size:.78em;color:var(--t3)" id="dashPantryLbl">‚Äî</span></div>
<div id="dashPantryStatus"></div>
<div style="margin-top:8px"><button class="btn sm out" onclick="go('pantry')">üì¶ Otw√≥rz spi≈ºarniƒô ‚Üí</button></div>
</div></div>
<div class="c" style="margin-top:12px"><div class="ch"><div class="ico">üìã</div><h2>Plan na dzi≈õ</h2><span style="color:var(--t3);font-size:.78em" id="todD"></span></div><div id="todM"></div></div>
<div class="c" style="grid-column:1/-1"><div class="ch"><div class="ico">‚úÖ</div><h2>Compliance</h2><span style="font-size:.78em;color:var(--t3)" id="compPct">‚Äî</span></div>
<div class="cbar" id="compBar"></div>
<div class="cbar-lbl" id="compLbl"></div>
</div>
</section>

<!-- JAD≈ÅOSPIS -->
<section id="plan" class="sec">
<div class="c"><div class="ch"><div class="ico">üçΩÔ∏è</div><h2>Jad≈Çospis V7</h2></div>
<div class="al info"><strong>üí° 4-tygodniowa rotacja.</strong> Wybierz tydzie≈Ñ ‚Üí dzie≈Ñ ‚Üí pe≈Çny plan z przepisami.</div>
<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px">
<div class="scale-wrap"><span style="font-size:.78em;color:var(--t3)">üç≥ Porcja:</span><button class="scale-btn" id="sc1" onclick="setScale(1)">√ó1</button><button class="scale-btn" id="sc2" onclick="setScale(2)">√ó2</button><button class="scale-btn" id="sc3" onclick="setScale(3)">√ó3</button></div>
<button class="btn sm" onclick="dayBuilder()" style="font-size:.78em">üèóÔ∏è Zbuduj dzie≈Ñ</button>
</div>
<div class="al ok"><strong>üå± Chia 10g/dzie≈Ñ</strong> w shake = +5g b≈Çonnika. <strong>Glicyna 5g</strong> w MSM shot 21:00 = stawy + sen. <strong>Omega-3 4 kaps</strong> = ~2g EPA+DHA ‚Üí triglicerydy w d√≥≈Ç.</div>
<div class="wsel" id="weekSel"></div>
<div class="tabs" id="dayTabs"></div>
<div id="dayC"></div>
</div></section>

<!-- ZAKUPY -->
<section id="shop" class="sec">
<div class="c"><div class="ch"><div class="ico">üõí</div><h2>Lista Zakup√≥w ‚Äî <span id="shopWkLbl">Tydzie≈Ñ 1</span></h2><button class="btn sm out" onclick="shopRst()">üîÑ Reset</button></div>
<div class="wsel" id="shopWeekSel"></div>
<div id="shopC"></div>
<div class="stot"><span>RAZEM:</span><span class="v" id="shopTot">‚Äî z≈Ç</span></div>
<div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
<button class="btn out" onclick="findStore('Biedronka')">üìç Najbli≈ºsza Biedronka</button>
<button class="btn out" onclick="findStore('Lidl')">üìç Najbli≈ºszy Lidl</button>
</div>
<div class="shopgen">
<h3>üõ†Ô∏è Generator listy ‚Äî wybierz dni</h3>
<div class="al info" style="margin:0 0 10px"><strong>Zaznacz dni</strong> z dowolnych tygodni ‚Üí wygenerujƒô listƒô sk≈Çadnik√≥w.</div>
<div style="margin-bottom:8px">
<div style="display:flex;gap:4px;margin-bottom:6px" id="sgWeekBtns"></div>
<div class="sg-days" id="sgDays"></div>
</div>
<div style="display:flex;gap:8px;flex-wrap:wrap">
<button class="btn" onclick="sgGenerate()">üìã Generuj listƒô</button>
<button class="btn out" onclick="sgClear()">üîÑ Wyczy≈õƒá</button>
<button class="btn gr" onclick="sgShare()">üì§ Udostƒôpnij</button>
</div>
<div class="sg-result" id="sgResult"></div>
</div>
</div></section>

<!-- MODAL (global) -->
<div class="modal-ov" id="modalOv" onclick="if(event.target===this)modalClose()">
<div class="modal" id="modal"></div>
</div>

<!-- SPI≈ªARNIA -->
<section id="pantry" class="sec">
<div class="c"><div class="ch"><div class="ico">üè™</div><h2>Spi≈ºarnia</h2><button class="btn sm out" onclick="pantryReset()">üîÑ Reset</button></div>
<div class="al info"><strong>üì¶ CiƒÖg≈Çy magazyn.</strong> Produkty dodajƒÖ siƒô z zakup√≥w, zu≈ºywajƒÖ siƒô przy gotowaniu.</div>
<div class="pantry-stats">
<div class="sb gr"><div class="sv" id="pTotal">0</div><div class="sl">Produkt√≥w</div></div>
<div class="sb yl"><div class="sv" id="pLow">0</div><div class="sl">Ma≈Ço</div></div>
<div class="sb rd"><div class="sv" id="pEmpty">0</div><div class="sl">Brak</div></div>
</div>
<div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">
<button class="btn sm" onclick="pantryAddManual()">‚ûï Dodaj rƒôcznie</button>
<button class="btn sm out" onclick="pantryFromShop()">üõí Wczytaj z zakup√≥w</button>
<button class="btn sm out" onclick="pantryShowSync()">üîÑ Co brakuje na tydzie≈Ñ?</button>
</div>
<div id="pantrySyncBox" style="display:none"></div>
<div id="pantryList"></div>
</div></section>

<!-- WAGA -->
<section id="waga" class="sec">
<div class="c"><div class="ch"><div class="ico">‚öñÔ∏è</div><h2>Tracker Wagi</h2></div>
<div class="fr" style="margin-bottom:14px"><div class="ig"><label>Waga (kg)</label><input type="number" id="wIn" step="0.1" min="50" max="200" placeholder="np. 98.5"></div><div class="ig"><label>Data</label><input type="date" id="dIn"></div><button class="btn" onclick="addW()" style="height:38px">üíæ</button></div>
<div class="chrt"><canvas id="wChart"></canvas></div>
<div class="g4" style="margin-top:12px"><div class="sb gr"><div class="sv" id="sStr">-</div><div class="sl">Start</div></div><div class="sb yl"><div class="sv" id="sLow">-</div><div class="sl">Min</div></div><div class="sb bl"><div class="sv" id="sAvg">-</div><div class="sl">kg/tyg</div></div><div class="sb cy"><div class="sv" id="sDays">-</div><div class="sl">Dni do celu</div></div></div>
<div style="margin-top:14px;max-height:240px;overflow-y:auto" id="wHist"></div>
</div></section>

<!-- WODA -->
<section id="woda" class="sec">
<div class="c"><div class="ch"><div class="ico">üíß</div><h2>Nawodnienie</h2><button class="btn sm out" onclick="watRst()">üîÑ</button></div>
<div style="text-align:center;padding:14px 0">
<div class="wbot"><div class="wlvl" id="wLvl" style="height:0%"></div></div>
<div style="font-size:2em;font-weight:800;color:var(--cy);font-family:'JetBrains Mono',monospace"><span id="wCur">0</span> ml</div>
<div style="color:var(--t3);margin:3px 0 14px">Cel: <strong>5000 ml</strong> (<span id="wPct">0</span>%)</div>
<div class="wbtns"><button class="wbtn" onclick="watA(250)">+250</button><button class="wbtn" onclick="watA(500)">+500</button><button class="wbtn" onclick="watA(750)">+750</button><button class="wbtn" onclick="watA(1000)">+1L</button><button class="wbtn min" onclick="watA(-250)">-250</button></div>
<div class="shake-hint" id="shakeHint">üì≥ PotrzƒÖ≈õnij telefonem ‚Üí +250ml</div>
</div>
<div class="al cyn" style="margin-top:14px"><strong>üíß Harmonogram:</strong><br>‚Ä¢ 04:00 ‚Äî Z shake (200ml)<br>‚Ä¢ 06:00-15:00 ‚Äî Min 3L w pracy (yerba wliczona, ostatnia o 13:00)<br>‚Ä¢ 10:00 ‚Äî Elektrolity 500ml (SHAKER!)<br>‚Ä¢ 16:00 ‚Äî Przed/w trakcie posi≈Çku<br>‚Ä¢ 21:00 ‚Äî MSM + Glicyna 5g shot 300ml<br>‚Ä¢ Cel dzienny: 5L+<br>‚Ä¢ üí° Banan (80g) codziennie w shake = potas na uzupe≈Çnienie elektrolit√≥w</div>
</div></section>

<!-- SUPLEMENTY -->
<section id="supp" class="sec">
<div class="c"><div class="ch"><div class="ico">üíä</div><h2>Suplementacja</h2><button class="btn sm out" onclick="suppRst()">üîÑ</button></div>
<div class="al warn"><strong>‚ö†Ô∏è 23 lata:</strong> Bez DHEA, Fadogia, TESTOXX. Naturalny testo na szczycie!</div>
<div id="suppC"></div>
<div class="al info" style="margin-top:12px"><strong>üí° Cykluj Ginseng:</strong> 4 tyg ON / 1 tyg OFF.</div>
</div></section>

<!-- PSMF -->
<section id="psmf" class="sec">
<div class="c"><div class="ch"><div class="ico">‚ö°</div><h2>PSMF ‚Äî Sobota</h2></div>
<div class="al err"><strong>‚ö° TRUE PSMF:</strong> ~1160 kcal | ~225g bia≈Çka | ~7g t≈Çuszczu</div>
<table class="gen">
<tr><th>Czas</th><th>Co</th><th>Kcal</th><th>B</th></tr>
<tr><td style="color:var(--or)">04:00</td><td>Shake PSMF (400g twar√≥g ¬∑ woda ¬∑ 6 bia≈Çek ¬∑ 10g chia)</td><td>484</td><td>92g</td></tr>
<tr><td style="color:var(--or)">10:00</td><td>Elektrolity SHOT + PSMF Survival Drink</td><td>5</td><td>0g</td></tr>
<tr><td style="color:var(--or)">16:00</td><td>400g pier≈õ GOTOWANA + 300g og√≥rek + 100g sa≈Çata</td><td>507</td><td>90g</td></tr>
<tr><td style="color:var(--or)">19:00</td><td>150g twar√≥g + 4 bia≈Çka gotowane [opcjonalny]</td><td>193</td><td>40g</td></tr>
<tr style="font-weight:700"><td></td><td>SUMA</td><td style="color:var(--rd)">1160</td><td style="color:var(--bl)">225g</td></tr>
</table>
<div class="al warn" style="margin-top:12px"><strong>‚ö†Ô∏è KIEDY PRZERWAƒÜ:</strong><br>‚Ä¢ Zawroty g≈Çowy po elektrolitach ‚Üí zjedz normalny posi≈Çek<br>‚Ä¢ Trzƒôsienie rƒÖk ‚Üí dodaj banan<br>‚Ä¢ 3 soboty z rzƒôdu ≈∫le ‚Üí lekki dzie≈Ñ 1400 kcal</div>
<h3 style="color:var(--or);margin:16px 0 8px;font-size:.95em">üìã Checklist PSMF</h3>
<div id="psmfChk"></div>
</div></section>

<!-- MEAL PREP -->
<section id="prep" class="sec">
<div class="c"><div class="ch"><div class="ico">üç≥</div><h2>Meal Prep ‚Äî <span id="prepWkLbl">Tydzie≈Ñ 1</span></h2></div>
<div class="wsel" id="prepWeekSel"></div>
<div class="al info"><strong>Strategia:</strong> Gotuj na 2 dni do przodu. Blender wieczorem, rano 5 sek. wstrzƒÖ≈õniƒôcie.</div>
<div id="prepC"></div>
</div></section>

<!-- TIMER -->
<section id="timer" class="sec">
<div class="c"><div class="ch"><div class="ico">‚è±Ô∏è</div><h2>Timer</h2></div>
<div style="text-align:center;padding:16px 0">
<div class="tdisp" id="tmDisp">00:00</div>
<div style="color:var(--t3);margin-bottom:14px" id="tmLbl">Wybierz preset</div>
<div style="display:flex;justify-content:center;gap:8px"><button class="btn" id="tmBtn" onclick="tmTog()">‚ñ∂Ô∏è Start</button><button class="btn out" onclick="tmRst()">üîÑ</button><button class="btn cy" onclick="tmFullscreen()">‚õ∂ Fullscreen</button></div>
<div class="tpreset"><button class="tpb" onclick="tmSet(1)">1 min</button><button class="tpb" onclick="tmSet(3)">3 min</button><button class="tpb" onclick="tmSet(5)">5 min</button><button class="tpb" onclick="tmSet(8)">8 min jajka</button><button class="tpb" onclick="tmSet(10)">10 min kasza</button><button class="tpb" onclick="tmSet(12)">12 min ry≈º</button><button class="tpb" onclick="tmSet(15)">15 min jaglana</button><button class="tpb" onclick="tmSet(20)">20 min kurczak</button><button class="tpb" onclick="tmSet(40)">40 min ≈ºo≈ÇƒÖdki</button></div>
</div></div></section>

<!-- SCANNER -->
<section id="scan" class="sec">
<div class="c"><div class="ch"><div class="ico">üì∑</div><h2>Skaner Kod√≥w EAN</h2></div>
<div class="al info"><strong>üì° Wymaga internetu.</strong> Skanuj kod kreskowy ‚Üí makra z Open Food Facts.</div>
<div style="text-align:center;margin-bottom:12px">
<button class="btn" id="scanStartBtn" onclick="scanStart()">üì∑ Uruchom kamerƒô</button>
<button class="btn rd" id="scanStopBtn" onclick="scanStop()" style="display:none">‚èπÔ∏è Zatrzymaj</button>
</div>
<div id="scanReader"></div>
<div id="scanResult"></div>
<div class="ig" style="margin-top:12px"><label>Lub wpisz kod rƒôcznie:</label>
<div class="fr"><input type="text" id="eanInput" placeholder="np. 5900512345678" inputmode="numeric"><button class="btn sm" onclick="eanLookup(document.getElementById('eanInput').value)">üîç</button></div>
</div>
<h3 style="color:var(--or);margin:16px 0 8px;font-size:.9em">üìú Historia skan√≥w</h3>
<div class="scan-hist" id="scanHist"></div>
</div></section>

<!-- KALKULATOR MAKRO -->
<section id="calc" class="sec">
<div class="c"><div class="ch"><div class="ico">üßÆ</div><h2>Kalkulator Makro</h2></div>
<div class="al info"><strong>üîç Szukaj produkt√≥w</strong> po nazwie (API) lub skanuj EAN. Dodaj do koszyka, zobacz makra na ≈ºywo.</div>

<div class="calc-search">
<input type="text" id="calcQ" placeholder="Szukaj produktu np. pier≈õ kurczaka..." onkeydown="if(event.key==='Enter')calcSearch()">
<button class="btn sm" onclick="calcSearch()">üîç</button>
<button class="btn sm out" onclick="calcScanEan()">üì∑ EAN</button>
</div>

<div class="tabs" style="margin-bottom:8px">
<button class="tab on" id="calcTabApi" onclick="calcTab('api')">üåê Szukaj online</button>
<button class="tab" id="calcTabPlan" onclick="calcTab('plan')">üìã Z planu</button>
<button class="tab" id="calcTabCustom" onclick="calcTab('custom')">‚≠ê W≈Çasne</button>
<button class="tab" id="calcTabHist" onclick="calcTab('hist')">üìú Historia</button>
</div>

<div id="calcResults" class="calc-results"></div>
<div id="calcAddCustom" style="display:none">
<div class="cp-add-row">
<input type="text" id="cpName" placeholder="Nazwa">
<input type="number" id="cpKcal" placeholder="Kcal/100g" step="1">
<input type="number" id="cpB" placeholder="B/100g" step="0.1">
<input type="number" id="cpW" placeholder="W/100g" step="0.1">
<input type="number" id="cpT" placeholder="T/100g" step="0.1">
<button class="btn sm gr" onclick="calcAddCustomProduct()">üíæ</button>
</div>
</div>

<h3 style="color:var(--or);margin:14px 0 8px;font-size:.9em">üß∫ Koszyk <span id="calcBasketCount" style="color:var(--t3);font-weight:400">(0)</span></h3>
<div class="basket" id="calcBasket">
<div style="color:var(--t3);font-size:.82em;text-align:center;padding:10px">Dodaj produkty z wyszukiwania</div>
</div>
<div class="basket-total" id="calcTotals"></div>
<div id="calcBalWarn"></div>
<div style="margin-top:10px;display:flex;gap:6px;flex-wrap:wrap">
<button class="btn sm out" onclick="calcClearBasket()">üóëÔ∏è Wyczy≈õƒá koszyk</button>
<button class="btn sm" onclick="calcSaveAsMeal()">üíæ Zapisz jako danie</button>
</div>
</div>

<div class="c" style="margin-top:12px"><div class="ch"><div class="ico">‚≠ê</div><h2>W≈Çasne produkty</h2><button class="btn sm out" onclick="calcShowAddCustom()">‚ûï Dodaj</button></div>
<div id="customProdList"></div>
</div>
</section>

<!-- FOTO POSI≈ÅK√ìW -->
<section id="photos" class="sec">
<div class="c"><div class="ch"><div class="ico">üì∏</div><h2>Foto Dziennik</h2><button class="btn sm out" onclick="photoClear()">üóëÔ∏è</button></div>
<div class="al info"><strong>üì∏ Zr√≥b zdjƒôcie posi≈Çku</strong> ‚Äî wizualny dziennik. Zdjƒôcia zapisywane lokalnie w IndexedDB.</div>
<div style="text-align:center;margin-bottom:12px">
<button class="btn" onclick="photoTake()">üì∑ Zr√≥b zdjƒôcie</button>
<input type="file" id="photoCapture" accept="image/*" capture="environment" onchange="photoProcess(event)">
</div>
<div style="margin-bottom:8px;color:var(--t3);font-size:.82em;text-align:center" id="photoCount">‚Äî</div>
<div class="photo-grid" id="photoGrid"></div>
</div></section>

<!-- FULLSCREEN TIMER OVERLAY -->
<div class="fs-timer" id="fsTimer">
<div class="fs-lbl" id="fsLbl">Timer</div>
<div class="fs-time" id="fsTime">00:00</div>
<div class="fs-btns">
<button class="btn" id="fsTmBtn" onclick="tmTog();updFsTimer()">‚ñ∂Ô∏è Start</button>
<button class="btn out" onclick="tmRst();updFsTimer()">üîÑ</button>
<button class="btn rd" onclick="fsClose()">‚úï Zamknij</button>
</div>
</div>

<!-- BLOOD RESULTS -->
<section id="blood" class="sec">
<div class="c"><div class="ch"><div class="ico">ü©∏</div><h2>Wyniki Krwi ‚Äî 09.09.2025</h2></div>
<div class="al ok"><strong>‚úÖ Og√≥lnie dobry stan zdrowia.</strong> Nerki OK dla high-protein. WƒÖtroba idealna. Tarczyca OK.</div>
<div class="al warn"><strong>‚ö†Ô∏è Triglicerydy: 139 mg/dl</strong> (cel: <100). Podwy≈ºszone ‚Äî dieta + Omega-3 + redukcja masy powinny obni≈ºyƒá.<br><strong>‚ö†Ô∏è HDL: 47 mg/dl</strong> (lepiej >50). Aktywno≈õƒá fizyczna + Omega-3 podniesie.</div>

<h3 style="color:var(--or);margin:14px 0 6px;font-size:.9em">Morfologia</h3>
<table class="brt">
<tr><th>Badanie</th><th>Wynik</th><th>Norma</th><th>Status</th></tr>
<tr><td>Leukocyty</td><td>6,98 tys/Œºl</td><td>4,00-10,00</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>Erytrocyty</td><td>5,29 mln/Œºl</td><td>4,60-6,50</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>Hemoglobina</td><td>16,7 g/dl</td><td>13,5-18,0</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>Hematokryt</td><td>50,7 %</td><td>40,0-52,0</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>MCV</td><td>95,8 fl</td><td>80,0-98,0</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>P≈Çytki krwi</td><td>232 tys/Œºl</td><td>150-400</td><td class="ok-val">‚úÖ</td></tr>
</table>

<h3 style="color:var(--or);margin:14px 0 6px;font-size:.9em">Biochemia</h3>
<table class="brt">
<tr><th>Badanie</th><th>Wynik</th><th>Norma</th><th>Status</th></tr>
<tr><td>Kreatynina</td><td>0,72 mg/dl</td><td>0,70-1,20</td><td class="ok-val">‚úÖ nerki OK</td></tr>
<tr><td>eGFR</td><td>>60 ml/min</td><td>>60</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>Glukoza</td><td>87 mg/dl</td><td>70-99</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>ALT</td><td>21 U/l</td><td>0-50</td><td class="ok-val">‚úÖ wƒÖtroba OK</td></tr>
<tr><td>AST</td><td>21 U/l</td><td>0-50</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>GGTP</td><td>18 U/l</td><td>0-60</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>Amylaza</td><td>32 U/l</td><td>28-100</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>S√≥d</td><td>143 mmol/l</td><td>136-145</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>Potas</td><td>3,73 mmol/l</td><td>3,50-5,10</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>TSH</td><td>1,560 ŒºIU/ml</td><td>0,270-4,200</td><td class="ok-val">‚úÖ tarczyca OK</td></tr>
<tr><td>Wit. B12</td><td>413 pg/ml</td><td>197-771</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>PSA</td><td>0,371 ng/ml</td><td>0-1,400</td><td class="ok-val">‚úÖ</td></tr>
</table>

<h3 style="color:var(--or);margin:14px 0 6px;font-size:.9em">Lipidogram ‚ö†Ô∏è</h3>
<table class="brt">
<tr><th>Badanie</th><th>Wynik</th><th>Zalecane</th><th>Status</th></tr>
<tr><td>Cholesterol</td><td>183 mg/dl</td><td>115-190</td><td class="ok-val">‚úÖ</td></tr>
<tr><td>HDL</td><td>47 mg/dl</td><td>>50</td><td class="warn-val">‚ö†Ô∏è niski</td></tr>
<tr><td>nie-HDL</td><td>136 mg/dl</td><td><130</td><td class="warn-val">‚ö†Ô∏è</td></tr>
<tr><td>LDL</td><td>111 mg/dl</td><td><115</td><td class="warn-val">‚ö†Ô∏è graniczny</td></tr>
<tr><td>Triglicerydy</td><td>139 mg/dl</td><td><100</td><td class="bad-val">‚ùå za wysoko</td></tr>
</table>

<div class="al info" style="margin-top:14px"><strong>üìã Co z tym robiƒá:</strong><br>
‚Ä¢ Redukcja masy (100‚Üí82kg) obni≈ºy TG i LDL<br>
‚Ä¢ Omega-3 (2 kaps/dz) ‚Äî bierzesz, kontynuuj<br>
‚Ä¢ Si≈Çownia (start w ciƒÖgu miesiƒÖca) podniesie HDL<br>
‚Ä¢ Kontrolne badania: po osiƒÖgniƒôciu ~90kg (ok. 10 tyg)</div>
</div></section>

<!-- PLAN B ≈ªABKA -->
<section id="zabka" class="sec">
<div class="c"><div class="ch"><div class="ico">üè™</div><h2>Plan B ‚Äî ≈ªabka / Awaryjny</h2></div>
<div class="al warn"><strong>‚ö†Ô∏è U≈ºyj TYLKO gdy nie mo≈ºesz gotowaƒá.</strong> Nie zastƒôpuje normalnego planu.</div>
<h3 style="color:var(--or);margin:14px 0 8px;font-size:.9em">Opcja 1: ~700 kcal | ~80g bia≈Çka</h3>
<div class="mc"><div class="mn">Pier≈õ z kurczaka gotowana (≈ªabka/Freshmarket)</div>
<div class="mi">‚Ä¢ Pier≈õ z kurczaka w plastrach (~150g) ‚Äî ~25g B<br>‚Ä¢ Twar√≥g 0% Pilos 250g ‚Äî ~42g B<br>‚Ä¢ Og√≥rek/pomidor ‚Äî ~20 kcal<br>Razem: ~500 kcal | ~67g B</div></div>
<h3 style="color:var(--or);margin:14px 0 8px;font-size:.9em">Opcja 2: ~600 kcal | ~70g bia≈Çka</h3>
<div class="mc"><div class="mn">Jajka na twardo + twar√≥g (stacja benzynowa)</div>
<div class="mi">‚Ä¢ 4 jajka gotowane (kup + ugotuj w pracy w czajniku) ‚Äî ~25g B<br>‚Ä¢ Twar√≥g 0% 250g ‚Äî ~42g B<br>Razem: ~500 kcal | ~67g B</div></div>
<h3 style="color:var(--or);margin:14px 0 8px;font-size:.9em">Opcja 3: Fast track Biedronka</h3>
<div class="mc"><div class="mn">Gotowe danie + twar√≥g</div>
<div class="mi">‚Ä¢ Pier≈õ grillowana z lady (Biedronka deli) ~200g ‚Äî ~44g B<br>‚Ä¢ Twar√≥g 0% 250g ‚Äî ~42g B<br>‚Ä¢ Sa≈Çata w torebce ‚Äî ~20 kcal<br>Razem: ~580 kcal | ~86g B</div></div>
<div class="al info" style="margin-top:12px"><strong>Zasada:</strong> Gdy nie mo≈ºesz gotowaƒá ‚Üí twar√≥g 0% + najbardziej czyste bia≈Çko jakie znajdziesz. Unikaj gotowych sos√≥w, panierki, fast-foodu.</div>
</div></section>

<!-- BACKUP / EKSPORT -->
<section id="dataio" class="sec">
<div class="c"><div class="ch"><div class="ico">üíæ</div><h2>Backup & Dane</h2></div>
<div class="al info"><strong>üì± Twoje dane ≈ºyjƒÖ w localStorage.</strong> Zr√≥b backup ≈ºeby nie straciƒá przy czyszczeniu przeglƒÖdarki.</div>
<div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px">
<button class="btn" onclick="dataExport()">üì§ Eksportuj JSON</button>
<button class="btn out" onclick="document.getElementById('impFile').click()">üì• Importuj JSON</button>
<input type="file" id="impFile" accept=".json" style="display:none" onchange="dataImport(event)">
<button class="btn rd" onclick="dataClear()">üóëÔ∏è Wyczy≈õƒá dane</button>
</div>
<div class="al warn"><strong>‚ö†Ô∏è Import nadpisze aktualne dane.</strong> Zr√≥b eksport najpierw.</div>
<div style="margin-top:14px">
<h3 style="color:var(--or);font-size:.9em;margin-bottom:8px">üìä Udostƒôpnij postƒôp</h3>
<button class="btn gr" onclick="shareProgress()">üì§ Udostƒôpnij postƒôp</button>
<span style="font-size:.75em;color:var(--t3);margin-left:8px">Wy≈õle podsumowanie przez Share API</span>
</div>
<div style="margin-top:14px">
<h3 style="color:var(--or);font-size:.9em;margin-bottom:8px">üîí Magazyn trwa≈Çy</h3>
<button class="btn cy" onclick="reqPersist()">Pro≈õ o trwa≈Çy storage</button>
<span style="font-size:.75em;color:var(--t3);margin-left:8px" id="persistSt">‚Äî</span>
</div>
<div style="margin-top:14px">
<h3 style="color:var(--or);font-size:.9em;margin-bottom:8px">üì± Status PWA</h3>
<div id="pwaStatus" style="font-size:.82em;color:var(--t2)">≈Åadowanie...</div>
</div>
</div></section>

<!-- AUTO-WEEK CONFIG -->
<div id="awModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:150;display:none;align-items:center;justify-content:center">
<div class="c" style="max-width:340px;margin:20px">
<div class="ch"><div class="ico">üìÖ</div><h2>Data startu diety</h2></div>
<div class="ig"><label>Kiedy zaczƒÖ≈Çe≈õ dietƒô?</label><input type="date" id="awDate"></div>
<div style="display:flex;gap:8px;margin-top:10px">
<button class="btn" onclick="awSave()">üíæ Zapisz</button>
<button class="btn out" onclick="awClose()">Anuluj</button>
<button class="btn rd" onclick="awClear()">Reset</button>
</div>
<div class="al info" style="margin-top:10px"><strong>Auto-rotacja:</strong> T1‚ÜíT2‚ÜíT3‚ÜíT4‚ÜíT1 co poniedzia≈Çek od daty startu.</div>
</div></div>
</main>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 4-WEEK MEAL DATA (from verified calculations)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const WEEKS=[
// ‚îÄ‚îÄ‚îÄ TYDZIE≈É 1 ‚îÄ‚îÄ‚îÄ
[
{n:'PON',cls:'',bdg:'std',bdgT:'STANDARD A',kcal:2089,b:272,w:167,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity Shot',cls:'',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + ¬Ω ≈Çy≈º. soli himalajskiej + sok ¬Ω cytryny',recipe:'W shakerze z domu. Wypij w 10 min.'},
{time:'16:00',name:'üçó Pier≈õ + Ry≈º + Broku≈Çy',cls:'',kcal:809,b:99,w:62,t:13,
ing:'400g pier≈õ surowa ¬∑ 65g ry≈º ¬∑ 250g broku≈Çy mro≈ºone ¬∑ 5ml olej',
recipe:'Ry≈º 12 min w 250ml wody. Pier≈õ w kostkƒô 3√ó3cm, sma≈º 10-12 min na 5ml oleju. Broku≈Çy ostatnie 5 min. S√≥l, pieprz, papryka.'},
{time:'19:00',name:'ü•ö Jajka gotow. + Twar√≥g + Kasza Gryczana',cls:'',kcal:632,b:76,w:53,t:12,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka gotowane ¬∑ 250g twar√≥g ¬∑ 40g kasza gryczana ¬∑ 200g mix warzywny',
recipe:'Kasza 10 min. Jajka gotuj 8 min (twarde). Twar√≥g z boku. Warzywa mikrofala 4 min.'}
]},
{n:'WTO',cls:'',bdg:'std',bdgT:'STANDARD B',kcal:2028,b:268,w:157,t:28,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity Shot',cls:'',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + ¬Ω ≈Çy≈º. soli + sok ¬Ω cytryny',recipe:'Shaker z domu.'},
{time:'16:00',name:'üçó Pier≈õ + Makaron + Warzywa',cls:'',kcal:782,b:99,w:55,t:13,
ing:'400g pier≈õ ¬∑ 60g makaron pe≈Çnoziarnisty ¬∑ 200g mix warzywny ¬∑ 5ml olej',
recipe:'Makaron al dente 8-10 min. Kurczak w paski 10 min. Warzywa 4 min. Sos sojowy opcja.'},
{time:'19:00',name:'ü•ö Jajka gotow. + Twar√≥g + Ziemniaki',cls:'',kcal:598,b:72,w:50,t:11,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka gotowane ¬∑ 250g twar√≥g ¬∑ 150g ziemniaki ¬∑ 200g marchewka',
recipe:'Ziemniaki + marchewka w plastry, gotuj 15 min. Jajka gotowane 8 min. Twar√≥g z boku.'}
]},
{n:'≈öRO',cls:'org',bdg:'org',bdgT:'SERCA ü´Ä',kcal:2130,b:278,w:128,t:49,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity Shot',cls:'',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + s√≥l + cytryna',recipe:'Shaker.'},
{time:'16:00',name:'ü´Ä Serca + Pier≈õ + Jaglana + Szpinak',cls:'org',kcal:946,b:101,w:50,t:34,
ing:'300g serca kurczaka ¬∑ 200g pier≈õ ¬∑ 50g kasza jaglana ¬∑ 100g cebula ¬∑ 150g szpinak mro≈ºony',
recipe:'Kasza jaglana PRZEP≈ÅUCZ, gotuj 15 min. Serca przekr√≥j na p√≥≈Ç, gotuj w wodzie 15-20 min (NIE sma≈º!). Pier≈õ w kostkƒô osobno. Cebula. Szpinak 3 min.'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej) + Warzywa',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka gotowane ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',
recipe:'Jajka 8 min. Twar√≥g 300g. Warzywa mikrofala.'}
]},
{n:'CZW',cls:'',bdg:'std',bdgT:'STANDARD C',kcal:2113,b:276,w:171,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity Shot',cls:'',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + s√≥l + cytryna',recipe:'Shaker.'},
{time:'16:00',name:'üçó Pier≈õ + Ry≈º + Broku≈Çy',cls:'',kcal:809,b:99,w:62,t:13,
ing:'400g pier≈õ ¬∑ 65g ry≈º ¬∑ 250g broku≈Çy mro≈ºone ¬∑ 5ml olej',
recipe:'Ry≈º 12 min. Pier≈õ w kostkƒô. Broku≈Çy 5 min.'},
{time:'19:00',name:'ü•ö Jajka gotow. + Twar√≥g + Groszek',cls:'',kcal:656,b:80,w:57,t:12,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka gotowane ¬∑ 250g twar√≥g ¬∑ 35g kasza gryczana ¬∑ 150g groszek mro≈ºony',
recipe:'Kasza 10 min. Jajka 8 min. Groszek z mikrofali 3 min. Twar√≥g.'}
]},
{n:'PIƒÑ',cls:'org',bdg:'org',bdgT:'WƒÑTR√ìBKA ü´Ä',kcal:1954,b:265,w:128,t:36,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity Shot',cls:'',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + s√≥l + cytryna',recipe:'Shaker.'},
{time:'16:00',name:'ü´Ä WƒÖtr√≥bka + Pier≈õ + Jaglana',cls:'org',kcal:770,b:88,w:50,t:21,
ing:'200g wƒÖtr√≥bka drobiowa ¬∑ 200g pier≈õ ¬∑ 50g kasza jaglana ¬∑ 100g cebula ¬∑ 150g szpinak ¬∑ 5ml olej',
recipe:'Kasza 15 min. WƒÖtr√≥bka plastry 1cm ‚Äî MAX 3-4 min/stronƒô (nie przesusz!). Pier≈õ osobno. Cebula na oleju. ‚ö†Ô∏è Max 1√ó/tydzie≈Ñ (wit.A)!'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej) + Warzywa',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka gotowane ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',
recipe:'Jajka 8 min. Twar√≥g 300g. Warzywa mikrofala.'}
]},
{n:'SOB',cls:'psm',bdg:'psm',bdgT:'TRUE PSMF ‚ö°',kcal:1189,b:222,w:40,t:10,
meals:[
{time:'04:00',name:'ü•§ Shake PSMF + Chia',cls:'psm',kcal:484,b:92,w:21,t:3,
ing:'400g twar√≥g ¬∑ woda ¬∑ 6 bia≈Çek ¬∑ 10g chia ¬∑ cynamon/kakao',recipe:'Blend wieczorem. Rano wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity (KRYTYCZNE!)',cls:'psm',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + ¬Ω ≈Çy≈º. soli + cytryna + Survival Drink (1L w ciƒÖgu dnia)',
recipe:'Pij powoli. Bez elektrolit√≥w = b√≥le g≈Çowy!'},
{time:'16:00',name:'üçó GOTOWANY kurczak + surowe warzywa',cls:'psm',kcal:507,b:90,w:11,t:7,
ing:'400g pier≈õ GOTOWANA w wodzie ¬∑ 300g og√≥rek ¬∑ 100g sa≈Çata lodowa',
recipe:'Pier≈õ GOTUJ w wodzie z solƒÖ 20 min (NIE sma≈º! zero oleju!). Og√≥rek w plastry. Sa≈Çata. Cytryna.'},
{time:'19:00',name:'üßÄ Mini-twar√≥g + bia≈Çka [opcjonalny]',cls:'psm',kcal:193,b:40,w:7,t:0,
ing:'150g twar√≥g ¬∑ 4 bia≈Çka gotowane',
recipe:'+40g bia≈Çka dla ochrony miƒô≈õni.'}
]},
{n:'NIE',cls:'ref',bdg:'ref',bdgT:'REFEED üü¢',kcal:2482,b:244,w:270,t:38,
meals:[
{time:'04:00',name:'ü•§ Shake REFEED + Chia',cls:'ref',kcal:956,b:110,w:108,t:8,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity Shot',cls:'',kcal:5,b:0,w:1,t:0,
ing:'500ml wody + s√≥l + cytryna',recipe:'Shaker.'},
{time:'16:00',name:'üçó DU≈ªY Kurczak + DU≈ªY Ry≈º',cls:'ref',kcal:1045,b:99,w:109,t:18,
ing:'400g pier≈õ ¬∑ 120g ry≈º ¬∑ 200g mix warzywny ¬∑ 10ml olej',
recipe:'Ry≈º w 500ml wody 18 min ‚Äî MEGA porcja. Kurczak jak zwykle. Olej podw√≥jny.'},
{time:'19:00',name:'ü•ö Jajka + Makaron',cls:'ref',kcal:476,b:35,w:52,t:12,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka gotowane ¬∑ 60g makaron ¬∑ 150g mix warzywny',
recipe:'Makaron 8 min. Jajka gotowane. Warzywa.'}
]}
],
// ‚îÄ‚îÄ‚îÄ TYDZIE≈É 2 ‚îÄ‚îÄ‚îÄ
[
{n:'PON',cls:'',bdg:'std',bdgT:'KASZA GRYCZANA',kcal:1990,b:268,w:155,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker 500ml',recipe:'Jak zawsze.'},
{time:'16:00',name:'üçó Pier≈õ + Kasza Gryczana + Kalafior',cls:'',kcal:744,b:99,w:53,t:14,
ing:'400g pier≈õ ¬∑ 55g kasza gryczana ¬∑ 250g kalafior mro≈ºony ¬∑ 5ml olej',
recipe:'Kasza 10 min. Kurczak w kostkƒô. Kalafior 5 min.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Ziemniaki',cls:'',kcal:598,b:72,w:50,t:11,
ing:'2 jajka gotowane ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 150g ziemniaki ¬∑ 200g marchewka',
recipe:'Ziemniaki + marchewka 15 min. Jajka 8 min.'}
]},
{n:'WTO',cls:'',bdg:'std',bdgT:'TERIYAKI',kcal:2092,b:270,w:171,t:28,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,
ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker 500ml',recipe:''},
{time:'16:00',name:'üçó Kurczak Teriyaki + Ry≈º',cls:'',kcal:812,b:97,w:66,t:12,
ing:'400g pier≈õ ¬∑ 65g ry≈º ¬∑ 200g mix warzywny ¬∑ 15ml sos sojowy ¬∑ 5ml olej',
recipe:'Ry≈º 12 min. Kurczak w paski, sma≈º 10 min. Polej sosem sojowym na koniec. Warzywa.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Kasza Gryczana',cls:'',kcal:632,b:76,w:53,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 40g kasza gryczana ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'≈öRO',cls:'org',bdg:'org',bdgT:'SERCA + SZPINAK ü´Ä',kcal:2130,b:278,w:128,t:49,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker 500ml',recipe:''},
{time:'16:00',name:'ü´Ä Serca + Pier≈õ + Jaglana + Szpinak',cls:'org',kcal:946,b:101,w:50,t:34,
ing:'300g serca ¬∑ 200g pier≈õ ¬∑ 50g kasza jaglana ¬∑ 100g cebula ¬∑ 150g szpinak mro≈ºony',
recipe:'Kasza PRZEP≈ÅUCZ 15 min. Serca gotuj w wodzie 15-20 min. Pier≈õ osobno. Szpinak 3 min.'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej)',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'CZW',cls:'',bdg:'std',bdgT:'BULGUR + CUKINIA',kcal:2007,b:270,w:150,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Pier≈õ + Bulgur + Cukinia',cls:'',kcal:750,b:98,w:52,t:13,
ing:'400g pier≈õ ¬∑ 60g bulgur ¬∑ 200g cukinia ¬∑ 100g pomidory ¬∑ 5ml olej',
recipe:'Bulgur 12 min. Kurczak w kostkƒô. Cukinia w plastry. Pomidory pokr√≥j.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Fasolka',cls:'',kcal:609,b:75,w:46,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 35g kasza jaglana ¬∑ 200g fasolka szparagowa',
recipe:'Kasza 15 min. Jajka 8 min. Fasolka z mikrofali 4 min.'}
]},
{n:'PIƒÑ',cls:'org',bdg:'org',bdgT:'SERCA + GROSZEK ü´Ä',kcal:2258,b:285,w:154,t:49,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'ü´Ä Serca + Pier≈õ + Jaglana + Groszek',cls:'org',kcal:1074,b:108,w:76,t:34,
ing:'300g serca ¬∑ 200g pier≈õ ¬∑ 50g kasza jaglana ¬∑ 100g cebula ¬∑ 200g groszek mro≈ºony',
recipe:'Kasza PRZEP≈ÅUCZ 15 min. Serca gotuj w wodzie 20 min. Pier≈õ kostkuj. Cebula. Groszek 3 min.'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej)',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'SOB',cls:'psm',bdg:'psm',bdgT:'TRUE PSMF ‚ö°',kcal:1189,b:222,w:40,t:10,
meals:[
{time:'04:00',name:'ü•§ Shake PSMF + Chia',cls:'psm',kcal:484,b:92,w:21,t:3,ing:'400g twar√≥g ¬∑ woda ¬∑ 6 bia≈Çek ¬∑ 10g chia ¬∑ cynamon/kakao',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity + Survival',cls:'psm',kcal:5,b:0,w:1,t:0,ing:'Shaker + 1L survival drink',recipe:'Pij powoli.'},
{time:'16:00',name:'üçó GOTOWANY kurczak + warzywa',cls:'psm',kcal:507,b:90,w:11,t:7,ing:'400g pier≈õ gotowana ¬∑ 300g og√≥rek ¬∑ 100g sa≈Çata',recipe:'Gotuj w wodzie 20 min.'},
{time:'19:00',name:'üßÄ Mini-twar√≥g [opcja]',cls:'psm',kcal:193,b:40,w:7,t:0,ing:'150g twar√≥g ¬∑ 4 bia≈Çka gotowane',recipe:''}
]},
{n:'NIE',cls:'ref',bdg:'ref',bdgT:'REFEED üü¢',kcal:2451,b:240,w:269,t:37,
meals:[
{time:'04:00',name:'ü•§ Shake REFEED + Chia',cls:'ref',kcal:956,b:110,w:108,t:8,ing:'400g twar√≥g ¬∑ 300ml mleko ¬∑ 6 bia≈Çek ¬∑ 120g banan ¬∑ 50g p≈Çatki ¬∑ 15g mi√≥d ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó DU≈ªY Kurczak + DU≈ªY Ry≈º',cls:'ref',kcal:1045,b:99,w:109,t:18,
ing:'400g pier≈õ ¬∑ 120g ry≈º ¬∑ 200g mix warzywny ¬∑ 10ml olej',recipe:'MEGA porcja ry≈ºu.'},
{time:'19:00',name:'ü•ö Jajka + Ry≈º',cls:'ref',kcal:445,b:31,w:51,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 50g ry≈º ¬∑ 150g mix warzywny',recipe:'Ry≈º 12 min. Jajka gotowane.'}
]}
],
// ‚îÄ‚îÄ‚îÄ TYDZIE≈É 3 ‚îÄ‚îÄ‚îÄ
[
{n:'PON',cls:'',bdg:'std',bdgT:'WƒòGIERSKI',kcal:2093,b:268,w:169,t:32,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Kurczak Wƒôgierski + Ry≈º',cls:'',kcal:813,b:95,w:64,t:16,
ing:'400g pier≈õ ¬∑ 60g ry≈º ¬∑ 100g cebula ¬∑ 150g pomidory ¬∑ 30g ≈õmietana 12% ¬∑ 5ml olej',
recipe:'Kurczak w kostkƒô + cebula sma≈º. Dodaj pomidory pokrojone + ≈õmietanƒô = sos. Ry≈º 12 min.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Kasza Gryczana',cls:'',kcal:632,b:76,w:53,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 40g kasza gryczana ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'WTO',cls:'',bdg:'std',bdgT:'KUSKUS',kcal:2044,b:268,w:159,t:28,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Pier≈õ + Kuskus + Warzywa',cls:'',kcal:798,b:99,w:57,t:13,
ing:'400g pier≈õ ¬∑ 55g kuskus ¬∑ 200g mix warzywny ¬∑ 100g pomidory ¬∑ 5ml olej',
recipe:'Kuskus: zalej wrzƒÖtkiem, przykryj 5 min. Kurczak w paski. Warzywa. Pomidory.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Ziemniaki',cls:'',kcal:598,b:72,w:50,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 150g ziemniaki ¬∑ 200g marchewka',recipe:'Ziemniaki + marchewka 15 min.'}
]},
{n:'≈öRO',cls:'org',bdg:'org',bdgT:'SERCA MY≈öLIWSKU ü´Ä',kcal:2073,b:269,w:130,t:48,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'ü´Ä Serca Po My≈õliwsku + Kasza',cls:'org',kcal:889,b:92,w:52,t:33,
ing:'300g serca ¬∑ 150g pier≈õ ¬∑ 55g kasza gryczana ¬∑ 150g pieczarki ¬∑ 100g cebula',
recipe:'Kasza 10 min. Serca gotuj w wodzie 20 min, pokr√≥j. Pier≈õ osobno. Pieczarki + cebula sma≈º na suchej patelni. Wszystko razem.'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej)',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'CZW',cls:'',bdg:'std',bdgT:'BASMATI',kcal:2126,b:276,w:175,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Pier≈õ + Ry≈º Basmati + Broku≈Çy + Marchewka',cls:'',kcal:822,b:99,w:66,t:13,
ing:'400g pier≈õ ¬∑ 65g ry≈º basmati ¬∑ 200g broku≈Çy ¬∑ 100g marchewka ¬∑ 5ml olej',
recipe:'Ry≈º basmati 15 min. Kurczak. Broku≈Çy + marchewka 5 min.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Groszek',cls:'',kcal:656,b:80,w:57,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 35g kasza gryczana ¬∑ 150g groszek',recipe:'Kasza 10 min. Groszek 3 min.'}
]},
{n:'PIƒÑ',cls:'',bdg:'std',bdgT:'SPAGHETTI üçù',kcal:1954,b:264,w:146,t:27,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçù Spaghetti Bolognese z Kurczaka',cls:'',kcal:790,b:88,w:71,t:12,
ing:'350g pier≈õ mielona ¬∑ 70g spaghetti ¬∑ 150g passata ¬∑ 80g cebula ¬∑ 80g marchewka ¬∑ 5ml olej',
recipe:'Pier≈õ zmiel lub posiekaj drobno. Cebula + marchew sma≈º. Dodaj passatƒô. Spaghetti al dente.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Warzywa',cls:'',kcal:516,b:79,w:23,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 300g twar√≥g ¬∑ 150g mix warzywny',recipe:'Standard.'}
]},
{n:'SOB',cls:'psm',bdg:'psm',bdgT:'TRUE PSMF ‚ö°',kcal:1189,b:222,w:40,t:10,
meals:[
{time:'04:00',name:'ü•§ Shake PSMF + Chia',cls:'psm',kcal:484,b:92,w:21,t:3,ing:'400g twar√≥g ¬∑ woda ¬∑ 6 bia≈Çek ¬∑ 10g chia',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity + Survival',cls:'psm',kcal:5,b:0,w:1,t:0,ing:'Shaker + survival drink',recipe:''},
{time:'16:00',name:'üçó GOTOWANY kurczak + warzywa',cls:'psm',kcal:507,b:90,w:11,t:7,ing:'400g pier≈õ gotowana ¬∑ 300g og√≥rek ¬∑ 100g sa≈Çata',recipe:'Gotuj 20 min.'},
{time:'19:00',name:'üßÄ Mini-twar√≥g [opcja]',cls:'psm',kcal:193,b:40,w:7,t:0,ing:'150g twar√≥g ¬∑ 4 bia≈Çka',recipe:''}
]},
{n:'NIE',cls:'ref',bdg:'ref',bdgT:'REFEED üü¢',kcal:2482,b:244,w:270,t:38,
meals:[
{time:'04:00',name:'ü•§ Shake REFEED + Chia',cls:'ref',kcal:956,b:110,w:108,t:8,ing:'400g twar√≥g ¬∑ 300ml mleko ¬∑ 6 bia≈Çek ¬∑ 120g banan ¬∑ 50g p≈Çatki ¬∑ 15g mi√≥d ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó DU≈ªY Kurczak + DU≈ªY Ry≈º',cls:'ref',kcal:1045,b:99,w:109,t:18,
ing:'400g pier≈õ ¬∑ 120g ry≈º ¬∑ 200g warzywa ¬∑ 10ml olej',recipe:'MEGA porcja.'},
{time:'19:00',name:'ü•ö Jajka + Makaron',cls:'ref',kcal:476,b:35,w:52,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 60g makaron ¬∑ 150g mix warzywny',recipe:'Makaron 8 min.'}
]}
],
// ‚îÄ‚îÄ‚îÄ TYDZIE≈É 4 ‚îÄ‚îÄ‚îÄ
[
{n:'PON',cls:'',bdg:'std',bdgT:'TANDOORI',kcal:2109,b:274,w:171,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Kurczak Tandoori + Ry≈º Basmati',cls:'',kcal:829,b:101,w:66,t:13,
ing:'400g pier≈õ ¬∑ 65g ry≈º basmati ¬∑ 50g jogurt 0% ¬∑ 200g mix warzywny ¬∑ 5ml olej',
recipe:'Marynuj pier≈õ w jogurcie + curry/kurkuma 30 min (lub wieczorem). Ry≈º basmati 15 min. Warzywa.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Kasza Gryczana',cls:'',kcal:632,b:76,w:53,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 40g kasza gryczana ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'WTO',cls:'',bdg:'std',bdgT:'ZIEMNIAKI',kcal:1984,b:267,w:146,t:28,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Pier≈õ + Ziemniaki + Warzywa',cls:'',kcal:727,b:95,w:48,t:12,
ing:'400g pier≈õ ¬∑ 200g ziemniaki ¬∑ 200g mix warzywny ¬∑ 5ml olej',
recipe:'Ziemniaki gotuj 15 min. Kurczak w kostkƒô. Warzywa mikrofala.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Fasolka',cls:'',kcal:609,b:75,w:46,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 35g kasza jaglana ¬∑ 200g fasolka szparagowa',recipe:'Kasza 15 min. Fasolka 4 min.'}
]},
{n:'≈öRO',cls:'org',bdg:'org',bdgT:'SERCA + SZPINAK ü´Ä',kcal:2130,b:278,w:128,t:49,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'ü´Ä Serca + Pier≈õ + Jaglana + Szpinak',cls:'org',kcal:946,b:101,w:50,t:34,
ing:'300g serca ¬∑ 200g pier≈õ ¬∑ 50g kasza jaglana ¬∑ 100g cebula ¬∑ 150g szpinak',
recipe:'Kasza PRZEP≈ÅUCZ 15 min. Serca gotuj w wodzie 20 min. Pier≈õ. Szpinak.'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej)',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'CZW',cls:'',bdg:'std',bdgT:'HONEY GARLIC',kcal:2152,b:275,w:182,t:29,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó Kurczak Honey Garlic + Ry≈º',cls:'',kcal:848,b:98,w:73,t:13,
ing:'400g pier≈õ ¬∑ 70g ry≈º ¬∑ 200g broku≈Çy ¬∑ 10g mi√≥d ¬∑ 10ml sos sojowy ¬∑ 5ml olej',
recipe:'Kurczak sma≈º w kostkƒô, polej mi√≥d + sos sojowy na koniec. Ry≈º 12 min. Broku≈Çy.'},
{time:'19:00',name:'ü•ö Jajka + Twar√≥g + Groszek',cls:'',kcal:656,b:80,w:57,t:12,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 250g twar√≥g ¬∑ 35g kasza gryczana ¬∑ 150g groszek',recipe:'Kasza 10 min. Groszek 3 min.'}
]},
{n:'PIƒÑ',cls:'org',bdg:'org',bdgT:'SERCA + GROSZEK ü´Ä',kcal:2258,b:285,w:154,t:49,
meals:[
{time:'04:00',name:'ü•§ Shake Banana + Chia',cls:'',kcal:643,b:97,w:51,t:4,ing:'400g twar√≥g ¬∑ 250ml mleko ¬∑ 5 bia≈Çek ¬∑ 80g banan ¬∑ 10g chia + supl.',recipe:'Blend banana+chia wieczorem. Rano 5 sek wstrzƒÖ≈õnij.'},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'ü´Ä Serca + Pier≈õ + Jaglana + Groszek',cls:'org',kcal:1074,b:108,w:76,t:34,
ing:'300g serca ¬∑ 200g pier≈õ ¬∑ 50g kasza jaglana ¬∑ 100g cebula ¬∑ 200g groszek',
recipe:'Kasza PRZEP≈ÅUCZ 15 min. Serca gotuj 20 min. Pier≈õ. Groszek 3 min.'},
{time:'19:00',name:'ü•ö Jajka(2) + Twar√≥g (wiƒôcej)',cls:'',kcal:536,b:80,w:26,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 300g twar√≥g ¬∑ 200g mix warzywny',recipe:'Standard.'}
]},
{n:'SOB',cls:'psm',bdg:'psm',bdgT:'TRUE PSMF ‚ö°',kcal:1189,b:222,w:40,t:10,
meals:[
{time:'04:00',name:'ü•§ Shake PSMF + Chia',cls:'psm',kcal:484,b:92,w:21,t:3,ing:'400g twar√≥g ¬∑ woda ¬∑ 6 bia≈Çek ¬∑ 10g chia',recipe:''},
{time:'10:00',name:'üíß Elektrolity + Survival',cls:'psm',kcal:5,b:0,w:1,t:0,ing:'Shaker + survival',recipe:''},
{time:'16:00',name:'üçó GOTOWANY kurczak + warzywa',cls:'psm',kcal:507,b:90,w:11,t:7,ing:'400g pier≈õ gotowana ¬∑ 300g og√≥rek ¬∑ 100g sa≈Çata',recipe:''},
{time:'19:00',name:'üßÄ Mini-twar√≥g [opcja]',cls:'psm',kcal:193,b:40,w:7,t:0,ing:'150g twar√≥g ¬∑ 4 bia≈Çka',recipe:''}
]},
{n:'NIE',cls:'ref',bdg:'ref',bdgT:'REFEED üü¢',kcal:2451,b:240,w:269,t:37,
meals:[
{time:'04:00',name:'ü•§ Shake REFEED + Chia',cls:'ref',kcal:956,b:110,w:108,t:8,ing:'400g twar√≥g ¬∑ 300ml mleko ¬∑ 6 bia≈Çek ¬∑ 120g banan ¬∑ 50g p≈Çatki ¬∑ 15g mi√≥d ¬∑ 10g chia + supl.',recipe:''},
{time:'10:00',name:'üíß Elektrolity',cls:'',kcal:5,b:0,w:1,t:0,ing:'Shaker',recipe:''},
{time:'16:00',name:'üçó DU≈ªY Kurczak + DU≈ªY Ry≈º',cls:'ref',kcal:1045,b:99,w:109,t:18,
ing:'400g pier≈õ ¬∑ 120g ry≈º ¬∑ 200g warzywa ¬∑ 10ml olej',recipe:'MEGA porcja.'},
{time:'19:00',name:'ü•ö Jajka + Ry≈º',cls:'ref',kcal:445,b:31,w:51,t:11,
ing:'2 jajka ¬∑ 3 bia≈Çka ¬∑ 50g ry≈º ¬∑ 150g mix warzywny',recipe:''}
]}
]
];

// WEEKLY AVERAGES for display
const WAVG=[
{kcal:1998,b:261,w:152,t:31,cost:299},
{kcal:2017,b:262,w:152,t:33,cost:304},
{kcal:1994,b:259,w:156,t:30,cost:302},
{kcal:2039,b:263,w:156,t:33,cost:306}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHOPPING DATA PER WEEK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SHOPPING=[
// T1
[
{i:'üî¥',n:'BIA≈ÅKO',items:[
{n:'Pier≈õ kurczaka',a:'2.4 kg',p:52},{n:'Serca kurczaka',a:'300g',p:5},
{n:'WƒÖtr√≥bka drobiowa',a:'200g',p:4},{n:'Jajka M (10szt)',a:'8 opakowa≈Ñ',p:88},
{n:'Twar√≥g Pilos 0% (250g)',a:'18 szt',p:63}
]},
{i:'üü°',n:'WƒòGLE',items:[
{n:'Ry≈º bia≈Çy',a:'500g',p:5},{n:'Kasza gryczana',a:'500g',p:5},
{n:'Kasza jaglana',a:'500g',p:6},{n:'Makaron pe≈Çnoziarnisty',a:'500g',p:5},
{n:'P≈Çatki owsiane',a:'500g',p:4},{n:'Ziemniaki',a:'500g',p:2}
]},
{i:'üü¢',n:'WARZYWA / OWOCE',items:[
{n:'Broku≈Çy mro≈ºone',a:'500g',p:5},{n:'Mix warzywny mro≈ºony',a:'1.5kg',p:12},
{n:'Szpinak mro≈ºony',a:'500g',p:6},{n:'Groszek mro≈ºony',a:'300g',p:4},
{n:'Marchewka',a:'500g',p:3},{n:'Cebula',a:'500g',p:2},
{n:'Og√≥rki',a:'600g',p:4},{n:'Sa≈Çata lodowa',a:'1 szt',p:3},
{n:'Cytryny',a:'7 szt',p:5},{n:'Banany',a:'800g',p:6},

]},
{i:'‚öôÔ∏è',n:'INNE',items:[
{n:'Olej rzepakowy',a:'500ml',p:8},{n:'S√≥l himalajska',a:'(masz)',p:0},
{n:'Mleko 0.5%',a:'1L',p:3},{n:'Mi√≥d',a:'(masz)',p:0},{n:'Nasiona chia',a:'500g (starczy ~5tyg)',p:12},{n:'Glicyna (proszek)',a:'250g (starczy ~7tyg)',p:25}
]}
],
// T2
[
{i:'üî¥',n:'BIA≈ÅKO',items:[
{n:'Pier≈õ kurczaka',a:'2.4 kg',p:52},{n:'Serca kurczaka',a:'600g',p:10},
{n:'Jajka M (10szt)',a:'8 opakowa≈Ñ',p:88},{n:'Twar√≥g Pilos 0% (250g)',a:'18 szt',p:63}
]},
{i:'üü°',n:'WƒòGLE',items:[
{n:'Ry≈º bia≈Çy',a:'500g',p:5},{n:'Kasza gryczana',a:'500g',p:5},
{n:'Kasza jaglana',a:'500g',p:6},{n:'Bulgur',a:'500g',p:5},
{n:'P≈Çatki owsiane',a:'500g',p:4},{n:'Ziemniaki',a:'500g',p:2}
]},
{i:'üü¢',n:'WARZYWA / OWOCE',items:[
{n:'Kalafior mro≈ºony',a:'500g',p:5},{n:'Mix warzywny mro≈ºony',a:'1.5kg',p:12},
{n:'Szpinak mro≈ºony',a:'500g',p:6},{n:'Groszek mro≈ºony',a:'300g',p:4},
{n:'Fasolka szparagowa mro≈ºona',a:'400g',p:5},{n:'Cukinia',a:'400g',p:4},
{n:'Pomidory',a:'200g',p:3},{n:'Marchewka',a:'500g',p:3},
{n:'Cebula',a:'500g',p:2},{n:'Og√≥rki',a:'600g',p:4},
{n:'Sa≈Çata lodowa',a:'1 szt',p:3},{n:'Cytryny',a:'7 szt',p:5},
{n:'Banany',a:'800g',p:6},
]},
{i:'‚öôÔ∏è',n:'INNE',items:[
{n:'Sos sojowy',a:'(masz/150ml)',p:4},{n:'Olej rzepakowy',a:'(masz z T1)',p:0},{n:'Mleko 0.5%',a:'1L',p:3},
{n:'Nasiona chia',a:'100g',p:5},{n:'Nasiona chia',a:'(masz z T1)',p:0},{n:'Glicyna',a:'(masz z T1)',p:0}
]}
],
// T3
[
{i:'üî¥',n:'BIA≈ÅKO',items:[
{n:'Pier≈õ kurczaka',a:'2.55 kg',p:55},{n:'Serca kurczaka',a:'300g',p:5},
{n:'Jajka M (10szt)',a:'8 opakowa≈Ñ',p:88},{n:'Twar√≥g Pilos 0% (250g)',a:'18 szt',p:63}
]},
{i:'üü°',n:'WƒòGLE',items:[
{n:'Ry≈º bia≈Çy',a:'500g',p:5},{n:'Ry≈º basmati',a:'500g',p:6},
{n:'Kasza gryczana',a:'500g',p:5},{n:'Kasza jaglana',a:'500g',p:6},
{n:'Kuskus',a:'500g',p:5},{n:'Spaghetti',a:'500g',p:5},
{n:'P≈Çatki owsiane',a:'500g',p:4},{n:'Ziemniaki',a:'500g',p:2}
]},
{i:'üü¢',n:'WARZYWA / OWOCE',items:[
{n:'Broku≈Çy mro≈ºone',a:'500g',p:5},{n:'Mix warzywny mro≈ºony',a:'1.5kg',p:12},
{n:'Pieczarki',a:'300g',p:4},{n:'Pomidory',a:'500g',p:5},
{n:'Passata',a:'300g',p:3},{n:'Marchewka',a:'500g',p:3},
{n:'Cebula',a:'500g',p:2},{n:'Og√≥rki',a:'600g',p:4},
{n:'Sa≈Çata lodowa',a:'1 szt',p:3},{n:'Cytryny',a:'7 szt',p:5},
{n:'Banany',a:'800g',p:6},
]},
{i:'‚öôÔ∏è',n:'INNE',items:[
{n:'≈ömietana 12%',a:'200ml',p:3},{n:'Olej rzepakowy',a:'(masz z T1)',p:0},{n:'Mleko 0.5%',a:'1L',p:3},
{n:'Nasiona chia',a:'100g',p:5},{n:'Nasiona chia',a:'(masz z T1)',p:0},{n:'Glicyna',a:'(masz z T1)',p:0}
]}
],
// T4
[
{i:'üî¥',n:'BIA≈ÅKO',items:[
{n:'Pier≈õ kurczaka',a:'2.4 kg',p:52},{n:'Serca kurczaka',a:'600g',p:10},
{n:'Jajka M (10szt)',a:'8 opakowa≈Ñ',p:88},{n:'Twar√≥g Pilos 0% (250g)',a:'18 szt',p:63}
]},
{i:'üü°',n:'WƒòGLE',items:[
{n:'Ry≈º bia≈Çy',a:'500g',p:5},{n:'Ry≈º basmati',a:'500g',p:6},
{n:'Kasza gryczana',a:'500g',p:5},{n:'Kasza jaglana',a:'500g',p:6},
{n:'P≈Çatki owsiane',a:'500g',p:4},{n:'Ziemniaki',a:'500g',p:2}
]},
{i:'üü¢',n:'WARZYWA / OWOCE',items:[
{n:'Broku≈Çy mro≈ºone',a:'500g',p:5},{n:'Mix warzywny mro≈ºony',a:'1.5kg',p:12},
{n:'Szpinak mro≈ºony',a:'500g',p:6},{n:'Groszek mro≈ºony',a:'300g',p:4},
{n:'Fasolka szparagowa mro≈ºona',a:'400g',p:5},{n:'Marchewka',a:'500g',p:3},
{n:'Cebula',a:'500g',p:2},{n:'Og√≥rki',a:'600g',p:4},
{n:'Sa≈Çata lodowa',a:'1 szt',p:3},{n:'Cytryny',a:'7 szt',p:5},
{n:'Banany',a:'800g',p:6},
]},
{i:'‚öôÔ∏è',n:'INNE',items:[
{n:'Sos sojowy',a:'(masz/150ml)',p:4},{n:'Jogurt 0%',a:'200g',p:3},
{n:'Mi√≥d',a:'(masz)',p:0},{n:'Olej rzepakowy',a:'(masz z T1)',p:0},{n:'Mleko 0.5%',a:'1L',p:3},
{n:'Nasiona chia',a:'100g',p:5},{n:'Nasiona chia',a:'(masz z T1)',p:0},{n:'Glicyna',a:'(masz z T1)',p:0}
]}
]
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPPLEMENTS & PSMF
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPPS=[
{t:'04:00',l:'üåÖ Rano (z shake)',items:['L-Tyrozyna 1000mg','Panax Ginseng 600mg','D3+K2','Vit C 1000mg','B12 1000mcg','PROZMA+','ALCAR 500mg','NAC 600mg','Shilajit','Boron 3mg']},
{t:'16:00',l:'üçΩÔ∏è Z posi≈Çkiem',items:['Omega-3 4√ókaps (2 z obiadem + 2 z kolacjƒÖ)']},
{t:'21:00',l:'üåô Wiecz√≥r',items:['MSM 2g + Glicyna 5g w wodzie 300ml']},
{t:'22:00',l:'üò¥ Przed snem',items:['Melatonina 3mg','PROZMA+ (2-ga dawka)']}
];
const PSMF_CHK=['Shake PSMF + Chia blend wieczorem ‚Üí rano wstrzƒÖ≈õnij','10 suplement√≥w po≈Çkniƒôtych','Elektrolity SHOT o 10:00 (shaker!)','Survival Drink (1L) w ciƒÖgu dnia','Gotowany kurczak 400g o 16:00 (ZERO oleju!)','Surowe warzywa (og√≥rek + sa≈Çata)','Mini-twar√≥g + bia≈Çka o 19:00 (opcja)','Min. 5L wody ≈ÇƒÖcznie','Samopoczucie OK ‚Äî brak zawrot√≥w','Melatonina + PROZMA+ przed snem'];

// MEAL PREP data
const PREP=[
// T1
['NIE wiecz√≥r: Blend shake PON (banana + 10g chia). Ugotuj jajka na 2 dni (10 szt). Odmierz twar√≥g.','WTO wiecz√≥r: Blend shake ≈öRO (banana + chia). Ugotuj jajka. Przygotuj serca (300g) ‚Äî mo≈ºesz ugotowaƒá z wieczora.','CZW wiecz√≥r: Blend shake PIƒÑ (banana + chia). Ugotuj jajka. Odmierz wƒÖtr√≥bkƒô 200g (rozmra≈ºaj w lod√≥wce).','SOB: PSMF ‚Äî minimalne gotowanie. Ugotuj pier≈õ 400g w wodzie. Blend shake PSMF + chia na wiecz√≥r.'],
// T2
['NIE wiecz√≥r: Blend shake PON (banana + chia). Ugotuj jajka 10 szt. Odmierz kasza gryczana + kalafior.','WTO wiecz√≥r: Blend shake ≈öRO (banana + chia). Ugotuj jajka. Przygotuj serca 300g.','CZW wiecz√≥r: Blend shake PIƒÑ (banana + chia). Ugotuj jajka. Przygotuj serca 300g (2-gi dzie≈Ñ serc w tygodniu).','SOB: PSMF day. Ugotuj pier≈õ. Blend shake.'],
// T3
['NIE wiecz√≥r: Blend shake PON (banana + chia). Ugotuj jajka. Przygotuj sos wƒôgierski (cebula + pomidory + ≈õmietana).','WTO wiecz√≥r: Blend shake ≈öRO (banana + chia). Ugotuj jajka. Przygotuj serca 300g + pieczarki.','CZW wiecz√≥r: Blend shake PIƒÑ (banana + chia). Ugotuj jajka. Zmiel/posiekaj 350g piersi na spaghetti.','SOB: PSMF. Ugotuj pier≈õ. Blend shake.'],
// T4
['NIE wiecz√≥r: Blend shake PON (banana + chia). Ugotuj jajka. Marynuj pier≈õ w jogurcie + curry (tandoori).','WTO wiecz√≥r: Blend shake ≈öRO (banana + chia). Ugotuj jajka. Przygotuj serca 300g.','CZW wiecz√≥r: Blend shake PIƒÑ (banana + chia). Ugotuj jajka. Przygotuj serca 300g + groszek.','SOB: PSMF. Ugotuj pier≈õ. Blend shake.']
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LS='dmv7';
let S;
function load(){try{S=JSON.parse(localStorage.getItem(LS))||{}}catch(e){S={}}
if(!S.w)S.w=[];if(!S.water)S.water=0;if(!S.waterDate)S.waterDate='';
if(!S.wk)S.wk=0;if(!S.day)S.day=0;
if(!S.shopChk)S.shopChk={};if(!S.suppTk)S.suppTk={};
if(!S.psmfChk)S.psmfChk={};if(!S.streak)S.streak=0;
if(!S.shopWk)S.shopWk=0;if(!S.prepWk)S.prepWk=0;if(!S.mealChk)S.mealChk={};if(!S.notifSent)S.notifSent={};
if(!S.pantry)S.pantry=[];
if(!S.mealOverrides)S.mealOverrides={};
if(!S.customProducts)S.customProducts=[];
if(!S.calcBasket)S.calcBasket=[];
}
function save(){localStorage.setItem(LS,JSON.stringify(S))}
function toast(m,ok=true){const t=document.getElementById('toast');t.className='toast on '+(ok?'ok':'er');document.getElementById('tIco').textContent=ok?'‚úÖ':'‚ùå';document.getElementById('tMsg').textContent=m;setTimeout(()=>t.classList.remove('on'),2200)}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navT(){document.getElementById('nav').classList.toggle('on');document.getElementById('ov').classList.toggle('on');const b=document.getElementById('mbtn');b.classList.toggle('x');b.textContent=b.classList.contains('x')?'‚úï':'‚ò∞'}
function navC(){document.getElementById('nav').classList.remove('on');document.getElementById('ov').classList.remove('on');const b=document.getElementById('mbtn');b.classList.remove('x');b.textContent='‚ò∞'}
function go(id){document.querySelectorAll('.sec').forEach(s=>s.classList.remove('on'));document.getElementById(id).classList.add('on');document.querySelectorAll('.nbtn').forEach(b=>{b.classList.toggle('on',b.dataset.s===id)});navC();vib(HAP.nav)}
document.querySelectorAll('.nbtn').forEach(b=>b.addEventListener('click',()=>go(b.dataset.s)));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEEK SELECTOR (shared)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renWeekSel(id,cur,cb){
let h='';for(let i=0;i<4;i++) h+=`<div class="ws ${cur===i?'on':''}" onclick="${cb}(${i})">T${i+1}</div>`;
document.getElementById(id).innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updDash(){
const di=getCurDi();
const wk=getCurWk();
const d=WEEKS[wk][di];
let totKc=0,totB=0,totW=0,totT=0;
d.meals.forEach((_,mi)=>{const eff=getMealData(wk,di,mi);totKc+=eff.kcal;totB+=eff.b;totW+=eff.w;totT+=eff.t});
document.getElementById('dKc').textContent=totKc;
document.getElementById('dP').textContent=totB;
document.getElementById('dW').textContent=totW;
document.getElementById('dT').textContent=totT;
const bg=document.getElementById('dayBdg');bg.textContent=d.bdgT;bg.className='badge '+d.bdg;
document.getElementById('todD').textContent=new Date().toLocaleDateString('pl-PL',{weekday:'long',day:'numeric',month:'short'});
document.getElementById('hWk').textContent=S.wk+1;
let h='';const cwk=getCurWk();d.meals.forEach((m,mi)=>{
const done=isMealDone(mi);
const eff=getMealData(wk,di,mi);
const isOvr=hasMealOverride(wk,di,mi);
h+=`<div class="mc ${m.cls}" style="${done?'opacity:.4':''}">
<div class="mt">${eff.time}</div><div class="mn">${eff.name}${isOvr?'<span class="override-badge">‚úèÔ∏è</span>':''}</div>
<div class="mm"><span class="mbdg kc">${eff.kcal} kcal</span><span class="mbdg bp">${eff.b}g B</span></div>
<div class="mchk-row"><button class="mchk-btn ${done?'done':''}" onclick="event.stopPropagation();toggleMeal(${cwk},${getCurDi()},${mi})">${done?'‚úÖ Zjedzone':'‚òê Oznacz'}</button>
<button class="btn sm out" onclick="event.stopPropagation();showMealIngs(${cwk},${di},${mi})" style="font-size:.72em;padding:5px 8px">üì¶ Sk≈Çadniki</button>
<button class="btn sm out" onclick="event.stopPropagation();showMealRecipe(${cwk},${di},${mi})" style="font-size:.72em;padding:5px 8px">üìñ Przepis</button>
<button class="btn sm out" onclick="event.stopPropagation();mealEdit(${wk},${di},${mi})" style="font-size:.72em;padding:5px 8px">‚úèÔ∏è Edytuj</button>
</div></div>`;});
document.getElementById('todM').innerHTML=h;
updDashPantry();
const td=new Date().toDateString();if(S.waterDate!==td){S.water=0;S.waterDate=td;save()}
document.getElementById('dWat').textContent=(S.water/1000).toFixed(1);
document.getElementById('hw').textContent=(S.water/1000).toFixed(1);
if(S.w.length){const last=S.w[S.w.length-1].w;document.getElementById('hwt').textContent=last.toFixed(1);document.getElementById('cWt').textContent=last.toFixed(1);const lost=Math.max(0,(100-last)).toFixed(1);const left=Math.max(0,(last-82)).toFixed(1);document.getElementById('lostK').textContent=lost;document.getElementById('leftK').textContent=left;const pct=Math.min(100,Math.max(0,(100-last)/(100-82)*100));document.getElementById('pRing').setAttribute('stroke-dashoffset',440-(440*pct/100));}
document.getElementById('dStr').textContent=S.streak;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// JAD≈ÅOSPIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setWk(i){S.wk=i;save();renWeekSel('weekSel',S.wk,'setWk');renPlan();updDash()}
function setDay(i){S.day=i;save();renPlan()}
function renPlan(){
renWeekSel('weekSel',S.wk,'setWk');
['sc1','sc2','sc3'].forEach((id,i)=>{const el=document.getElementById(id);if(el)el.className='scale-btn'+(SCALE===i+1?' on':'');});
let h='';WEEKS[S.wk].forEach((d,i)=>{h+=`<button class="tab ${d.cls} ${S.day===i?'on':''}" onclick="setDay(${i})">${d.n}</button>`});
document.getElementById('dayTabs').innerHTML=h;
const d=WEEKS[S.wk][S.day];
// Calculate day totals respecting overrides
let dayKcal=0,dayB=0,dayW=0,dayT=0;
d.meals.forEach((m,mi)=>{
const eff=getMealData(S.wk,S.day,mi);
dayKcal+=eff.kcal;dayB+=eff.b;dayW+=eff.w;dayT+=eff.t;
});
let c=`<div class="al ${d.bdg==='psm'?'err':d.bdg==='ref'?'ok':d.bdg==='org'?'info':'info'}" style="margin-bottom:12px"><strong>${d.bdgT}</strong> ‚Äî ${dayKcal} kcal | ${dayB}g B | ${dayW}g W | ${dayT}g T</div>`;
d.meals.forEach((m,mi)=>{
const eff=getMealData(S.wk,S.day,mi);
const isOvr=hasMealOverride(S.wk,S.day,mi);
const scaledIng=scaleIng(eff.ing);
c+=`<div class="mc ${m.cls}"><div class="mt">${eff.time} | ${eff.name}${isOvr?'<span class="override-badge">‚úèÔ∏è edytowane</span>':''}</div>
<div class="mm"><span class="mbdg kc">${SCALE>1?Math.round(eff.kcal*SCALE):eff.kcal} kcal</span><span class="mbdg bp">${SCALE>1?Math.round(eff.b*SCALE):eff.b}g B</span>${eff.w?`<span class="mbdg wg">${SCALE>1?Math.round(eff.w*SCALE):eff.w}g W</span>`:''}<span class="mbdg tl">${SCALE>1?Math.round(eff.t*SCALE):eff.t}g T</span></div>
<div class="mi">${scaledIng.replace(/\n/g,'<br>')}</div>
${eff.recipe?`<details style="margin-top:6px"><summary style="color:var(--or);cursor:pointer;font-size:.82em;font-weight:600">üìñ Przepis</summary>
<div style="margin-top:5px;font-size:.82em;color:var(--t2);padding:6px;background:var(--bg3);border-radius:6px">${eff.recipe}<br><button class="btn sm out" style="margin-top:6px" onclick="event.stopPropagation();speakRecipe('${eff.name.replace(/'/g,"\\'")} ‚Äî ${eff.recipe.replace(/'/g,"\\'")}')">üîä Czytaj na g≈Ços</button></div></details>`:''}
<div style="margin-top:6px;display:flex;gap:4px;flex-wrap:wrap">
<button class="btn sm out" onclick="mealEdit(${S.wk},${S.day},${mi})" style="font-size:.72em">‚úèÔ∏è Edytuj danie</button>
${isOvr?`<button class="btn sm out" onclick="mealRevert(${S.wk},${S.day},${mi})" style="font-size:.72em;color:var(--rd)">‚Ü©Ô∏è Przywr√≥ƒá orygina≈Ç</button>`:''}
</div></div>`;});
c+=`<div class="msbar"><div class="i"><div class="l">Kcal</div><div class="v">${dayKcal}</div></div><div class="i"><div class="l">Bia≈Çko</div><div class="v">${dayB}g</div></div><div class="i"><div class="l">Wƒôgle</div><div class="v">${dayW}g</div></div><div class="i"><div class="l">T≈Çuszcz</div><div class="v">${dayT}g</div></div></div>`;
document.getElementById('dayC').innerHTML=c;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ZAKUPY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setShopWk(i){S.shopWk=i;save();renShop()}
function renShop(){
renWeekSel('shopWeekSel',S.shopWk,'setShopWk');
document.getElementById('shopWkLbl').textContent='Tydzie≈Ñ '+(S.shopWk+1);
const shop=SHOPPING[S.shopWk];
let h='',tot=0,full=0;
shop.forEach((cat,ci)=>{
const ck=`w${S.shopWk}c${ci}`;const col=S.shopChk[ck+'_col'];
h+=`<div class="scat"><div class="sh ${col?'col':''}" onclick="shopCat('${ck}')"><span>${cat.i}</span><span>${cat.n}</span><span class="arr">‚ñº</span></div><div class="sitems ${col?'hid':''}">`;
cat.items.forEach((it,ii)=>{
const ik=`w${S.shopWk}-${ci}-${ii}`;const ch=S.shopChk[ik];full+=it.p;if(!ch)tot+=it.p;
h+=`<div class="si ${ch?'chk':''}"><div class="schk ${ch?'on':''}" onclick="shopIt('${ik}')"></div><span class="sn">${it.n}</span><span class="sq">${it.a}</span><span class="sp">${it.p>0?it.p+' z≈Ç':'-'}</span></div>`;});
h+=`</div></div>`;});
document.getElementById('shopC').innerHTML=h;
document.getElementById('shopTot').textContent=tot+' z≈Ç / '+full+' z≈Ç';
}
function shopCat(k){S.shopChk[k+'_col']=!S.shopChk[k+'_col'];save();renShop()}
function shopIt(k){
// If unchecking, just toggle
if(S.shopChk[k]){
S.shopChk[k]=false;save();renShop();return;
}
// Parse the item info from the key: w{wk}-{ci}-{ii}
const parts=k.replace(/^w/,'').split('-').map(Number);
const wk=parts[0],ci=parts[1],ii=parts[2];
const shop=SHOPPING[wk];
if(!shop||!shop[ci]||!shop[ci].items[ii])return;
const item=shop[ci].items[ii];
const cat=shop[ci];
const raw=item.a.trim();

// Items with (masz) or price 0 - just check off
if(raw.startsWith('(')||item.p===0){
S.shopChk[k]=true;save();renShop();vib(HAP.done);return;
}

const parsed=parseShopAmt(raw);
if(!parsed){S.shopChk[k]=true;save();renShop();vib(HAP.done);return}

modalOpen(
'<h3>üõí '+item.n+'</h3>'+
'<div class="mbody">'+
'<p style="color:var(--t2);font-size:.88em;margin-bottom:12px">Lista: <strong>'+item.a+'</strong></p>'+
'<div class="mbtns" style="margin-bottom:12px">'+
'<button class="btn gr" onclick="shopConfirm(\''+k+'\','+parsed.amt+',\''+parsed.unit+'\',\''+item.n.replace(/'/g,"\\'")+'\',\''+cat.n.replace(/'/g,"\\'")+'\',\''+cat.i+'\',true)">‚úÖ Kupi≈Çem ca≈Ço≈õƒá</button>'+
'</div>'+
'<div style="border-top:1px solid var(--brd);padding-top:10px">'+
'<p style="color:var(--t3);font-size:.78em;margin-bottom:6px">Lub wpisz ile kupi≈Çe≈õ:</p>'+
'<div class="fr"><div class="ig"><label>Ilo≈õƒá</label><input type="number" id="shopCustomAmt" step="0.01" value="'+parsed.amt+'" style="width:100px"></div>'+
'<div class="ig"><label>Jedn.</label><input type="text" id="shopCustomUnit" value="'+parsed.unit+'" style="width:80px" readonly></div>'+
'<button class="btn sm" onclick="shopConfirm(\''+k+'\',parseFloat(document.getElementById(\'shopCustomAmt\').value),\''+parsed.unit+'\',\''+item.n.replace(/'/g,"\\'")+'\',\''+cat.n.replace(/'/g,"\\'")+'\',\''+cat.i+'\',false)" style="height:38px">üíæ</button></div>'+
'</div>'+
'</div>'+
'<div class="mbtns" style="margin-top:10px"><button class="btn out" onclick="modalClose()">Anuluj</button></div>'
);
}

function shopConfirm(k,amt,unit,name,catName,catIcon,isFull){
if(isNaN(amt)||amt<=0){toast('Nieprawid≈Çowa ilo≈õƒá',false);return}
S.shopChk[k]=true;
// Add to pantry
pantryAdd(name,amt,unit,catName,catIcon);
// Mark as loaded from this specific purchase
S['pantry-loaded-'+k]=true;
save();renShop();renPantry();modalClose();
vib(HAP.done);
toast(name+': '+(isFull?'ca≈Ço≈õƒá':''+amt+' '+unit)+' ‚Üí spi≈ºarnia ‚úì');
}
function shopRst(){const wk=S.shopWk;Object.keys(S.shopChk).forEach(k=>{if(k.startsWith('w'+wk))delete S.shopChk[k]});save();renShop();toast('Lista zresetowana')}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WAGA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addW(){const w=parseFloat(document.getElementById('wIn').value);const d=document.getElementById('dIn').value;if(!w||w<50||w>200){toast('Waga 50-200',false);return}if(!d){toast('Wybierz datƒô',false);return}
const ex=S.w.findIndex(x=>x.d===d);if(ex>=0)S.w[ex].w=w;else S.w.push({d,w});S.w.sort((a,b)=>new Date(a.d)-new Date(b.d));save();renWaga();updDash();toast(w+' kg ‚úì');document.getElementById('wIn').value=''}
function delW(d){S.w=S.w.filter(x=>x.d!==d);save();renWaga();updDash();toast('Usuniƒôto')}
function renWaga(){renHist();renStats();renChart()}
function renHist(){const box=document.getElementById('wHist');if(!S.w.length){box.innerHTML='<p style="color:var(--t3);text-align:center;padding:14px">Brak pomiar√≥w</p>';return}
let h='';[...S.w].reverse().forEach((e,i,a)=>{const prev=a[i+1];const ch=prev?(e.w-prev.w).toFixed(1):0;const cls=ch<0?'dn':ch>0?'up':'';const sg=ch>0?'+':'';
h+=`<div class="hi"><span class="dt">${new Date(e.d).toLocaleDateString('pl-PL',{day:'numeric',month:'short'})}</span><span class="wt">${e.w.toFixed(1)} kg</span><span class="ch ${cls}">${sg}${ch} kg</span><button class="del" onclick="delW('${e.d}')">üóëÔ∏è</button></div>`});
box.innerHTML=h}
function renStats(){if(!S.w.length)return;const f=S.w[0].w,l=S.w[S.w.length-1].w,lo=Math.min(...S.w.map(x=>x.w));
const d0=new Date(S.w[0].d),dL=new Date(S.w[S.w.length-1].d);
const wks=Math.max(1,(dL-d0)/(7*86400000));
const avg=((f-l)/wks).toFixed(1);const left=l-82;const days=left>0?Math.ceil(left/Math.max(0.5,parseFloat(avg))*7):0;
document.getElementById('sStr').textContent=f.toFixed(1);document.getElementById('sLow').textContent=lo.toFixed(1);document.getElementById('sAvg').textContent=avg;document.getElementById('sDays').textContent=days>0?days:'‚Äî'}
function renChart(){const cv=document.getElementById('wChart');const ctx=cv.getContext('2d');const W=cv.parentElement.clientWidth-28;const H=195;cv.width=W;cv.height=H;ctx.fillStyle='#1a2336';ctx.fillRect(0,0,W,H);
if(S.w.length<2){ctx.fillStyle='#475569';ctx.font='12px Outfit';ctx.textAlign='center';ctx.fillText('Dodaj min. 2 pomiary',W/2,H/2);return}
const data=S.w.slice(-30);const vals=data.map(d=>d.w);const mn=Math.min(...vals)-1,mx=Math.max(...vals)+1;
const p={t:16,r:16,b:24,l:44};const gW=W-p.l-p.r,gH=H-p.t-p.b;
ctx.strokeStyle='#243048';ctx.lineWidth=1;
for(let i=0;i<=4;i++){const y=p.t+gH*i/4;ctx.beginPath();ctx.moveTo(p.l,y);ctx.lineTo(W-p.r,y);ctx.stroke();ctx.fillStyle='#475569';ctx.font='9px JetBrains Mono';ctx.textAlign='right';ctx.fillText((mx-(mx-mn)*i/4).toFixed(1),p.l-5,y+3)}
const gr=ctx.createLinearGradient(0,p.t,0,H-p.b);gr.addColorStop(0,'rgba(255,107,43,.2)');gr.addColorStop(1,'rgba(255,107,43,0)');
ctx.beginPath();ctx.moveTo(p.l,H-p.b);data.forEach((d,i)=>{const x=p.l+gW*i/(data.length-1);const y=p.t+gH*(1-(d.w-mn)/(mx-mn));ctx.lineTo(x,y)});ctx.lineTo(p.l+gW,H-p.b);ctx.closePath();ctx.fillStyle=gr;ctx.fill();
ctx.beginPath();data.forEach((d,i)=>{const x=p.l+gW*i/(data.length-1);const y=p.t+gH*(1-(d.w-mn)/(mx-mn));i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.strokeStyle='#ff6b2b';ctx.lineWidth=2;ctx.stroke();
data.forEach((d,i)=>{const x=p.l+gW*i/(data.length-1);const y=p.t+gH*(1-(d.w-mn)/(mx-mn));ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2);ctx.fillStyle='#ff6b2b';ctx.fill()});
const gY=p.t+gH*(1-(82-mn)/(mx-mn));if(gY>p.t&&gY<H-p.b){ctx.setLineDash([3,3]);ctx.strokeStyle='#34d399';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(p.l,gY);ctx.lineTo(W-p.r,gY);ctx.stroke();ctx.setLineDash([]);ctx.fillStyle='#34d399';ctx.font='8px JetBrains Mono';ctx.textAlign='left';ctx.fillText('CEL 82kg',p.l+3,gY-3)}}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WODA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function watA(ml){const td=new Date().toDateString();if(S.waterDate!==td){S.water=0;S.waterDate=td}
S.water=Math.max(0,S.water+ml);save();renWat();updDash();vib(ml>0?HAP.add:HAP.remove);toast(ml>0?`+${ml}ml`:`${ml}ml`)}
function watRst(){S.water=0;save();renWat();updDash();toast('Reset')}
function renWat(){document.getElementById('wCur').textContent=S.water;const pct=Math.min(100,Math.round(S.water/5000*100));document.getElementById('wPct').textContent=pct;document.getElementById('wLvl').style.height=pct+'%'}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPLEMENTY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renSupp(){const td=new Date().toDateString();let h='';SUPPS.forEach(s=>{
h+=`<div class="spblk"><div class="hd"><span class="tm">${s.t}</span><span class="lb">${s.l}</span></div><div class="pills">`;
s.items.forEach(it=>{const k=`${td}-${s.t}-${it}`;const tk=S.suppTk[k];
h+=`<div class="pill ${tk?'tk':''}" onclick="suppTog('${k}')">${it}</div>`});
h+=`</div></div>`});document.getElementById('suppC').innerHTML=h}
function suppTog(k){S.suppTk[k]=!S.suppTk[k];save();renSupp();vib(HAP.done);toast(S.suppTk[k]?'‚úì':'Odznaczono')}
function suppRst(){const td=new Date().toDateString();Object.keys(S.suppTk).forEach(k=>{if(k.startsWith(td))delete S.suppTk[k]});save();renSupp();toast('Reset')}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PSMF CHECKLIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renPsmf(){const td=new Date().toDateString();let h='';PSMF_CHK.forEach((it,i)=>{
const k=`${td}-psmf-${i}`;const ch=S.psmfChk[k];
h+=`<div class="qa" onclick="psmfTog('${k}')" style="border-left:3px solid ${ch?'var(--gr)':'var(--bg5)'}"><span class="i">${ch?'‚úÖ':'‚¨ú'}</span><div class="t"><div class="tt" style="${ch?'text-decoration:line-through;opacity:.4':''}">${it}</div></div></div>`});
document.getElementById('psmfChk').innerHTML=h}
function psmfTog(k){S.psmfChk[k]=!S.psmfChk[k];save();renPsmf()}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MEAL PREP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setPrepWk(i){S.prepWk=i;save();renPrep()}
function renPrep(){
renWeekSel('prepWeekSel',S.prepWk,'setPrepWk');
document.getElementById('prepWkLbl').textContent='Tydzie≈Ñ '+(S.prepWk+1);
let h='';const items=PREP[S.prepWk];
items.forEach((it,i)=>{
h+=`<div class="mp-day"><div class="mp-h">üìÖ Sesja ${i+1}</div><div class="mp-i">${it}</div></div>`;});
document.getElementById('prepC').innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let TM={s:0,run:false,int:null};
function tmSet(m){TM.s=m*60;tmUpd();document.getElementById('tmLbl').textContent=m+' min'}
function tmTog(){if(TM.run){clearInterval(TM.int);TM.run=false;document.getElementById('tmBtn').textContent='‚ñ∂Ô∏è Start';relWakeLock()}else{if(TM.s<=0)return;TM.run=true;reqWakeLock();document.getElementById('tmBtn').textContent='‚è∏Ô∏è Pauza';TM.int=setInterval(()=>{TM.s--;tmUpd();if(TM.s<=0){clearInterval(TM.int);TM.run=false;document.getElementById('tmBtn').textContent='‚ñ∂Ô∏è Start';relWakeLock();vib(HAP.timer);try{const c=new(window.AudioContext||window.webkitAudioContext)();const o=c.createOscillator();const g=c.createGain();o.connect(g);g.connect(c.destination);o.frequency.value=880;o.type='sine';g.gain.value=.2;o.start();setTimeout(()=>o.stop(),500)}catch(e){}if('Notification' in window&&Notification.permission==='granted'){try{new Notification('Diet Master V7',{body:'‚è∞ Timer sko≈Ñczony!',tag:'dm-timer'})}catch(e){}}toast('‚è∞ CZAS!')}},1000)}}
function tmRst(){clearInterval(TM.int);TM.run=false;TM.s=0;tmUpd();relWakeLock();document.getElementById('tmBtn').textContent='‚ñ∂Ô∏è Start';document.getElementById('tmLbl').textContent='Wybierz preset'}
function tmUpd(){const m=Math.floor(TM.s/60),s=TM.s%60;const t=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');document.getElementById('tmDisp').textContent=t;
const fs=document.getElementById('fsTime');if(fs)fs.textContent=t}



// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MEAL CHECKBOXES + COMPLIANCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mealKey(dayOffset){
const d=new Date();d.setDate(d.getDate()+dayOffset);
return d.toISOString().split('T')[0];
}
function toggleMeal(wi,di,mi){
const k=mealKey(0)+'-'+mi;
if(!S.mealChk)S.mealChk={};

// If unchecking ‚Äî add back to pantry
if(S.mealChk[k]){
S.mealChk[k]=false;
// Restore pantry amounts
const wk=getCurWk();
const meal=getMealData(wk,getCurDi(),mi);
if(meal&&meal.ing){
const ings=parseMealIngs(meal.ing);
ings.forEach(ing=>{
const match=findPantryMatch(ing.name);
if(!match)return;
const conv=convertToPantryUnit(ing.amt,ing.unit,match.unit);
if(conv===null)return;
const idx=S.pantry.findIndex(p=>p.id===match.id);
if(idx>=0){S.pantry[idx].amt=Math.round((S.pantry[idx].amt+conv)*100)/100}
});
}
save();updDash();renPlan();updCompliance();renPantry();
toast('Cofniƒôto (spi≈ºarnia przywr√≥cona)');vib(HAP.remove);updBadge();
return;
}

// Checking as done ‚Äî subtract from pantry
const wk=getCurWk();
const meal=getMealData(wk,getCurDi(),mi);

if(!meal||!meal.ing){
S.mealChk[k]=true;save();updDash();renPlan();updCompliance();
toast('Posi≈Çek ‚úì');vib(HAP.done);updBadge();return;
}

// Parse ingredients and check pantry
const ings=parseMealIngs(meal.ing);
const warnings=[];
const deductions=[];

ings.forEach(ing=>{
const match=findPantryMatch(ing.name);
if(!match){
// Not tracked in pantry ‚Äî skip silently
return;
}

// Convert units
const converted=convertToPantryUnit(ing.amt,ing.unit,match.unit);
if(converted===null)return;

if(match.amt<converted){
warnings.push(match.name+': masz '+fmtAmt(match.amt,match.unit)+', potrzeba '+fmtAmt(converted,match.unit));
}
deductions.push({pantryId:match.id,name:match.name,amt:converted,unit:match.unit});
});

if(warnings.length>0){
// Show warning but allow proceeding
let whtml='<h3>‚ö†Ô∏è Braki w spi≈ºarni</h3><div class="mbody">';
warnings.forEach(w=>{whtml+='<div class="pantry-warn">'+w+'</div>'});
whtml+='<p style="color:var(--t2);font-size:.85em;margin-top:8px">Czy mimo to oznaczyƒá jako ugotowane?</p></div>';
whtml+='<div class="mbtns"><button class="btn" onclick="mealConfirmCook(\''+k+'\','+JSON.stringify(deductions).replace(/"/g,'&quot;')+')">‚úÖ Tak, ugotowane</button>';
whtml+='<button class="btn out" onclick="modalClose()">Anuluj</button></div>';
modalOpen(whtml);
return;
}

// No warnings ‚Äî deduct directly
applyDeductions(deductions);
S.mealChk[k]=true;save();updDash();renPlan();updCompliance();renPantry();
toast('Posi≈Çek ‚úì (spi≈ºarnia zaktualizowana)');vib(HAP.done);updBadge();
}

function mealConfirmCook(k,deductions){
if(typeof deductions==='string')deductions=JSON.parse(deductions);
applyDeductions(deductions);
S.mealChk[k]=true;save();updDash();renPlan();updCompliance();renPantry();
modalClose();
toast('Posi≈Çek ‚úì (spi≈ºarnia zaktualizowana)');vib(HAP.done);updBadge();
}

function applyDeductions(deductions){
pantryInit();
deductions.forEach(d=>{
const idx=S.pantry.findIndex(p=>p.id===d.pantryId);
if(idx>=0){
S.pantry[idx].amt=Math.max(0,Math.round((S.pantry[idx].amt-d.amt)*100)/100);
}
});
}

// Parse meal ingredient string into [{name,amt,unit}]
function parseMealIngs(ingStr){
const result=[];
ingStr.split('¬∑').forEach(part=>{
part=part.trim();
if(!part||part.startsWith('+')||part.startsWith('supl')||part.startsWith('Shaker'))return;
const m=part.match(/^(\d+(?:[.,]\d+)?)\s*(g|kg|ml|szt|kaps|≈Çy≈º)?\s+(.+)/i);
if(m){
result.push({
amt:parseFloat(m[1].replace(',','.')),
unit:(m[2]||'szt').toLowerCase(),
name:m[3].trim()
});
}else{
// Try "3 jajka" or "5 bia≈Çek" pattern
const m2=part.match(/^(\d+)\s+(.+)/);
if(m2){
result.push({amt:parseInt(m2[1]),unit:'szt',name:m2[2].trim()});
}
}
});
return result;
}

// Match recipe ingredient name to pantry item
// Returns pantry item or null
function dePolish(s){
return s.replace(/ƒÖ/g,'a').replace(/ƒá/g,'c').replace(/ƒô/g,'e').replace(/≈Ç/g,'l').replace(/≈Ñ/g,'n').replace(/√≥/g,'o').replace(/≈õ/g,'s').replace(/≈∫/g,'z').replace(/≈º/g,'z').replace(/ƒÑ/g,'A').replace(/ƒÜ/g,'C').replace(/ƒò/g,'E').replace(/≈Å/g,'L').replace(/≈É/g,'N').replace(/√ì/g,'O').replace(/≈ö/g,'S').replace(/≈π/g,'Z').replace(/≈ª/g,'Z');
}
function findPantryMatch(ingName){
pantryInit();
if(!S.pantry.length)return null;
const n=dePolish(ingName.toLowerCase()
.replace(/mro≈ºon[yaei]/gi,'')
.replace(/surow[yaei]/gi,'')
.replace(/gotowan[yaei]/gi,'')
.replace(/mielon[yaei]/gi,'')
.trim());

// Mapping: recipe name fragments ‚Üí pantry name fragments (all ASCII after dePolish)
const MAP=[
[/piers|kurczak/i, /piers|kurczak/i],
[/serca/i, /serca/i],
[/watrobk/i, /watrobk/i],
[/jaj|biale?k/i, /jajka/i],
[/twarog|twaroz/i, /twarog/i],
[/ryz\s*basmat/i, /ryz\s*basmat/i],
[/ryz/i, /ryz/i],
[/kasza\s*gryczana/i, /kasza\s*gryczana/i],
[/kasza\s*jaglan/i, /kasza\s*jaglan/i],
[/makaron|spaghetti|penne/i, /makaron|spaghetti/i],
[/platki\s*owsian/i, /platki/i],
[/kuskus/i, /kuskus/i],
[/bulgur/i, /bulgur/i],
[/ziemniak/i, /ziemniak/i],
[/brokul/i, /brokul/i],
[/szpinak/i, /szpinak/i],
[/mix\s*warzyw|mieszanka\s*warzyw|warzyw/i, /mix\s*warzyw|mieszanka|warzyw/i],
[/marchew/i, /marchew/i],
[/cebul/i, /cebul/i],
[/ogorek|ogork/i, /ogork|ogorek/i],
[/salat/i, /salat/i],
[/groszek/i, /groszek/i],
[/fasolka/i, /fasolka/i],
[/pieczark/i, /pieczark/i],
[/kalafior/i, /kalafior/i],
[/cukinia/i, /cukinia/i],
[/pomidor|passata/i, /pomidor|passata/i],
[/banan/i, /banan/i],
[/owoc|lesne/i, /owoc/i],
[/cytry/i, /cytry/i],
[/mleko/i, /mleko/i],
[/olej/i, /olej/i],
[/miod/i, /miod/i],
[/sos\s*sojow/i, /sos\s*sojow/i],
[/smietan/i, /smietan/i],
[/jogurt/i, /jogurt/i],
[/chia/i, /chia/i],
[/glicyn/i, /glicyn/i],
];

for(const [recipeRx,pantryRx] of MAP){
if(recipeRx.test(n)){
const found=S.pantry.find(p=>pantryRx.test(dePolish(p.name.toLowerCase())));
if(found)return found;
}
}
// Fallback: direct name matching (for custom products in pantry)
const found2=S.pantry.find(p=>{
const pn=dePolish(p.name.toLowerCase());
return pn.includes(n.substring(0,4))||n.includes(pn.substring(0,4));
});
if(found2)return found2;
return null;
}

// Convert recipe units to pantry units
function convertToPantryUnit(amt,fromUnit,toUnit){
fromUnit=fromUnit.toLowerCase();
toUnit=toUnit.toLowerCase();
if(fromUnit===toUnit)return amt;

// g ‚Üí kg
if(fromUnit==='g'&&toUnit==='kg')return amt/1000;
if(fromUnit==='kg'&&toUnit==='g')return amt*1000;
// ml ‚Üí L
if(fromUnit==='ml'&&toUnit==='l')return amt/1000;
if(fromUnit==='l'&&toUnit==='ml')return amt*1000;

// szt ‚Üí opakowa≈Ñ (eggs: 1 opak = 10 szt)
if(fromUnit==='szt'&&toUnit==='opakowa≈Ñ')return amt/10;
if(fromUnit==='opakowa≈Ñ'&&toUnit==='szt')return amt*10;

// g ‚Üí szt (twar√≥g: 1szt = 250g)
if(fromUnit==='g'&&toUnit==='szt')return amt/250;
if(fromUnit==='szt'&&toUnit==='g')return amt*250;

// g ‚Üí g (same pack weight - for 500g bags, just pass through)
return amt;
}

function fmtAmt(amt,unit){
if(amt===Math.floor(amt))return amt+' '+unit;
return (Math.round(amt*100)/100)+' '+unit;
}
function isMealDone(mi){
const k=mealKey(0)+'-'+mi;
return S.mealChk&&S.mealChk[k];
}
function todayMealsDone(){
const d=WEEKS[getCurWk()][getCurDi()];
let done=0;
d.meals.forEach((m,i)=>{if(isMealDone(i))done++});
return {done,total:d.meals.length};
}
function getCurDi(){const dow=new Date().getDay();return dow===0?6:dow-1;}
function getCurWk(){
if(S.startDate){
const start=new Date(S.startDate);const now=new Date();
start.setHours(0,0,0,0);now.setHours(0,0,0,0);
const days=Math.floor((now-start)/(86400000));
const weeks=Math.floor(days/7);
return weeks%4;
}
return S.wk;
}
function updCompliance(){
if(!S.mealChk)S.mealChk={};
const bar=document.getElementById('compBar');
const lbl=document.getElementById('compLbl');
const dayNames=['PON','WTO','≈öRO','CZW','PIƒÑ','SOB','NIE'];
let bh='',lh='',weekDone=0,weekTotal=0;
const today=new Date();const dow=today.getDay();const mondayOff=dow===0?-6:1-dow;
for(let i=0;i<7;i++){
const d=new Date(today);d.setDate(today.getDate()+mondayOff+i);
const dk=d.toISOString().split('T')[0];
const wi=getCurWk();const dayData=WEEKS[wi][i];
const total=dayData.meals.length;
let done=0;
dayData.meals.forEach((m,mi)=>{if(S.mealChk[dk+'-'+mi])done++});
const pct=total>0?Math.round(done/total*100):0;
weekDone+=done;weekTotal+=total;
const isToday=dk===mealKey(0);
const color=pct===100?'var(--gr)':pct>0?'var(--yl)':'var(--bg5)';
const border=isToday?';border:2px solid var(--or)':'';
bh+=`<div class="cbar-d" style="height:${Math.max(4,pct)}%;background:${color}${border}"><span class="cbar-v">${pct>0?pct+'%':''}</span></div>`;
lh+=`<span style="${isToday?'color:var(--or);font-weight:700':''}">${dayNames[i]}</span>`;
}
bar.innerHTML=bh;lbl.innerHTML=lh;
const weekPct=weekTotal>0?Math.round(weekDone/weekTotal*100):0;
document.getElementById('compPct').textContent=weekPct+'% ten tydzie≈Ñ';
// Update streak
const {done:td,total:tt}=todayMealsDone();
document.getElementById('dStr').textContent=td+'/'+tt;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTO-WEEK ROTATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function awUpdate(){
if(S.startDate){
const wk=getCurWk();
const di=getCurDi();
const dayNames=['PON','WTO','≈öRO','CZW','PIƒÑ','SOB','NIE'];
const start=new Date(S.startDate);const now=new Date();
start.setHours(0,0,0,0);now.setHours(0,0,0,0);
const totalDays=Math.floor((now-start)/86400000)+1;
document.getElementById('awWk').textContent='T'+(wk+1);
document.getElementById('awDay').textContent=dayNames[di]+' ‚Ä¢ Dzie≈Ñ '+totalDays;
document.getElementById('awSet').textContent='üìÖ '+S.startDate;
// Sync week selector
if(S.wk!==wk){S.wk=wk;save();renPlan();renShop();renPrep();}
}else{
document.getElementById('awWk').textContent='T'+(S.wk+1);
document.getElementById('awDay').textContent='Ustaw datƒô startu ‚Üí';
document.getElementById('awSet').textContent='‚öôÔ∏è Ustaw start';
}
}
function awConfig(){
document.getElementById('awModal').style.display='flex';
if(S.startDate)document.getElementById('awDate').value=S.startDate;
else document.getElementById('awDate').value=new Date().toISOString().split('T')[0];
}
function awSave(){
const d=document.getElementById('awDate').value;
if(!d){toast('Wybierz datƒô',false);return}
S.startDate=d;save();
awClose();awUpdate();updDash();renPlan();renShop();renPrep();updCompliance();
toast('Auto-rotacja w≈ÇƒÖczona ‚úì');
}
function awClear(){
delete S.startDate;save();
awClose();awUpdate();updDash();
toast('Auto-rotacja wy≈ÇƒÖczona');
}
function awClose(){document.getElementById('awModal').style.display='none'}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RECIPE SCALING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let SCALE=1;
function setScale(s){
SCALE=s;renPlan();
toast(s===1?'Porcja √ó1':'Porcja √ó'+s+' (batch cooking)');
}
function scaleIng(ing){
if(SCALE===1)return ing;
return ing.replace(/(\d+(?:[.,]\d+)?)\s*(g|kg|ml|szt|kaps|≈Çy≈º)/g,(m,n,u)=>{
const num=parseFloat(n.replace(',','.'));
const scaled=Math.round(num*SCALE);
return scaled+u;
});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PWA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MEAL INFO MODALS (dashboard buttons)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showMealIngs(wk,di,mi){
const meal=getMealData(wk,di,mi);
if(!meal)return;
const ings=parseMealIngs(meal.ing);
let h='<h3>üì¶ '+meal.name+'</h3><div class="mbody"><p style="color:var(--t3);font-size:.78em;margin-bottom:8px">Sk≈Çadniki:</p>';
ings.forEach(ing=>{
const match=findPantryMatch(ing.name);
let status='';
if(match){
const conv=convertToPantryUnit(ing.amt,ing.unit,match.unit);
if(match.amt>=conv)status='<span style="color:var(--gr)"> ‚úì masz '+fmtAmt(match.amt,match.unit)+'</span>';
else status='<span style="color:var(--rd)"> ‚ö† masz '+fmtAmt(match.amt,match.unit)+'</span>';
}else{
status='<span style="color:var(--t3)"> (brak w spi≈ºarni)</span>';
}
h+='<div style="padding:4px 0;border-bottom:1px solid var(--brd);font-size:.85em"><strong>'+ing.amt+' '+ing.unit+'</strong> '+ing.name+status+'</div>';
});
h+='</div><div class="mbtns"><button class="btn out" onclick="modalClose()">Zamknij</button></div>';
modalOpen(h);
}

function showMealRecipe(wk,di,mi){
const meal=getMealData(wk,di,mi);
if(!meal)return;
let h='<h3>üìñ '+meal.name+'</h3><div class="mbody">';
if(meal.recipe){
h+='<div style="font-size:.88em;color:var(--t2);line-height:1.7">'+meal.recipe+'</div>';
}else{
h+='<div style="color:var(--t3);font-size:.85em">Brak przepisu dla tego posi≈Çku.</div>';
}
h+='</div><div class="mbtns"><button class="btn out" onclick="modalClose()">Zamknij</button></div>';
modalOpen(h);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SMART SYNC: PLAN NEEDS vs PANTRY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Calculate total ingredients needed for a specific week (all 7 days)
function calcPlanNeeds(wk){
const needs={};
const week=WEEKS[wk];
if(!week)return needs;
week.forEach((day,di)=>{
day.meals.forEach(m=>{
if(!m.ing)return;
const ings=parseMealIngs(m.ing);
ings.forEach(ing=>{
const match=findPantryMatchByName(ing.name);
if(!match)return;
const conv=convertToPantryUnit(ing.amt,ing.unit,match.unit);
if(conv===null)return;
const nk=match.nk;
if(!needs[nk])needs[nk]={name:match.displayName,unit:match.unit,amt:0};
needs[nk].amt+=conv;
});
});
});
// Round
Object.values(needs).forEach(n=>{n.amt=Math.round(n.amt*100)/100});
return needs;
}

// Like findPantryMatch but returns standardized info (not pantry state)
function findPantryMatchByName(ingName){
const n=dePolish(ingName.toLowerCase()
.replace(/mro≈ºon[yaei]/gi,'').replace(/surow[yaei]/gi,'')
.replace(/gotowan[yaei]/gi,'').replace(/mielon[yaei]/gi,'').trim());

const MAP2=[
['piers|kurczak','Pier≈õ kurczaka','kg'],
['serca','Serca kurczaka','g'],
['watrobk','WƒÖtr√≥bka drobiowa','g'],
['jaj|biale?k','Jajka M (10szt)','opakowa≈Ñ'],
['twarog|twaroz','Twar√≥g Pilos 0%','szt'],
['ryz\\s*basmat','Ry≈º basmati','g'],
['ryz','Ry≈º bia≈Çy','g'],
['kasza\\s*gryczana','Kasza gryczana','g'],
['kasza\\s*jaglan','Kasza jaglana','g'],
['makaron|spaghetti|penne','Makaron','g'],
['platki\\s*owsian','P≈Çatki owsiane','g'],
['kuskus','Kuskus','g'],
['bulgur','Bulgur','g'],
['ziemniak','Ziemniaki','g'],
['brokul','Broku≈Çy mro≈ºone','g'],
['szpinak','Szpinak mro≈ºony','g'],
['mix\\s*warzyw|mieszanka|warzyw','Mix warzywny mro≈ºony','kg'],
['marchew','Marchewka','g'],
['cebul','Cebula','g'],
['ogorek|ogork','Og√≥rki','g'],
['salat','Sa≈Çata lodowa','szt'],
['groszek','Groszek mro≈ºony','g'],
['fasolka','Fasolka szparagowa','g'],
['pieczark','Pieczarki','g'],
['kalafior','Kalafior mro≈ºony','g'],
['cukinia','Cukinia','g'],
['pomidor|passata','Pomidory','g'],
['banan','Banany','g'],
['owoc|lesne','Owoce le≈õne mro≈ºone','g'],
['cytry','Cytryny','szt'],
['mleko','Mleko 0.5%','L'],
['olej','Olej rzepakowy','ml'],
['miod','Mi√≥d','g'],
['sos\\s*sojow','Sos sojowy','ml'],
['smietan','≈ömietana 12%','ml'],
['jogurt','Jogurt 0%','g'],
['chia','Nasiona chia','g'],
['glicyn','Glicyna','g'],
];

for(const [rx,displayName,unit] of MAP2){
if(new RegExp(rx,'i').test(n)){
const nk=dePolish(displayName.toLowerCase());
return {nk,displayName,unit};
}
}
// Fallback: check custom products
if(S.customProducts){
for(const cp of S.customProducts){
const cpn=dePolish(cp.name.toLowerCase());
if(cpn.includes(n.substring(0,4))||n.includes(cpn.substring(0,4))){
const nk=cpn;
const unit=cp.b>cp.w?'g':'g';
return {nk,displayName:cp.name,unit};
}
}
}
return null;
}

// Compare pantry vs current week needs
function pantryDeficit(){
pantryInit();
const wk=getCurWk();
const needs=calcPlanNeeds(wk);
const result=[];
Object.keys(needs).forEach(nk=>{
const need=needs[nk];
// Find in pantry
const match=S.pantry.find(p=>dePolish(p.name.toLowerCase()).includes(nk.substring(0,6)));
const have=match?convertToPantryUnit(match.amt,match.unit,need.unit)||0:0;
const deficit=need.amt-have;
result.push({name:need.name,unit:need.unit,need:need.amt,have,deficit});
});
return result;
}

// Dashboard pantry widget
function updDashPantry(){
pantryInit();
const el=document.getElementById('dashPantryStatus');
const lbl=document.getElementById('dashPantryLbl');
if(!el)return;

if(!S.pantry.length){
lbl.textContent='pusta';
el.innerHTML='<div style="color:var(--t3);font-size:.82em;padding:4px 0">Dodaj produkty z zakup√≥w aby ≈õledziƒá zapasy.</div>';
return;
}

const total=S.pantry.length;
let low=0,empty=0;
S.pantry.forEach(p=>{
if(p.amt===0)empty++;
else if((p.unit==='kg'||p.unit==='L')&&p.amt<0.2)low++;
else if(p.unit==='szt'&&p.amt<=1)low++;
else if(p.unit==='g'&&p.amt<100)low++;
else if(p.unit==='ml'&&p.amt<50)low++;
else if(p.unit==='opakowa≈Ñ'&&p.amt<=1)low++;
});

lbl.textContent=total+' produkt√≥w';
let h='<div style="display:flex;gap:8px;font-size:.78em">';
h+='<span style="color:var(--gr)">‚úì '+Math.max(0,total-low-empty)+' OK</span>';
if(low>0)h+='<span style="color:var(--yl)">‚ö† '+low+' ma≈Ço</span>';
if(empty>0)h+='<span style="color:var(--rd)">‚úï '+empty+' brak</span>';
h+='</div>';

// Show top 3 deficits
const deficits=[];
S.pantry.forEach(p=>{
if(p.amt===0)deficits.push(p.name);
});
if(deficits.length>0){
h+='<div style="color:var(--rd);font-size:.75em;margin-top:4px">Brakuje: '+deficits.slice(0,3).join(', ')+(deficits.length>3?' +':'')+'</div>';
}

el.innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function modalOpen(html){
document.getElementById('modal').innerHTML=html;
document.getElementById('modalOv').classList.add('on');
}
function modalClose(){
document.getElementById('modalOv').classList.remove('on');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SPI≈ªARNIA (PANTRY)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// S.pantry = [{id,name,amt,unit,cat,catIcon}]
function pantryInit(){
if(!S.pantry)S.pantry=[];
}

// Normalize name for matching
function normName(n){
return n.toLowerCase()
.replace(/\s*\(.*?\)\s*/g,'')
.replace(/pilos\s*/gi,'')
.replace(/mro≈ºon[yaei]\s*/gi,'')
.replace(/surow[yaei]\s*/gi,'')
.replace(/gotowan[yaei]\s*/gi,'')
.replace(/\s+/g,' ')
.trim();
}

function pantryFind(name,unit){
const nn=normName(name);
return S.pantry.findIndex(p=>normName(p.name)===nn && p.unit===unit);
}

function pantryAdd(name,amt,unit,cat,catIcon){
pantryInit();
const idx=pantryFind(name,unit);
if(idx>=0){
S.pantry[idx].amt=Math.round((S.pantry[idx].amt+amt)*100)/100;
}else{
S.pantry.push({id:Date.now(),name,amt:Math.round(amt*100)/100,unit,cat:cat||'Inne',catIcon:catIcon||'‚öôÔ∏è'});
}
save();renPantry();
}

function pantrySubtract(name,amt,unit){
pantryInit();
const idx=pantryFind(name,unit);
if(idx>=0){
S.pantry[idx].amt=Math.round((S.pantry[idx].amt-amt)*100)/100;
if(S.pantry[idx].amt<=0)S.pantry[idx].amt=0;
save();renPantry();
return true;
}
return false;
}

function pantryRemove(id){
pantryInit();
S.pantry=S.pantry.filter(p=>p.id!==id);
save();renPantry();vib(HAP.remove);toast('Usuniƒôto');
}

function pantryReset(){
modalOpen('<h3>üóëÔ∏è Resetuj spi≈ºarniƒô</h3><div class="mbody"><p style="color:var(--t2);font-size:.88em">UsunƒÖƒá <strong>wszystkie</strong> produkty z spi≈ºarni?</p></div><div class="mbtns"><button class="btn rd" onclick="S.pantry=[];save();renPantry();modalClose();toast(\'Spi≈ºarnia wyczyszczona\')">üóëÔ∏è Wyczy≈õƒá</button><button class="btn out" onclick="modalClose()">Anuluj</button></div>');
}

function pantryEdit(id){
pantryInit();
const p=S.pantry.find(x=>x.id===id);
if(!p)return;
modalOpen('<h3>‚úèÔ∏è Edytuj: '+p.name+'</h3><div class="mbody"><div class="ig"><label>Ilo≈õƒá ('+p.unit+')</label><input type="number" id="peAmt" step="0.1" value="'+p.amt+'"></div></div><div class="mbtns"><button class="btn" onclick="pantryEditSave('+id+')">üíæ Zapisz</button><button class="btn out" onclick="modalClose()">Anuluj</button></div>');
}

function pantryEditSave(id){
const v=parseFloat(document.getElementById('peAmt').value);
if(isNaN(v)||v<0){toast('Nieprawid≈Çowa ilo≈õƒá',false);return}
const idx=S.pantry.findIndex(p=>p.id===id);
if(idx>=0){S.pantry[idx].amt=Math.round(v*100)/100;save();renPantry()}
modalClose();toast('Zapisano ‚úì');vib(HAP.done);
}

function pantryAddManual(){
// Build product list from all SHOPPING data
const products=[];
const seen={};
SHOPPING.forEach(week=>{
week.forEach(cat=>{
cat.items.forEach(item=>{
const raw=item.a.trim();
if(raw.startsWith('('))return;
const nk=item.n.toLowerCase();
if(seen[nk])return;
seen[nk]=true;
const parsed=parseShopAmt(raw);
products.push({name:item.n,unit:parsed?parsed.unit:'szt',cat:cat.n,catIcon:cat.i});
});
});
});

let opts='<option value="">‚Äî wybierz produkt ‚Äî</option>';
let curCat='';
products.forEach((p,i)=>{
if(p.cat!==curCat){curCat=p.cat;opts+='<option disabled>‚îÄ‚îÄ‚îÄ‚îÄ '+p.catIcon+' '+p.cat+' ‚îÄ‚îÄ‚îÄ‚îÄ</option>'}
opts+='<option value="'+i+'">'+p.name+' ('+p.unit+')</option>';
});

modalOpen('<h3>‚ûï Dodaj do spi≈ºarni</h3><div class="mbody">'+
'<div class="ig"><label>Produkt z planu</label><select id="pmSel" onchange="pmSelChg()">'+opts+'</select></div>'+
'<div id="pmCustom" style="display:none"><div class="ig"><label>Lub wpisz w≈Çasny</label><input type="text" id="pmName" placeholder="np. Pier≈õ kurczaka"></div></div>'+
'<div class="fr" style="margin-top:8px"><div class="ig"><label>Ilo≈õƒá</label><input type="number" id="pmAmt" step="0.1" placeholder="np. 2.4"></div>'+
'<div class="ig"><label>Jednostka</label><select id="pmUnit"><option value="kg">kg</option><option value="g">g</option><option value="szt">szt</option><option value="opakowa≈Ñ">opakowa≈Ñ</option><option value="L">L</option><option value="ml">ml</option></select></div></div>'+
'<div style="margin-top:8px"><button class="btn sm out" onclick="document.getElementById(\'pmCustom\').style.display=\'block\'" style="font-size:.75em">‚úèÔ∏è Wpisz w≈Çasny produkt</button></div>'+
'</div><div class="mbtns"><button class="btn" onclick="pantryAddManualSave()">üíæ Dodaj</button><button class="btn out" onclick="modalClose()">Anuluj</button></div>');
window._pmProducts=products;
}

function pmSelChg(){
const sel=document.getElementById('pmSel');
const idx=parseInt(sel.value);
if(isNaN(idx))return;
const p=window._pmProducts[idx];
if(!p)return;
document.getElementById('pmUnit').value=p.unit;
}

function pantryAddManualSave(){
const selIdx=parseInt(document.getElementById('pmSel').value);
const customName=(document.getElementById('pmName')||{}).value||'';
const amt=parseFloat(document.getElementById('pmAmt').value);
const unit=document.getElementById('pmUnit').value;

let name='',cat='Inne',catIcon='‚öôÔ∏è';
if(!isNaN(selIdx)&&window._pmProducts&&window._pmProducts[selIdx]){
const p=window._pmProducts[selIdx];
name=p.name;cat=p.cat;catIcon=p.catIcon;
}else if(customName.trim()){
name=customName.trim();
}
if(!name){toast('Wybierz produkt lub wpisz nazwƒô',false);return}
if(isNaN(amt)||amt<=0){toast('Wpisz ilo≈õƒá',false);return}
pantryAdd(name,amt,unit,cat,catIcon);
modalClose();toast(name+' dodane ‚úì');vib(HAP.done);
}

// Smart sync: show what's missing for the week
function pantryShowSync(){
pantryInit();
const wk=getCurWk();
const needs=calcPlanNeeds(wk);
const box=document.getElementById('pantrySyncBox');
if(!box)return;

if(Object.keys(needs).length===0){
box.style.display='block';
box.innerHTML='<div class="al info">Brak danych o potrzebach tygodnia.</div>';
return;
}

let h='<div class="c" style="border-color:var(--brd2);margin-bottom:12px"><div class="ch"><div class="ico">üîÑ</div><h2>Sync: T'+(wk+1)+' potrzeby vs spi≈ºarnia</h2></div>';
let deficitCount=0,okCount=0;

// Already done meals today ‚Äî subtract their needs
const doneMeals={};
const di=getCurDi();
const today=WEEKS[wk][di];
if(today){
today.meals.forEach((m,mi)=>{
if(isMealDone(mi)){
const ings=parseMealIngs(m.ing);
ings.forEach(ing=>{
const inf=findPantryMatchByName(ing.name);
if(!inf)return;
const conv=convertToPantryUnit(ing.amt,ing.unit,inf.unit);
if(!doneMeals[inf.nk])doneMeals[inf.nk]=0;
doneMeals[inf.nk]+=conv||0;
});
}
});
}

Object.keys(needs).sort().forEach(nk=>{
const need=needs[nk];
// Find matching pantry item
let have=0;
const match=S.pantry.find(p=>{
const pnk=dePolish(p.name.toLowerCase());
return pnk.includes(nk.substring(0,5))||nk.includes(pnk.substring(0,5));
});
if(match){
have=convertToPantryUnit(match.amt,match.unit,need.unit)||0;
}

// Adjust need for already-eaten meals
const done=doneMeals[nk]||0;
const adjustedNeed=Math.max(0,need.amt-done);

const deficit=adjustedNeed-have;
if(deficit>0){
deficitCount++;
h+='<div style="display:flex;align-items:center;gap:6px;padding:5px 0;border-bottom:1px solid var(--brd);font-size:.82em">';
h+='<span style="color:var(--rd)">‚úï</span>';
h+='<span style="flex:1">'+need.name+'</span>';
h+='<span style="color:var(--t3)">masz: '+fmtAmt(have,need.unit)+'</span>';
h+='<span style="color:var(--rd);font-weight:700"> brak: '+fmtAmt(Math.round(deficit*100)/100,need.unit)+'</span>';
h+='</div>';
}else{
okCount++;
}
});

if(deficitCount===0){
h+='<div class="al ok" style="margin:0"><strong>‚úÖ Wszystko masz!</strong> Spi≈ºarnia pokrywa ca≈Çy tydzie≈Ñ '+(wk+1)+'.</div>';
}else{
h='<div class="c" style="border-color:var(--rd);margin-bottom:12px"><div class="ch"><div class="ico">üîÑ</div><h2>Brakuje na T'+(wk+1)+'</h2><span style="font-size:.78em;color:var(--t3)">'+okCount+' OK / '+deficitCount+' brak</span></div>'+h.split('</h2></div>').slice(1).join('</h2></div>');
}

h+='</div>';
box.style.display='block';
box.innerHTML=h;
}

// Load all checked items from current shopping week into pantry
function pantryFromShop(){
pantryInit();
const wk=S.shopWk;
const shop=SHOPPING[wk];
let added=0;
shop.forEach((cat,ci)=>{
cat.items.forEach((item,ii)=>{
const ik='w'+wk+'-'+ci+'-'+ii;
if(!S.shopChk||!S.shopChk[ik])return; // not checked
const raw=item.a.trim();
if(raw.startsWith('('))return;
const parsed=parseShopAmt(raw);
if(!parsed)return;
// Check if already in pantry from this exact shop check
const flagKey='pantry-loaded-'+ik;
if(S[flagKey])return;
pantryAdd(item.n,parsed.amt,parsed.unit,cat.n,cat.i);
S[flagKey]=true;
added++;
});
});
save();renPantry();
if(added>0){toast(added+' produkt√≥w dodanych ‚úì');vib(HAP.done)}
else{toast('Brak nowych zaznaczonych produkt√≥w',false)}
}

function parseShopAmt(raw){
const m=raw.match(/^([\d.,]+)\s*(.*)/);
if(!m)return null;
const amt=parseFloat(m[1].replace(',','.'));
let unit=m[2].trim().toLowerCase();
if(unit.includes('kg'))unit='kg';
else if(unit.includes('opakow'))unit='opakowa≈Ñ';
else if(unit.includes('szt'))unit='szt';
else if(unit.includes('ml'))unit='ml';
else if(unit==='l'||unit.includes('litr'))unit='L';
else if(unit.includes('g'))unit='g';
else unit='szt';
return {amt,unit};
}

function renPantry(){
pantryInit();
const el=document.getElementById('pantryList');
if(!el)return;

// Stats
let total=0,low=0,empty=0;
S.pantry.forEach(p=>{
total++;
if(p.amt===0)empty++;
else if(p.amt<0.2&&(p.unit==='kg'||p.unit==='L'))low++;
else if(p.amt<=1&&p.unit==='szt')low++;
else if(p.amt<100&&p.unit==='g')low++;
});
const pt=document.getElementById('pTotal');if(pt)pt.textContent=total;
const pl=document.getElementById('pLow');if(pl)pl.textContent=low;
const pe=document.getElementById('pEmpty');if(pe)pe.textContent=empty;

if(!S.pantry.length){el.innerHTML='<div style="color:var(--t3);text-align:center;padding:20px;font-size:.88em">Spi≈ºarnia pusta. Dodaj produkty z zakup√≥w lub rƒôcznie.</div>';return}

// Group by category
const cats={};
S.pantry.forEach(p=>{
const ck=p.cat||'Inne';
if(!cats[ck])cats[ck]={icon:p.catIcon||'‚öôÔ∏è',items:[]};
cats[ck].items.push(p);
});

let h='';
const catOrder=['BIA≈ÅKO','WƒòGLE','WARZYWA / OWOCE','WARZYWA','INNE'];
const sortedCats=Object.keys(cats).sort((a,b)=>{
const ai=catOrder.findIndex(c=>a.toUpperCase().includes(c));
const bi=catOrder.findIndex(c=>b.toUpperCase().includes(c));
return (ai<0?99:ai)-(bi<0?99:bi);
});

sortedCats.forEach(ck=>{
const cat=cats[ck];
h+='<div class="pantry-cat-hdr">'+cat.icon+' '+ck+'</div>';
cat.items.forEach(p=>{
let cls='';
if(p.amt===0)cls='empty';
else if((p.unit==='kg'||p.unit==='L')&&p.amt<0.2)cls='low';
else if(p.unit==='szt'&&p.amt<=1)cls='low';
else if(p.unit==='g'&&p.amt<100)cls='low';
else if(p.unit==='opakowa≈Ñ'&&p.amt<=1)cls='low';

let dispAmt=p.amt;
if(p.unit==='kg'||p.unit==='L')dispAmt=Math.round(p.amt*100)/100;
else dispAmt=Math.round(p.amt*10)/10;
if(dispAmt===Math.floor(dispAmt))dispAmt=Math.floor(dispAmt);

h+='<div class="pantry-item '+cls+'">';
h+='<div><div class="pi-name">'+p.name+'</div><div class="pi-cat">'+p.cat+'</div></div>';
h+='<div class="pi-amt">'+dispAmt+' '+p.unit+'</div>';
h+='<div class="pi-btns">';
h+='<button class="pi-btn" onclick="pantryEdit('+p.id+')" title="Edytuj">‚úèÔ∏è</button>';
h+='<button class="pi-btn del" onclick="pantryRemove('+p.id+')" title="Usu≈Ñ">üóëÔ∏è</button>';
h+='</div></div>';
});
});

el.innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HAPTIC PATTERNS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const HAP={
tap:[15],
done:[30,30,50],
add:[20,15,20],
remove:[10,10,10],
warn:[50,50,50,50,100],
timer:[200,100,200,100,400],
scan:[80],
shake:[40,40,80],
nav:[10]
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CUSTOM SHOPPING LIST GENERATOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let sgSelWk=0;
let sgSelected={}; // key: 'wk-day' ‚Üí bool

function sgInit(){
let wh='';for(let i=0;i<4;i++)wh+=`<div class="ws ${sgSelWk===i?'on':''}" onclick="sgSetWk(${i})" style="font-size:.75em;padding:6px">T${i+1}</div>`;
document.getElementById('sgWeekBtns').innerHTML=wh;
const dayNames=['PON','WTO','≈öRO','CZW','PIƒÑ','SOB','NIE'];
let dh='';WEEKS[sgSelWk].forEach((d,i)=>{
const k=sgSelWk+'-'+i;const sel=sgSelected[k];
dh+=`<div class="sg-day ${sel?'sel':''}" onclick="sgTogDay('${k}')">${d.n}<br><span style="font-size:.65em;opacity:.6">${d.bdgT}</span></div>`;
});
document.getElementById('sgDays').innerHTML=dh;
}
function sgSetWk(w){sgSelWk=w;sgInit()}
function sgTogDay(k){sgSelected[k]=!sgSelected[k];vib(HAP.tap);sgInit()}
function sgClear(){sgSelected={};sgInit();document.getElementById('sgResult').innerHTML='';vib(HAP.remove)}

function sgGenerate(){
const keys=Object.keys(sgSelected).filter(k=>sgSelected[k]);
if(!keys.length){toast('Zaznacz min. 1 dzie≈Ñ',false);return}

// Group selected days by week
const perWeek={};
keys.forEach(k=>{
const wk=parseInt(k.split('-')[0]);
if(!perWeek[wk])perWeek[wk]=0;
perWeek[wk]++;
});

// For each week, scale SHOPPING items by (selected_days / 7)
const merged={};  // key: "cat_idx-item_idx" or normalized name ‚Üí {name, amount_text, price, cat_icon, cat_name}

Object.keys(perWeek).forEach(wk=>{
const wi=parseInt(wk);
const ratio=perWeek[wi]/7;
const shop=SHOPPING[wi];
if(!shop)return;

shop.forEach((cat,ci)=>{
cat.items.forEach((item,ii)=>{
// Parse amount from string like "2.4 kg", "8 opakowa≈Ñ", "18 szt", "500g", "1L", "7 szt", "(masz)"
const raw=item.a.trim();
if(raw.startsWith('('))return; // skip "(masz)" items

const mk=wi+'-'+ci+'-'+ii;
const numMatch=raw.match(/^([\d.,]+)\s*(.*)/);

if(numMatch){
const baseAmt=parseFloat(numMatch[1].replace(',','.'));
const unit=numMatch[2].trim()||'szt';
const scaled=baseAmt*ratio;
const price=item.p*ratio;

// Try to merge same product across weeks
const normName=item.n.toLowerCase().replace(/\s*\(.*?\)\s*/g,'').trim();
const mergeKey=normName+'|'+unit;

if(!merged[mergeKey]){
merged[mergeKey]={
name:item.n,
amt:0,
unit:unit,
price:0,
catIcon:cat.i,
catName:cat.n,
catOrder:ci
};
}
merged[mergeKey].amt+=scaled;
merged[mergeKey].price+=price;
}
});
});
});

// Sort by category order
const sorted=Object.values(merged).sort((a,b)=>a.catOrder-b.catOrder);

// Render
let curCat='';
let totalPrice=0;
let h='<div style="margin-top:10px;font-size:.78em;color:var(--t3)">';
const weekList=Object.keys(perWeek).map(w=>'T'+(parseInt(w)+1)+': '+perWeek[w]+' dni').join(', ');
h+=weekList+'</div>';

sorted.forEach(it=>{
const catLabel=it.catIcon+' '+it.catName;
if(catLabel!==curCat){
curCat=catLabel;
h+='<div style="color:var(--or);font-weight:700;font-size:.82em;margin-top:10px;padding-top:6px;border-top:1px solid var(--brd)">'+catLabel+'</div>';
}

// Format amount nicely
let display='';
const amt=it.amt;
const u=it.unit.toLowerCase();

if(u.includes('kg')){
display=amt<1?(Math.round(amt*1000)+'g'):(Math.round(amt*10)/10+' kg');
}else if(u.includes('opakow')){
display=Math.ceil(amt)+' opakowa≈Ñ';
}else if(u==='szt'||u.includes('szt')){
display=Math.ceil(amt)+' szt';
}else if(u.includes('g')&&!u.includes('kg')){
const total=amt;
display=total>=1000?(Math.round(total/100)/10+' kg'):(Math.round(total)+'g');
}else if(u.includes('l')&&!u.includes('ml')){
display=Math.round(amt*10)/10+'L';
}else if(u.includes('ml')){
display=Math.round(amt)+'ml';
}else{
display=Math.round(amt*10)/10+' '+it.unit;
}

const price=Math.round(it.price);
totalPrice+=it.price;

h+='<div class="sg-item"><span class="sg-n">'+it.name+'</span><span class="sg-a">'+display+'</span><span class="sp">~'+price+' z≈Ç</span></div>';
});

h+='<div class="stot" style="margin-top:10px"><span>SZACOWANY KOSZT:</span><span class="v">~'+Math.round(totalPrice)+' z≈Ç</span></div>';
h+='<div style="margin-top:10px"><button class="btn gr" onclick="sgAddToPantry()">üì¶ Dodaj do spi≈ºarni</button></div>';

// Store generated items for pantry import
window._sgItems=sorted;

document.getElementById('sgResult').innerHTML=h;
vib(HAP.done);toast('Lista gotowa ‚úì');
}

function sgAddToPantry(){
if(!window._sgItems||!window._sgItems.length){toast('Najpierw generuj listƒô',false);return}
let added=0;
window._sgItems.forEach(it=>{
if(it.amt<=0)return;
pantryAdd(it.name,it.amt,it.unit,it.catName,it.catIcon);
added++;
});
save();renPantry();
toast(added+' produkt√≥w ‚Üí spi≈ºarnia ‚úì');vib(HAP.done);
}

async function sgShare(){
const el=document.getElementById('sgResult');
if(!el||!el.textContent.trim()){toast('Najpierw generuj listƒô',false);return}
const items=el.querySelectorAll('.sg-item');
let text='üõí Lista zakup√≥w (Diet Master V7)\n\n';
items.forEach(it=>{
const n=it.querySelector('.sg-n')?.textContent||'';
const a=it.querySelector('.sg-a')?.textContent||'';
const p=it.querySelector('.sp')?.textContent||'';
text+='‚òê '+n+' ‚Äî '+a+(p?' ('+p+')':'')+'\n';
});
const tot=el.querySelector('.stot .v');
if(tot)text+='\nüí∞ '+tot.textContent+'\n';
if(navigator.share){
try{await navigator.share({title:'Lista zakup√≥w',text});toast('Udostƒôpniono ‚úì')}catch(e){}
}else{
navigator.clipboard.writeText(text).then(()=>toast('Skopiowano ‚úì')).catch(()=>{});
}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BARCODE SCANNER (html5-qrcode + Open Food Facts)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let scanner=null;
function scanStart(){
if(!window.Html5Qrcode){toast('≈Åadujƒô skaner...',false);
const s=document.createElement('script');s.src='https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js';
s.onload=()=>scanStart();document.head.appendChild(s);return}
if(scanner)scanStop();
scanner=new Html5Qrcode('scanReader');
scanner.start({facingMode:'environment'},{fps:10,qrbox:{width:250,height:150},
formatsToSupport:[0]}, // EAN_13
code=>{vib(HAP.scan);scanStop();eanLookup(code)},
()=>{}
).then(()=>{
document.getElementById('scanStartBtn').style.display='none';
document.getElementById('scanStopBtn').style.display='';
}).catch(e=>toast('Kamera: '+e,false));
}
function scanStop(){
if(scanner){try{scanner.stop().then(()=>{scanner.clear()}).catch(()=>{})}catch(e){}}
scanner=null;
document.getElementById('scanStartBtn').style.display='';
document.getElementById('scanStopBtn').style.display='none';
}
async function eanLookup(code){
code=code.trim();if(!code||code.length<8){toast('Za kr√≥tki kod',false);return}
document.getElementById('scanResult').innerHTML='<div class="al info">‚è≥ Szukam produktu...</div>';
try{
const r=await fetch(`https://world.openfoodfacts.org/api/v2/product/${code}.json`);
const d=await r.json();
if(d.status===1){
const p=d.product;const n100=p.nutriments||{};
const res={
ean:code,
name:p.product_name||p.product_name_pl||'Nieznany',
brand:p.brands||'',
img:p.image_front_small_url||'',
kcal:Math.round(n100['energy-kcal_100g']||0),
b:+(n100.proteins_100g||0).toFixed(1),
w:+(n100.carbohydrates_100g||0).toFixed(1),
t:+(n100.fat_100g||0).toFixed(1),
fiber:+(n100.fiber_100g||0).toFixed(1),
serving:p.serving_size||'100g',
ts:Date.now()
};
renderScanResult(res);
saveScanHist(res);
}else{
document.getElementById('scanResult').innerHTML='<div class="al warn">‚ùå Produkt nie znaleziony w Open Food Facts</div>';
}
}catch(e){
document.getElementById('scanResult').innerHTML='<div class="al err">‚ùå Brak internetu lub b≈ÇƒÖd API</div>';
}
}
function renderScanResult(r){
document.getElementById('scanResult').innerHTML=`
<div class="scan-result">
${r.img?`<img src="${r.img}" style="width:60px;height:60px;border-radius:8px;float:right;margin-left:8px;object-fit:cover">`:''}
<div class="sr-name">${r.name}</div>
<div class="sr-brand">${r.brand} ¬∑ EAN: ${r.ean}</div>
<div style="font-size:.75em;color:var(--t3)">Warto≈õci na 100g${r.serving!=='100g'?' ¬∑ Porcja: '+r.serving:''}</div>
<div class="scan-macro">
<div class="sm"><div class="v">${r.kcal}</div><div class="l">Kcal</div></div>
<div class="sm"><div class="v" style="color:var(--bl)">${r.b}g</div><div class="l">Bia≈Çko</div></div>
<div class="sm"><div class="v" style="color:var(--yl)">${r.w}g</div><div class="l">Wƒôgle</div></div>
<div class="sm"><div class="v" style="color:var(--pr)">${r.t}g</div><div class="l">T≈Çuszcz</div></div>
</div>
${r.fiber?`<div style="margin-top:6px;font-size:.78em;color:var(--t2)">üå± B≈Çonnik: ${r.fiber}g/100g</div>`:''}
</div>`;
}
function saveScanHist(r){
if(!S.scanHist)S.scanHist=[];
S.scanHist=S.scanHist.filter(x=>x.ean!==r.ean);
S.scanHist.unshift(r);
if(S.scanHist.length>50)S.scanHist=S.scanHist.slice(0,50);
save();renScanHist();
}
function renScanHist(){
if(!S.scanHist||!S.scanHist.length){document.getElementById('scanHist').innerHTML='<div style="color:var(--t3);font-size:.82em;text-align:center">Brak skan√≥w</div>';return}
let h='';S.scanHist.forEach(r=>{
h+=`<div class="scan-hi" onclick="renderScanResult(${JSON.stringify(r).replace(/"/g,'&quot;')})">
<span class="sh-n">${r.name}</span><span class="sh-k">${r.kcal} kcal</span></div>`;
});
document.getElementById('scanHist').innerHTML=h;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PHOTO DIARY (Camera + IndexedDB)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let photoDB=null;
function initPhotoDB(){
return new Promise((res,rej)=>{
const req=indexedDB.open('dmv7photos',1);
req.onupgradeneeded=e=>{const db=e.target.result;if(!db.objectStoreNames.contains('photos'))db.createObjectStore('photos',{keyPath:'id',autoIncrement:true})};
req.onsuccess=e=>{photoDB=e.target.result;res()};
req.onerror=()=>rej();
});
}
function photoTake(){document.getElementById('photoCapture').click()}
function photoProcess(e){
const file=e.target.files[0];if(!file)return;
const reader=new FileReader();
reader.onload=function(ev){
const img=new Image();
img.onload=function(){
const max=800;let w=img.width,h=img.height;
if(w>max){h=h*max/w;w=max}
if(h>max){w=w*max/h;h=max}
const cv=document.createElement('canvas');cv.width=w;cv.height=h;
const ctx=cv.getContext('2d');ctx.drawImage(img,0,0,w,h);
const data=cv.toDataURL('image/jpeg',0.7);
photoStore(data);
};
img.src=ev.target.result;
};
reader.readAsDataURL(file);
e.target.value='';
}
function photoStore(data){
if(!photoDB){toast('DB error',false);return}
const tx=photoDB.transaction('photos','readwrite');
const st=tx.objectStore('photos');
st.add({data,date:new Date().toISOString(),label:''});
tx.oncomplete=()=>{toast('üì∏ Zdjƒôcie zapisane ‚úì');vib(HAP.done);photoRender()};
}
function photoRender(){
if(!photoDB)return;
const tx=photoDB.transaction('photos','readonly');
const st=tx.objectStore('photos');
const req=st.getAll();
req.onsuccess=()=>{
const photos=req.result.reverse();
document.getElementById('photoCount').textContent=photos.length+' zdjƒôƒá';
if(!photos.length){document.getElementById('photoGrid').innerHTML='<div style="color:var(--t3);font-size:.82em;text-align:center;grid-column:1/-1;padding:20px">Brak zdjƒôƒá. Zr√≥b pierwsze!</div>';return}
let h='';photos.forEach(p=>{
const d=new Date(p.date);
const dt=d.toLocaleDateString('pl-PL',{day:'numeric',month:'short'})+' '+d.toLocaleTimeString('pl-PL',{hour:'2-digit',minute:'2-digit'});
h+=`<div class="photo-card"><img src="${p.data}" loading="lazy"><div class="pc-info">${dt}</div><button class="pc-del" onclick="event.stopPropagation();photoDel(${p.id})">‚úï</button></div>`;
});
document.getElementById('photoGrid').innerHTML=h;
};
}
function photoDel(id){
if(!photoDB)return;
const tx=photoDB.transaction('photos','readwrite');
tx.objectStore('photos').delete(id);
tx.oncomplete=()=>{toast('Usuniƒôto');photoRender()};
}
function photoClear(){
if(!confirm('UsunƒÖƒá WSZYSTKIE zdjƒôcia?'))return;
if(!photoDB)return;
const tx=photoDB.transaction('photos','readwrite');
tx.objectStore('photos').clear();
tx.oncomplete=()=>{toast('Zdjƒôcia usuniƒôte');photoRender()};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GEOLOCATION ‚Äî znajd≈∫ sklep
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function findStore(name){
if(!navigator.geolocation){toast('Brak GPS',false);return}
toast('üìç Szukam lokalizacji...');
navigator.geolocation.getCurrentPosition(
pos=>{const{latitude:lat,longitude:lng}=pos.coords;
window.open(`https://www.google.com/maps/search/${encodeURIComponent(name)}/@${lat},${lng},14z`,'_blank')},
err=>{toast('GPS odm√≥wiony: '+err.message,false)},
{enableHighAccuracy:false,timeout:8000}
);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OFFLINE INDICATOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initOffline(){
const bar=document.getElementById('offBar');
function upd(){bar.classList.toggle('on',!navigator.onLine)}
window.addEventListener('online',()=>{upd();toast('üåê Online')});
window.addEventListener('offline',()=>{upd();toast('üì° Offline',false)});
upd();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FULLSCREEN TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let fsInterval=null;
function tmFullscreen(){
const el=document.getElementById('fsTimer');
el.classList.add('on');
try{el.requestFullscreen&&el.requestFullscreen()}catch(e){}
updFsTimer();
if(fsInterval)clearInterval(fsInterval);
fsInterval=setInterval(updFsTimer,250);
}
function fsClose(){
const el=document.getElementById('fsTimer');
el.classList.remove('on');
try{document.exitFullscreen&&document.exitFullscreen()}catch(e){}
if(fsInterval){clearInterval(fsInterval);fsInterval=null}
}
function updFsTimer(){
const m=Math.floor(TM.s/60),s=TM.s%60;
const t=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
document.getElementById('fsTime').textContent=t;
document.getElementById('fsLbl').textContent=document.getElementById('tmLbl').textContent;
document.getElementById('fsTmBtn').textContent=TM.run?'‚è∏Ô∏è Pauza':'‚ñ∂Ô∏è Start';
if(TM.s<=0&&!TM.run&&fsInterval){/* timer done, keep screen */}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHAKE TO ADD WATER (DeviceMotion)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let shakeReady=true;let lastShake=0;
function initShake(){
if(!('DeviceMotionEvent' in window)){
const h=document.getElementById('shakeHint');if(h)h.style.display='none';return}
// iOS 13+ requires permission
if(typeof DeviceMotionEvent.requestPermission==='function'){
document.getElementById('shakeHint').innerHTML='üì≥ <a href="#" onclick="reqShakePerm();return false" style="color:var(--cy)">Kliknij aby w≈ÇƒÖczyƒá shake</a>';
}else{
window.addEventListener('devicemotion',handleShake);
}
}
function reqShakePerm(){
DeviceMotionEvent.requestPermission().then(p=>{
if(p==='granted'){window.addEventListener('devicemotion',handleShake);
document.getElementById('shakeHint').textContent='üì≥ PotrzƒÖ≈õnij telefonem ‚Üí +250ml';toast('Shake w≈ÇƒÖczony ‚úì')}
}).catch(()=>{});
}
function handleShake(e){
const a=e.accelerationIncludingGravity;if(!a)return;
const force=Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z);
const now=Date.now();
if(force>35&&shakeReady&&now-lastShake>2000){
lastShake=now;shakeReady=false;
// Only trigger if water section is visible
const ws=document.getElementById('woda');
if(ws&&ws.classList.contains('on')){watA(250)}
setTimeout(()=>{shakeReady=true},2000);
}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// THEME TOGGLE (dark/light)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleTheme(){
const isLight=document.body.classList.toggle('light');
S.theme=isLight?'light':'dark';save();
document.getElementById('themeBtn').textContent=isLight?'‚òÄÔ∏è':'üåô';
document.querySelector('meta[name="theme-color"]').content=isLight?'#f5f5f5':'#ff6b2b';
toast(isLight?'Tryb jasny':'Tryb ciemny');
}
function loadTheme(){
if(S.theme==='light'){document.body.classList.add('light');
document.getElementById('themeBtn').textContent='‚òÄÔ∏è';
document.querySelector('meta[name="theme-color"]').content='#f5f5f5'}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEB SPEECH ‚Äî czytaj przepis na g≈Ços
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentSpeech=null;
function speakRecipe(text){
if(!('speechSynthesis' in window)){toast('Brak wsparcia mowy',false);return}
if(speechSynthesis.speaking){speechSynthesis.cancel();toast('Zatrzymano');return}
const u=new SpeechSynthesisUtterance(text);
u.lang='pl-PL';u.rate=0.9;u.pitch=1;
const voices=speechSynthesis.getVoices();
const plVoice=voices.find(v=>v.lang.startsWith('pl'));
if(plVoice)u.voice=plVoice;
u.onend=()=>toast('üîä Koniec');
speechSynthesis.speak(u);
toast('üîä Czytam przepis...');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WAKE LOCK API ‚Äî ekran nie ga≈õnie podczas timera
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let wakeLock=null;
async function reqWakeLock(){
try{if('wakeLock' in navigator){wakeLock=await navigator.wakeLock.request('screen');
wakeLock.addEventListener('release',()=>{wakeLock=null})}}catch(e){}}
function relWakeLock(){if(wakeLock){wakeLock.release();wakeLock=null}}
document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible'&&TM.run)reqWakeLock()});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VIBRATION API ‚Äî wibracja przy timerze i meal check
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function vib(pattern){try{if('vibrate' in navigator)navigator.vibrate(pattern)}catch(e){}}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BADGING API ‚Äî licznik niezjedzonych posi≈Çk√≥w na ikonie
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updBadge(){
try{
if(!('setAppBadge' in navigator))return;
const {done,total}=todayMealsDone();
const left=total-done;
if(left>0)navigator.setAppBadge(left);
else navigator.clearAppBadge();
}catch(e){}}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEB SHARE API ‚Äî udostƒôpnij postƒôp
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function shareProgress(){
const wk=getCurWk();const di=getCurDi();const d=WEEKS[wk][di];
const {done,total}=todayMealsDone();
const lastW=S.w.length?S.w[S.w.length-1].w:100;
const lost=Math.max(0,100-lastW).toFixed(1);
const water=(S.water/1000).toFixed(1);

const text=`üî• Diet Master V7 ‚Äî Dzie≈Ñ ${['PON','WTO','≈öRO','CZW','PIƒÑ','SOB','NIE'][di]} (T${wk+1})
‚öñÔ∏è Waga: ${lastW} kg (${lost} kg stracone)
üçΩÔ∏è Posi≈Çki: ${done}/${total}
üíß Woda: ${water}L / 5L
üìä Cel: ${d.kcal} kcal | ${d.b}g bia≈Çka
üí™ Cel wagowy: 82 kg (zosta≈Ço ${Math.max(0,lastW-82).toFixed(1)} kg)`;

if(navigator.share){
try{await navigator.share({title:'Diet Master V7 ‚Äî Postƒôp',text});toast('Udostƒôpniono ‚úì')}
catch(e){if(e.name!=='AbortError')fallbackCopy(text)}}
else fallbackCopy(text);
}
function fallbackCopy(text){
navigator.clipboard.writeText(text).then(()=>toast('Skopiowano do schowka ‚úì')).catch(()=>toast('Brak wsparcia',false));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA EXPORT / IMPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function dataExport(){
const data=JSON.stringify(S,null,2);
const blob=new Blob([data],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
const dt=new Date().toISOString().split('T')[0];
a.download=`diet-master-v7-backup-${dt}.json`;
a.click();URL.revokeObjectURL(url);
toast('Backup pobrany ‚úì');
}
function dataImport(e){
const file=e.target.files[0];if(!file)return;
const reader=new FileReader();
reader.onload=function(ev){
try{
const data=JSON.parse(ev.target.result);
if(!confirm('‚ö†Ô∏è Na pewno nadpisaƒá dane? Stracisz obecne.'))return;
S=data;save();
init();toast('Dane zaimportowane ‚úì');
}catch(err){toast('B≈ÇƒÖd pliku JSON',false)}
};reader.readAsText(file);
e.target.value='';
}
function dataClear(){
if(!confirm('‚ö†Ô∏è USUNƒÑƒÜ WSZYSTKIE DANE? Tej operacji nie cofniesz!'))return;
if(!confirm('Na pewno? Waga, woda, suplementy ‚Äî wszystko zniknie.'))return;
localStorage.removeItem(LS);S={};load();save();
init();toast('Dane usuniƒôte');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PERSISTENT STORAGE ‚Äî popro≈õ o trwa≈Çy storage
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function reqPersist(){
if(!navigator.storage||!navigator.storage.persist){
document.getElementById('persistSt').textContent='Brak wsparcia';return}
const ok=await navigator.storage.persist();
document.getElementById('persistSt').textContent=ok?'‚úÖ Trwa≈Çy ‚Äî dane nie zostanƒÖ usuniƒôte':'‚ùå Odm√≥wiono';
toast(ok?'Storage trwa≈Çy ‚úì':'Odm√≥wiono',ok);
}
async function checkPersist(){
if(!navigator.storage||!navigator.storage.persisted)return;
const p=await navigator.storage.persisted();
const el=document.getElementById('persistSt');
if(el)el.textContent=p?'‚úÖ Trwa≈Çy':'‚ö†Ô∏è Nietrwa≈Çy ‚Äî dane mogƒÖ zniknƒÖƒá';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PWA STATUS ‚Äî poka≈º co dzia≈Ça
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updPwaStatus(){
const el=document.getElementById('pwaStatus');if(!el)return;
const standalone=window.matchMedia('(display-mode: standalone)').matches||navigator.standalone;
const sw='serviceWorker' in navigator;
const notif='Notification' in window;
const share='share' in navigator;
const badge='setAppBadge' in navigator;
const wake='wakeLock' in navigator;
const vibr='vibrate' in navigator;
const persist=navigator.storage&&navigator.storage.persist;
const cam=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia);
const geo='geolocation' in navigator;
const speech='speechSynthesis' in window;
const motion='DeviceMotionEvent' in window;
const idb='indexedDB' in window;
const fscr=document.documentElement.requestFullscreen||document.documentElement.webkitRequestFullscreen;
function ck(ok,name){var col=ok?"var(--gr)":"var(--rd)";var ico=ok?"‚úÖ":"‚ùå";return "<span style='color:"+col+"'>"+ico+" "+name+"</span>"}
el.innerHTML=[
ck(standalone,'Tryb standalone'),
ck(sw,'Service Worker (offline)'),
ck(notif,'Powiadomienia'),
ck(share,'Web Share API'),
ck(badge,'Badging API (ikona)'),
ck(wake,'Wake Lock (timer)'),
ck(vibr,'Wibracja'),
ck(persist,'Persistent Storage'),
ck(cam,'Kamera (skaner/zdjƒôcia)'),
ck(geo,'Geolokalizacja (sklepy)'),
ck(speech,'Web Speech (czytanie)'),
ck(motion,'DeviceMotion (shake)'),
ck(idb,'IndexedDB (zdjƒôcia)'),
ck(fscr,'Fullscreen API (timer)')
].join('<br>');
}

let deferredPrompt=null;
function initPWA(){
if('serviceWorker' in navigator){
navigator.serviceWorker.register('./sw.js').catch(e=>console.log('SW fail:',e));
// Listen for updates from SW
navigator.serviceWorker.addEventListener('message',e=>{
if(e.data.type==='UPDATE_READY')toast('üîÑ Nowa wersja! Od≈õwie≈º.');
if(e.data.type==='UPDATE_BADGE')updBadge();
});
}
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;
document.getElementById('pwaBar').style.display='flex';});
// Handle shortcuts via hash
if(location.hash){const sec=location.hash.slice(1);if(document.getElementById(sec))setTimeout(()=>go(sec),100);}
// Handle shared text
const params=new URLSearchParams(location.search);
const shared=params.get('shared_text');
if(shared)setTimeout(()=>{toast('Otrzymano: '+shared.slice(0,30));},500);
// Periodic sync for badge
if('serviceWorker' in navigator){
navigator.serviceWorker.ready.then(reg=>{
if(reg.periodicSync)reg.periodicSync.register('update-badge',{minInterval:3600000}).catch(()=>{});
}).catch(()=>{});
}
}
function pwaInstall(){
if(deferredPrompt){deferredPrompt.prompt();
deferredPrompt.userChoice.then(r=>{document.getElementById('pwaBar').style.display='none';deferredPrompt=null;
if(r.outcome==='accepted')toast('Zainstalowano! üì±');});}
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MEAL OVERRIDE LAYER SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DAILY_TARGETS={kcal:2000,b:260,w:150,t:30};

function getMealData(wk,di,mi){
if(!S.mealOverrides)S.mealOverrides={};
const orig=WEEKS[wk]&&WEEKS[wk][di]&&WEEKS[wk][di].meals[mi];
if(!orig)return{time:'?',name:'?',kcal:0,b:0,w:0,t:0,ing:'',recipe:'',cls:''};
const pk='p-w'+wk+'-d'+di+'-m'+mi;
const tk='t-'+mealKey(0)+'-w'+wk+'-d'+di+'-m'+mi;
const ovr=S.mealOverrides[tk]||S.mealOverrides[pk];
if(ovr)return Object.assign({},orig,ovr);
return orig;
}

function hasMealOverride(wk,di,mi){
if(!S.mealOverrides)return false;
const pk='p-w'+wk+'-d'+di+'-m'+mi;
const tk='t-'+mealKey(0)+'-w'+wk+'-d'+di+'-m'+mi;
return !!(S.mealOverrides[tk]||S.mealOverrides[pk]);
}

function mealRevert(wk,di,mi){
const pk='p-w'+wk+'-d'+di+'-m'+mi;
const tk='t-'+mealKey(0)+'-w'+wk+'-d'+di+'-m'+mi;
delete S.mealOverrides[pk];delete S.mealOverrides[tk];
save();renPlan();updDash();toast('Przywr\u00f3cono orygina\u0142 \u2713');vib(HAP.done);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRODUCT MACRO DATABASE (Polish built-in)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PROD_DB={
'pier\u015b kurczaka':{kcal:165,b:31,w:0,t:3.6},
'serca kurczaka':{kcal:185,b:26,w:1,t:9},
'w\u0105tr\u00f3bka drobiowa':{kcal:119,b:17,w:1,t:5},
'jajko':{kcal:155,b:13,w:1.1,t:11},
'bia\u0142ko jaja':{kcal:52,b:11,w:0.7,t:0.2},
'twar\u00f3g 0%':{kcal:72,b:13,w:4,t:0.3},
'ry\u017c bia\u0142y':{kcal:350,b:7,w:78,t:0.6},
'ry\u017c basmati':{kcal:348,b:7.5,w:77,t:0.8},
'kasza gryczana':{kcal:343,b:13,w:72,t:2.6},
'kasza jaglana':{kcal:348,b:11,w:73,t:3.3},
'makaron':{kcal:348,b:12,w:72,t:1.5},
'spaghetti':{kcal:348,b:12,w:72,t:1.5},
'bulgur':{kcal:342,b:12,w:76,t:1.3},
'kuskus':{kcal:376,b:13,w:77,t:0.6},
'p\u0142atki owsiane':{kcal:379,b:13,w:67,t:7},
'ziemniaki':{kcal:77,b:2,w:17,t:0.1},
'broku\u0142y':{kcal:34,b:2.8,w:7,t:0.4},
'szpinak':{kcal:23,b:2.9,w:3.6,t:0.4},
'mix warzywny':{kcal:45,b:2,w:8,t:0.5},
'marchewka':{kcal:41,b:0.9,w:10,t:0.2},
'cebula':{kcal:40,b:1.1,w:9,t:0.1},
'og\u00f3rek':{kcal:15,b:0.7,w:3.6,t:0.1},
'sa\u0142ata lodowa':{kcal:14,b:0.9,w:3,t:0.1},
'groszek':{kcal:81,b:5,w:14,t:0.4},
'fasolka szparagowa':{kcal:31,b:1.8,w:7,t:0.1},
'kalafior':{kcal:25,b:2,w:5,t:0.3},
'cukinia':{kcal:17,b:1.2,w:3.1,t:0.3},
'pomidory':{kcal:18,b:0.9,w:3.9,t:0.2},
'passata':{kcal:24,b:1.2,w:4,t:0.1},
'pieczarki':{kcal:22,b:3.1,w:3.3,t:0.3},
'banan':{kcal:89,b:1.1,w:23,t:0.3},
'owoce le\u015bne':{kcal:44,b:1,w:10,t:0.3},
'mleko 0.5%':{kcal:35,b:3.4,w:5,t:0.5},
'olej rzepakowy':{kcal:884,b:0,w:0,t:100},
'mi\u00f3d':{kcal:304,b:0.3,w:82,t:0},
'sos sojowy':{kcal:53,b:8,w:5,t:0},
'\u015bmietana 12%':{kcal:136,b:2.8,w:4,t:12},
'jogurt 0%':{kcal:54,b:10,w:4,t:0.2},
'chia':{kcal:486,b:17,w:42,t:31},
'glicyna':{kcal:400,b:100,w:0,t:0},
};

function getProductMacro(name){
const n=dePolish(name.toLowerCase().replace(/mro≈ºon[yaei]/gi,'').replace(/surow[yaei]/gi,'').replace(/gotowan[yaei]/gi,'').replace(/mielon[yaei]/gi,'').trim());
for(const [k,v] of Object.entries(PROD_DB)){
const dk=dePolish(k);
if(n.includes(dk)||dk.includes(n.substring(0,4))||n.includes(dk.substring(0,4)))return v;
}
if(S.customProducts){
for(const cp of S.customProducts){
if(dePolish(cp.name.toLowerCase()).includes(n.substring(0,4))||n.includes(dePolish(cp.name.toLowerCase()).substring(0,4)))return{kcal:cp.kcal,b:cp.b,w:cp.w,t:cp.t};
}
}
return null;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MEAL EDITOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _edCtx=null;

function ingFactor(ing){
const amt=ing.amt;const u=ing.unit;
if(u==='g')return amt/100;
if(u==='kg')return amt*10;
if(u==='ml')return amt/100;
if(u==='szt'){
const n=dePolish(ing.name.toLowerCase());
if(n.includes('jaj')||n.includes('biale'))return amt*0.6;
if(n.includes('banan'))return amt*1.2;
return amt;
}
return amt/100;
}

function calcEditorTotals(){
if(!_edCtx)return{kcal:0,b:0,w:0,t:0};
let kcal=0,b=0,w=0,t=0;
_edCtx.ings.forEach(function(ing){
const f=ingFactor(ing);
kcal+=ing.kcal100*f;b+=ing.b100*f;w+=ing.w100*f;t+=ing.t100*f;
});
return{kcal:Math.round(kcal),b:Math.round(b),w:Math.round(w),t:Math.round(t)};
}

function balClass(val,type){
var max50={kcal:1000,b:130,w:75,t:15};
var max70={kcal:1400,b:182,w:105,t:21};
if(val>max70[type])return 'warn-rd';
if(val>max50[type])return 'warn-or';
return '';
}

function balanceWarnings(mt,wk,di,mi){
var w=[];
var d=WEEKS[wk]&&WEEKS[wk][di];
if(!d)return w;
var dk=0,db=0,dw=0,dt=0;
d.meals.forEach(function(_,mmi){
if(mmi===mi){dk+=mt.kcal;db+=mt.b;dw+=mt.w;dt+=mt.t}
else{var e=getMealData(wk,di,mmi);dk+=e.kcal;db+=e.b;dw+=e.w;dt+=e.t}
});
if(mt.b>130)w.push({lvl:mt.b>182?'rd':'or',msg:'\u26a0\ufe0f Du\u017co bia\u0142ka w jednym posi\u0142ku: '+mt.b+'g (cel: 260g/dzie\u0144)'});
if(mt.kcal>1200)w.push({lvl:'rd',msg:'\u26a0\ufe0f Wysoka kaloryczno\u015b\u0107: '+mt.kcal+' kcal'});
if(mt.t>20)w.push({lvl:mt.t>25?'rd':'or',msg:'\u26a0\ufe0f Wysoki t\u0142uszcz: '+mt.t+'g (cel: ~30g/dzie\u0144)'});
if(dk>2200)w.push({lvl:'rd',msg:'\ud83d\udcca Dzie\u0144 przekroczy '+dk+' kcal (cel: ~2000)'});
else if(dk<1500&&dk>0)w.push({lvl:'or',msg:'\ud83d\udcca Dzie\u0144 niski: '+dk+' kcal'});
if(db>300)w.push({lvl:'or',msg:'\ud83d\udcca Bia\u0142ko dzienne: '+db+'g (cel: ~260g)'});
if(!w.length)w.push({lvl:'ok',msg:'\u2705 Zbilansowane. Dzie\u0144: '+dk+' kcal / '+db+'g B / '+dw+'g W / '+dt+'g T'});
return w;
}

function getSubstituteSuggestions(edIngs){
pantryInit();
var subs=[];
if(!S.pantry.length)return subs;
edIngs.forEach(function(ing,idx){
var match=findPantryMatch(ing.name);
var hasEnough=match&&match.amt>0;
if(hasEnough)return;
var ingMacro=getProductMacro(ing.name);
if(!ingMacro)return;
var ingDom=ingMacro.b>ingMacro.w?(ingMacro.b>ingMacro.t?'b':'t'):(ingMacro.w>ingMacro.t?'w':'t');
S.pantry.forEach(function(p){
if(p.amt<=0)return;
var pMacro=getProductMacro(p.name);
if(!pMacro)return;
var pDom=pMacro.b>pMacro.w?(pMacro.b>pMacro.t?'b':'t'):(pMacro.w>pMacro.t?'w':'t');
if(ingDom===pDom&&dePolish(p.name.toLowerCase())!==dePolish(ing.name.toLowerCase())){
subs.push({ingIdx:idx,ingName:ing.name,name:p.name,kcal100:pMacro.kcal,b100:pMacro.b,w100:pMacro.w,t100:pMacro.t,reason:'masz '+fmtAmt(p.amt,p.unit)});
}
});
});
var seen={};
return subs.filter(function(s){var k=s.ingIdx+'-'+s.name;if(seen[k])return false;seen[k]=true;return true}).slice(0,5);
}

function mealEdit(wk,di,mi){
var meal=getMealData(wk,di,mi);
var ings=parseMealIngs(meal.ing);
var edIngs=ings.map(function(ing){
var macro=getProductMacro(ing.name);
return{name:ing.name,amt:ing.amt,unit:ing.unit,kcal100:macro?macro.kcal:0,b100:macro?macro.b:0,w100:macro?macro.w:0,t100:macro?macro.t:0,hasMacro:!!macro};
});
_edCtx={wk:wk,di:di,mi:mi,ings:edIngs,origName:meal.name,origTime:meal.time||'',origCls:meal.cls||'',origRecipe:meal.recipe||''};
renderMealEditor();
}

function renderMealEditor(){
if(!_edCtx)return;
pantryInit();
var h='<h3>\u270f\ufe0f Edytuj: '+_edCtx.origName+'</h3>';
h+='<div class="ig" style="margin:8px 0"><label>Nazwa</label><input type="text" id="edName" value="'+_edCtx.origName.replace(/"/g,'&quot;')+'"></div>';
h+='<div style="font-size:.78em;color:var(--t3);margin-bottom:4px;font-weight:600">SK\u0141ADNIKI:</div>';
_edCtx.ings.forEach(function(ing,i){
var pantryStatus='';
var match=findPantryMatch(ing.name);
if(match){
var need=convertToPantryUnit(ing.amt,ing.unit,match.unit)||ing.amt;
if(match.amt>=need)pantryStatus='<span style="color:var(--gr);font-size:.7em"> \u2713 '+fmtAmt(match.amt,match.unit)+'</span>';
else pantryStatus='<span style="color:var(--rd);font-size:.7em"> \u26a0 '+fmtAmt(match.amt,match.unit)+'/'+fmtAmt(Math.round(need*100)/100,match.unit)+'</span>';
}else if(S.pantry&&S.pantry.length){
pantryStatus='<span style="color:var(--t3);font-size:.65em"> (brak w spiz.)</span>';
}
h+='<div class="meal-ed-ing"><span style="font-size:.82em">'+ing.name+(ing.hasMacro?'':'<span style="color:var(--rd);font-size:.7em"> ?</span>')+pantryStatus+'</span>';
h+='<input type="number" value="'+ing.amt+'" step="1" onchange="edIngAmt('+i+',this.value)">';
h+='<span style="color:var(--t3);font-size:.78em">'+ing.unit+'</span>';
h+='<button class="pi-btn" onclick="edIngRemove('+i+')" style="color:var(--rd)">\u2715</button></div>';
});
h+='<div style="display:flex;gap:4px;margin-top:6px;flex-wrap:wrap">';
h+='<button class="btn sm out" onclick="edIngAddFromPlan()" style="font-size:.72em">\ud83d\udccb Z planu</button>';
h+='<button class="btn sm out" onclick="edIngAddFromSearch()" style="font-size:.72em">\ud83d\udd0d Szukaj</button>';
h+='<button class="btn sm out" onclick="edIngAddCustom()" style="font-size:.72em">\u270f\ufe0f R\u0119cznie</button>';
h+='<button class="btn sm out" onclick="edIngAddFromPantry()" style="font-size:.72em">\ud83d\udce6 Ze spiz.</button></div>';
var tot=calcEditorTotals();
h+='<div class="basket-total" style="margin-top:10px">';
h+='<div class="bt '+balClass(tot.kcal,'kcal')+'"><div class="v">'+tot.kcal+'</div><div class="l">Kcal</div></div>';
h+='<div class="bt '+balClass(tot.b,'b')+'"><div class="v">'+tot.b+'g</div><div class="l">Bia\u0142ko</div></div>';
h+='<div class="bt '+balClass(tot.w,'w')+'"><div class="v">'+tot.w+'g</div><div class="l">W\u0119gle</div></div>';
h+='<div class="bt '+balClass(tot.t,'t')+'"><div class="v">'+tot.t+'g</div><div class="l">T\u0142uszcz</div></div></div>';
var warns=balanceWarnings(tot,_edCtx.wk,_edCtx.di,_edCtx.mi);
if(warns.length){h+='<div style="margin-top:6px">';warns.forEach(function(w){h+='<div class="bal-warn '+w.lvl+'">'+w.msg+'</div>'});h+='</div>';}
// Pantry summary
var pantryIssues=0;
_edCtx.ings.forEach(function(ing){
var m2=findPantryMatch(ing.name);
if(m2){var need=convertToPantryUnit(ing.amt,ing.unit,m2.unit)||ing.amt;if(m2.amt<need)pantryIssues++;}
});
if(pantryIssues>0){
h+='<div class="bal-warn or" style="margin-top:4px">\ud83d\udce6 '+pantryIssues+' sk\u0142adnik'+(pantryIssues>1?'i':'')+' brakuje w spi\u017carni</div>';
}
var subs=getSubstituteSuggestions(_edCtx.ings);
if(subs.length){
h+='<div style="margin-top:8px;font-size:.78em;color:var(--t3);font-weight:600">\ud83d\udca1 Zamienniki (masz w spi\u017carni):</div><div class="sub-list">';
subs.forEach(function(s){
h+='<div class="sub-item" onclick="edSubstitute('+s.ingIdx+',\''+s.name.replace(/'/g,"\\'")+'\''+','+s.kcal100+','+s.b100+','+s.w100+','+s.t100+')"><span style="color:var(--gr)">\u21c4</span><span style="flex:1">'+s.ingName+' \u2192 <strong>'+s.name+'</strong></span><span style="font-size:.75em;color:var(--t3)">'+s.reason+'</span></div>';
});
h+='</div>';
}
h+='<div class="ig" style="margin-top:8px"><label>Przepis</label><input type="text" id="edRecipe" value="'+(_edCtx.origRecipe||'').replace(/"/g,'&quot;')+'"></div>';
h+='<div class="mbtns" style="margin-top:10px">';
h+='<button class="btn" onclick="edSave(false)">\ud83d\udcbe Jednorazowo</button>';
h+='<button class="btn gr" onclick="edSave(true)">\ud83d\udccc Na sta\u0142e</button>';
h+='<button class="btn out" onclick="modalClose();_edCtx=null">Anuluj</button></div>';
modalOpen(h);
}

function edIngAmt(i,val){if(!_edCtx)return;_edCtx.ings[i].amt=parseFloat(val)||0;if(_edCtx._dbMode)renderMealEditorForBuilder();else renderMealEditor();}
function edIngRemove(i){if(!_edCtx)return;_edCtx.ings.splice(i,1);if(_edCtx._dbMode)renderMealEditorForBuilder();else renderMealEditor();}

function edSubstitute(idx,name,kcal,b,w,t){
if(!_edCtx||!_edCtx.ings[idx])return;
_edCtx.ings[idx].name=name;_edCtx.ings[idx].kcal100=kcal;_edCtx.ings[idx].b100=b;
_edCtx.ings[idx].w100=w;_edCtx.ings[idx].t100=t;_edCtx.ings[idx].hasMacro=true;
renderMealEditor();toast('Zamieniono na '+name);
}

function edIngAddFromPlan(){
var prods=Object.keys(PROD_DB).concat((S.customProducts||[]).map(function(p){return p.name}));
var opts='';prods.forEach(function(p){opts+='<option value="'+p+'">'+p+'</option>'});
modalOpen('<h3>\ud83d\udccb Dodaj sk\u0142adnik</h3><div class="mbody">'+
'<div class="ig"><label>Produkt</label><select id="edProdSel">'+opts+'</select></div>'+
'<div class="fr"><div class="ig"><label>Ilo\u015b\u0107</label><input type="number" id="edProdAmt" value="100" step="10"></div>'+
'<div class="ig"><label>Jednostka</label><select id="edProdUnit"><option value="g">g</option><option value="ml">ml</option><option value="szt">szt</option></select></div></div>'+
'</div><div class="mbtns"><button class="btn" onclick="edIngAddConfirm()">\u2705 Dodaj</button><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>');
}

function edIngAddConfirm(){
var name=document.getElementById('edProdSel').value;
var amt=parseFloat(document.getElementById('edProdAmt').value)||100;
var unit=document.getElementById('edProdUnit').value;
var macro=getProductMacro(name);
_edCtx.ings.push({name:name,amt:amt,unit:unit,kcal100:macro?macro.kcal:0,b100:macro?macro.b:0,w100:macro?macro.w:0,t100:macro?macro.t:0,hasMacro:!!macro});
if(_edCtx&&_edCtx._dbMode)renderMealEditorForBuilder();else renderMealEditor();
}

function edIngAddFromSearch(){
modalOpen('<h3>\ud83d\udd0d Szukaj produktu</h3><div class="mbody">'+
'<div class="calc-search"><input type="text" id="edSearchQ" placeholder="Nazwa..." onkeydown="if(event.key===\'Enter\')edSearchRun()">'+
'<button class="btn sm" onclick="edSearchRun()">\ud83d\udd0d</button></div>'+
'<div id="edSearchRes" class="calc-results"></div>'+
'</div><div class="mbtns"><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>');
}

async function edSearchRun(){
var q=document.getElementById('edSearchQ').value.trim();
if(!q){toast('Wpisz nazw\u0119',false);return}
document.getElementById('edSearchRes').innerHTML='<div class="al info">\u23f3 Szukam...</div>';
try{
var r=await fetch('https://world.openfoodfacts.org/cgi/search.pl?search_terms='+encodeURIComponent(q)+'&json=1&page_size=10&fields=product_name,brands,nutriments,code');
var d=await r.json();
if(d.products&&d.products.length){
var h='';d.products.forEach(function(p){
var n=p.nutriments||{};
var kcal=Math.round(n['energy-kcal_100g']||0);
var b=+(n.proteins_100g||0).toFixed(1);
var w=+(n.carbohydrates_100g||0).toFixed(1);
var t=+(n.fat_100g||0).toFixed(1);
var nm=(p.product_name||'?').substring(0,40);
h+='<div class="calc-prod" onclick="edSearchAdd(\''+nm.replace(/'/g,"\\\'")+'\','+kcal+','+b+','+w+','+t+')"><span class="cp-name">'+nm+'</span><span class="cp-macro">'+kcal+'/'+b+'B/'+w+'W/'+t+'T</span></div>';
});
document.getElementById('edSearchRes').innerHTML=h;
}else{document.getElementById('edSearchRes').innerHTML='<div class="al warn">Brak wynik\u00f3w</div>';}
}catch(e){document.getElementById('edSearchRes').innerHTML='<div class="al err">B\u0142\u0105d API</div>';}
}

function edSearchAdd(name,kcal,b,w,t){
modalOpen('<h3>Dodaj: '+name+'</h3><div class="mbody">'+
'<div style="font-size:.82em;color:var(--t3);margin-bottom:6px">Per 100g: '+kcal+'/'+b+'B/'+w+'W/'+t+'T</div>'+
'<div class="fr"><div class="ig"><label>Ilo\u015b\u0107</label><input type="number" id="edSrchAmt" value="100" step="10"></div>'+
'<div class="ig"><label>Jedn.</label><select id="edSrchUnit"><option value="g">g</option><option value="ml">ml</option></select></div></div>'+
'<div style="margin-top:6px"><label style="font-size:.78em;color:var(--t3)"><input type="checkbox" id="edSrchSave"> Zapisz do w\u0142asnych</label></div>'+
'</div><div class="mbtns"><button class="btn" onclick="edSearchAddC(\''+name.replace(/'/g,"\\'")+'\''+','+kcal+','+b+','+w+','+t+')">\u2705 Dodaj</button><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>');
}

function edSearchAddC(name,kcal,b,w,t){
var amt=parseFloat(document.getElementById('edSrchAmt').value)||100;
var unit=document.getElementById('edSrchUnit').value;
if(document.getElementById('edSrchSave').checked)calcSaveCustomProduct(name,kcal,b,w,t);
_edCtx.ings.push({name:name,amt:amt,unit:unit,kcal100:kcal,b100:b,w100:w,t100:t,hasMacro:true});
if(_edCtx&&_edCtx._dbMode)renderMealEditorForBuilder();else renderMealEditor();
}

function edIngAddCustom(){
modalOpen('<h3>\u270f\ufe0f Dodaj r\u0119cznie</h3><div class="mbody">'+
'<div class="ig"><label>Nazwa</label><input type="text" id="edManName" placeholder="np. tofu"></div>'+
'<div class="fr"><div class="ig"><label>Ilo\u015b\u0107</label><input type="number" id="edManAmt" value="100" step="10"></div>'+
'<div class="ig"><label>Jedn.</label><select id="edManUnit"><option value="g">g</option><option value="ml">ml</option><option value="szt">szt</option></select></div></div>'+
'<div style="margin-top:6px;font-size:.78em;color:var(--t3);font-weight:600">Makro per 100g:</div>'+
'<div class="fr"><div class="ig"><label>Kcal</label><input type="number" id="edManKcal" step="1"></div>'+
'<div class="ig"><label>B</label><input type="number" id="edManB" step="0.1"></div>'+
'<div class="ig"><label>W</label><input type="number" id="edManW" step="0.1"></div>'+
'<div class="ig"><label>T</label><input type="number" id="edManT" step="0.1"></div></div>'+
'<div style="margin-top:6px"><label style="font-size:.78em;color:var(--t3)"><input type="checkbox" id="edManSave" checked> Zapisz do w\u0142asnych</label></div>'+
'</div><div class="mbtns"><button class="btn" onclick="edManAddC()">\u2705 Dodaj</button><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>');
}

function edManAddC(){
var name=document.getElementById('edManName').value.trim();
var amt=parseFloat(document.getElementById('edManAmt').value)||100;
var unit=document.getElementById('edManUnit').value;
var kcal=parseFloat(document.getElementById('edManKcal').value)||0;
var b=parseFloat(document.getElementById('edManB').value)||0;
var w=parseFloat(document.getElementById('edManW').value)||0;
var t=parseFloat(document.getElementById('edManT').value)||0;
if(!name){toast('Wpisz nazw\u0119',false);return}
if(document.getElementById('edManSave').checked)calcSaveCustomProduct(name,kcal,b,w,t);
_edCtx.ings.push({name:name,amt:amt,unit:unit,kcal100:kcal,b100:b,w100:w,t100:t,hasMacro:true});
if(_edCtx&&_edCtx._dbMode)renderMealEditorForBuilder();else renderMealEditor();
}

// Add ingredient from pantry stock
function edIngAddFromPantry(){
pantryInit();
if(!S.pantry||!S.pantry.length){modalOpen('<h3>\ud83d\udce6 Spi\u017carnia pusta</h3><div class="mbody"><p style="color:var(--t3)">Dodaj produkty do spi\u017carni przez zakupy.</p></div><div class="mbtns"><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>');return}
var h='<h3>\ud83d\udce6 Ze spi\u017carni</h3><div class="mbody" style="max-height:50vh;overflow-y:auto">';
S.pantry.filter(function(p){return p.amt>0}).forEach(function(p){
var macro=getProductMacro(p.name);
var macroStr=macro?(macro.kcal+'/'+macro.b+'B/'+macro.w+'W/'+macro.t+'T'):'?';
h+='<div class="calc-prod" onclick="edPantryAdd(\''+p.name.replace(/'/g,"\\'")+'\',\''+p.unit+'\')"><span class="cp-name">'+p.name+' <span style="color:var(--gr);font-size:.75em">('+fmtAmt(p.amt,p.unit)+')</span></span><span class="cp-macro">'+macroStr+'</span></div>';
});
h+='</div><div class="mbtns"><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>';
modalOpen(h);
}

function edPantryAdd(name,pUnit){
var macro=getProductMacro(name);
var defUnit=(pUnit==='kg'||pUnit==='g')?'g':(pUnit==='L'||pUnit==='ml')?'ml':'szt';
modalOpen('<h3>Dodaj: '+name+'</h3><div class="mbody">'+
'<div style="font-size:.82em;color:var(--t3);margin-bottom:6px">Per 100g: '+(macro?macro.kcal+'/'+macro.b+'B/'+macro.w+'W/'+macro.t+'T':'brak danych')+'</div>'+
'<div class="fr"><div class="ig"><label>Ilo\u015b\u0107</label><input type="number" id="edPtAmt" value="100" step="10"></div>'+
'<div class="ig"><label>Jedn.</label><select id="edPtUnit"><option value="g" '+(defUnit==='g'?'selected':'')+'>g</option><option value="ml" '+(defUnit==='ml'?'selected':'')+'>ml</option><option value="szt" '+(defUnit==='szt'?'selected':'')+'>szt</option></select></div></div>'+
'</div><div class="mbtns"><button class="btn" onclick="edPantryAddC(\''+name.replace(/'/g,"\\'")+'\')">\u2705 Dodaj</button><button class="btn out" onclick="_edCtx&&_edCtx._dbMode?renderMealEditorForBuilder():renderMealEditor()">Wr\u00f3\u0107</button></div>');
}

function edPantryAddC(name){
var amt=parseFloat(document.getElementById('edPtAmt').value)||100;
var unit=document.getElementById('edPtUnit').value;
var macro=getProductMacro(name);
_edCtx.ings.push({name:name,amt:amt,unit:unit,kcal100:macro?macro.kcal:0,b100:macro?macro.b:0,w100:macro?macro.w:0,t100:macro?macro.t:0,hasMacro:!!macro});
if(_edCtx&&_edCtx._dbMode)renderMealEditorForBuilder();else renderMealEditor();
}

function edSave(permanent){
if(!_edCtx)return;
var name=(document.getElementById('edName')||{}).value||_edCtx.origName;
var recipe=(document.getElementById('edRecipe')||{}).value||'';
var tot=calcEditorTotals();
var ingStr=_edCtx.ings.map(function(i){return i.amt+i.unit+' '+i.name}).join(' \u00b7 ');
var ovr={name:name,ing:ingStr,recipe:recipe,kcal:tot.kcal,b:tot.b,w:tot.w,t:tot.t};
var key=permanent?'p-w'+_edCtx.wk+'-d'+_edCtx.di+'-m'+_edCtx.mi:'t-'+mealKey(0)+'-w'+_edCtx.wk+'-d'+_edCtx.di+'-m'+_edCtx.mi;
S.mealOverrides[key]=ovr;
// Auto-sync: save unknown ingredients to customProducts + add to pantry MAP knowledge
var newProds=[];
_edCtx.ings.forEach(function(ing){
if(ing.hasMacro&&!getProductMacro(ing.name)){
calcSaveCustomProduct(ing.name,ing.kcal100,ing.b100,ing.w100,ing.t100);
newProds.push(ing.name);
}
});
save();modalClose();_edCtx=null;renPlan();updDash();renPantry();
if(newProds.length){
toast(permanent?'Zapisano na sta\u0142e + '+newProds.length+' nowych produkt\u00f3w \u2713':'Zapisano + '+newProds.length+' nowych \u2713');
}else{
toast(permanent?'Zapisano na sta\u0142e \u2713':'Zapisano na dzi\u015b \u2713');
}
vib(HAP.done);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DAY BUILDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _dbSlots=[null,null,null,null];
const DB_TIMES=['04:00','10:00','16:00','19:00'];
const DB_LABELS=['Posi≈Çek 1 (shake)','Posi≈Çek 2 (elektrolity)','Posi≈Çek 3 (obiad)','Posi≈Çek 4 (kolacja)'];

function dayBuilder(){
_dbSlots=[null,null,null,null];
renderDayBuilder();
}

function renderDayBuilder(){
var dayTot={kcal:0,b:0,w:0,t:0};
_dbSlots.forEach(function(s){if(s){dayTot.kcal+=s.kcal;dayTot.b+=s.b;dayTot.w+=s.w;dayTot.t+=s.t}});

var h='<h3>\ud83c\udfd7\ufe0f Zbuduj dzie≈Ñ</h3>';
h+='<div style="font-size:.78em;color:var(--t3);margin-bottom:8px">Zbuduj w\u0142asny jad≈Çospis na wybrany dzie\u0144.</div>';

_dbSlots.forEach(function(slot,i){
h+='<div style="background:var(--bg4);border:1px solid var(--brd);border-radius:8px;padding:10px;margin-bottom:8px'+(slot?';border-left:3px solid var(--gr)':'')+'">';
h+='<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px"><strong style="font-size:.85em">'+DB_TIMES[i]+' ‚Äî '+DB_LABELS[i]+'</strong></div>';
if(slot){
h+='<div style="font-size:.82em;color:var(--t1)">'+slot.name+'</div>';
h+='<div style="font-size:.75em;color:var(--t3);margin-top:2px">'+slot.kcal+' kcal | '+slot.b+'g B | '+slot.w+'g W | '+slot.t+'g T</div>';
h+='<div style="display:flex;gap:4px;margin-top:4px">';
h+='<button class="btn sm out" onclick="dbEditSlot('+i+')" style="font-size:.7em">\u270f\ufe0f Edytuj</button>';
h+='<button class="btn sm out" onclick="dbClearSlot('+i+')" style="font-size:.7em;color:var(--rd)">\u2715</button>';
h+='</div>';
}else{
h+='<div style="display:flex;gap:4px;flex-wrap:wrap">';
h+='<button class="btn sm out" onclick="dbFromTemplate('+i+')" style="font-size:.72em">\ud83d\udccb Szablon</button>';
h+='<button class="btn sm out" onclick="dbFromScratch('+i+')" style="font-size:.72em">\u270f\ufe0f Od zera</button>';
h+='</div>';
}
h+='</div>';
});

// Day totals
h+='<div class="basket-total" style="margin-top:8px">';
h+='<div class="bt '+balClass(dayTot.kcal,'kcal')+'"><div class="v">'+dayTot.kcal+'</div><div class="l">Kcal</div></div>';
h+='<div class="bt '+balClass(dayTot.b,'b')+'"><div class="v">'+dayTot.b+'g</div><div class="l">B</div></div>';
h+='<div class="bt '+balClass(dayTot.w,'w')+'"><div class="v">'+dayTot.w+'g</div><div class="l">W</div></div>';
h+='<div class="bt '+balClass(dayTot.t,'t')+'"><div class="v">'+dayTot.t+'g</div><div class="l">T</div></div></div>';

// Day balance warnings
var dw=[];
if(dayTot.kcal>2200)dw.push({lvl:'rd',msg:'\u26a0\ufe0f Dzie\u0144 przekroczy '+dayTot.kcal+' kcal (cel: ~2000)'});
else if(dayTot.kcal>0&&dayTot.kcal<1500)dw.push({lvl:'or',msg:'\u26a0\ufe0f Dzie\u0144 niski: '+dayTot.kcal+' kcal'});
if(dayTot.b>300)dw.push({lvl:'or',msg:'\ud83d\udcca Bia\u0142ko dzienne: '+dayTot.b+'g (cel: ~260g)'});
else if(dayTot.b>0&&dayTot.b<200)dw.push({lvl:'or',msg:'\ud83d\udcca Bia\u0142ko niskie: '+dayTot.b+'g'});
if(dayTot.kcal>0&&!dw.length)dw.push({lvl:'ok',msg:'\u2705 Zbilansowane!'});
if(dw.length){h+='<div style="margin-top:4px">';dw.forEach(function(w){h+='<div class="bal-warn '+w.lvl+'">'+w.msg+'</div>'});h+='</div>';}

// Save controls
h+='<div style="margin-top:10px;font-size:.82em;color:var(--t3)">Zapisz do:</div>';
h+='<div class="fr" style="margin-top:4px"><div class="ig"><label>Tydzie≈Ñ</label><select id="dbWk"><option value="0">T1</option><option value="1">T2</option><option value="2">T3</option><option value="3">T4</option></select></div>';
h+='<div class="ig"><label>Dzie\u0144</label><select id="dbDi"><option value="0">PON</option><option value="1">WTO</option><option value="2">\u015aRO</option><option value="3">CZW</option><option value="4">PI\u0104</option><option value="5">SOB</option><option value="6">NIE</option></select></div></div>';

h+='<div class="mbtns" style="margin-top:10px">';
h+='<button class="btn" onclick="dbSave(false)">\ud83d\udcbe Jednorazowo</button>';
h+='<button class="btn gr" onclick="dbSave(true)">\ud83d\udccc Na sta\u0142e</button>';
h+='<button class="btn out" onclick="modalClose()">Anuluj</button></div>';

modalOpen(h);
// Set defaults to current wk/day
var sel1=document.getElementById('dbWk');var sel2=document.getElementById('dbDi');
if(sel1)sel1.value=S.wk;if(sel2)sel2.value=S.day;
}

function dbClearSlot(i){_dbSlots[i]=null;renderDayBuilder();}

function dbFromTemplate(slotIdx){
// Show all meals across all weeks that fit this time slot
var h='<h3>\ud83d\udccb Wybierz szablon</h3><div class="mbody" style="max-height:55vh;overflow-y:auto">';
WEEKS.forEach(function(wk,wi){
wk.forEach(function(day,di){
var meal=getMealData(wi,di,slotIdx);
if(!meal||meal.name==='?')return;
h+='<div class="calc-prod" onclick="dbSetSlotFromMeal('+slotIdx+','+wi+','+di+','+slotIdx+')">';
h+='<span class="cp-name">T'+(wi+1)+' '+day.n+': '+meal.name+'</span>';
h+='<span class="cp-macro">'+meal.kcal+'/'+meal.b+'B/'+meal.w+'W/'+meal.t+'T</span></div>';
});
});
h+='</div><div class="mbtns"><button class="btn out" onclick="renderDayBuilder()">Wr\u00f3\u0107</button></div>';
modalOpen(h);
}

function dbSetSlotFromMeal(slotIdx,wi,di,mi){
var meal=getMealData(wi,di,mi);
_dbSlots[slotIdx]={name:meal.name,ing:meal.ing,recipe:meal.recipe||'',kcal:meal.kcal,b:meal.b,w:meal.w,t:meal.t,time:DB_TIMES[slotIdx]};
renderDayBuilder();
}

function dbFromScratch(slotIdx){
// Open mini-builder: add ingredients from plan/search/pantry
_edCtx={wk:S.wk,di:S.day,mi:slotIdx,ings:[],origName:DB_LABELS[slotIdx],origTime:DB_TIMES[slotIdx],origCls:'',origRecipe:'',
_dbMode:true,_dbSlotIdx:slotIdx};
renderMealEditorForBuilder();
}

function renderMealEditorForBuilder(){
if(!_edCtx)return;
var h='<h3>\u270f\ufe0f Buduj: '+DB_LABELS[_edCtx._dbSlotIdx]+'</h3>';
h+='<div class="ig" style="margin:6px 0"><label>Nazwa</label><input type="text" id="edName" value="'+_edCtx.origName.replace(/"/g,'&quot;')+'"></div>';
h+='<div style="font-size:.78em;color:var(--t3);margin-bottom:4px;font-weight:600">SK\u0141ADNIKI:</div>';
_edCtx.ings.forEach(function(ing,i){
h+='<div class="meal-ed-ing"><span style="font-size:.82em">'+ing.name+'</span>';
h+='<input type="number" value="'+ing.amt+'" step="1" onchange="edIngAmt('+i+',this.value)">';
h+='<span style="color:var(--t3);font-size:.78em">'+ing.unit+'</span>';
h+='<button class="pi-btn" onclick="edIngRemove('+i+')" style="color:var(--rd)">\u2715</button></div>';
});
h+='<div style="display:flex;gap:4px;margin-top:6px;flex-wrap:wrap">';
h+='<button class="btn sm out" onclick="edIngAddFromPlan();window._dbReturnFn=\'renderMealEditorForBuilder\'" style="font-size:.72em">\ud83d\udccb Plan</button>';
h+='<button class="btn sm out" onclick="edIngAddFromSearch();window._dbReturnFn=\'renderMealEditorForBuilder\'" style="font-size:.72em">\ud83d\udd0d Szukaj</button>';
h+='<button class="btn sm out" onclick="edIngAddFromPantry();window._dbReturnFn=\'renderMealEditorForBuilder\'" style="font-size:.72em">\ud83d\udce6 Spiz.</button></div>';
var tot=calcEditorTotals();
h+='<div class="basket-total" style="margin-top:8px">';
h+='<div class="bt '+balClass(tot.kcal,'kcal')+'"><div class="v">'+tot.kcal+'</div><div class="l">Kcal</div></div>';
h+='<div class="bt '+balClass(tot.b,'b')+'"><div class="v">'+tot.b+'g</div><div class="l">B</div></div>';
h+='<div class="bt '+balClass(tot.w,'w')+'"><div class="v">'+tot.w+'g</div><div class="l">W</div></div>';
h+='<div class="bt '+balClass(tot.t,'t')+'"><div class="v">'+tot.t+'g</div><div class="l">T</div></div></div>';
h+='<div class="ig" style="margin-top:6px"><label>Przepis</label><input type="text" id="edRecipe" value="'+(_edCtx.origRecipe||'').replace(/"/g,'&quot;')+'"></div>';
h+='<div class="mbtns" style="margin-top:8px">';
h+='<button class="btn" onclick="dbSaveSlotFromEditor()">\u2705 Gotowe</button>';
h+='<button class="btn out" onclick="_edCtx=null;renderDayBuilder()">Anuluj</button></div>';
modalOpen(h);
}

function dbSaveSlotFromEditor(){
if(!_edCtx)return;
var idx=_edCtx._dbSlotIdx;
var name=(document.getElementById('edName')||{}).value||_edCtx.origName;
var recipe=(document.getElementById('edRecipe')||{}).value||'';
var tot=calcEditorTotals();
var ingStr=_edCtx.ings.map(function(i){return i.amt+i.unit+' '+i.name}).join(' \u00b7 ');
// Save unknown products
_edCtx.ings.forEach(function(ing){
if(ing.hasMacro&&!getProductMacro(ing.name))calcSaveCustomProduct(ing.name,ing.kcal100,ing.b100,ing.w100,ing.t100);
});
_dbSlots[idx]={name:name,ing:ingStr,recipe:recipe,kcal:tot.kcal,b:tot.b,w:tot.w,t:tot.t,time:DB_TIMES[idx]};
_edCtx=null;
renderDayBuilder();
}

function dbEditSlot(i){
var slot=_dbSlots[i];
if(!slot)return;
var ings=parseMealIngs(slot.ing);
var edIngs=ings.map(function(ing){
var macro=getProductMacro(ing.name);
return{name:ing.name,amt:ing.amt,unit:ing.unit,kcal100:macro?macro.kcal:0,b100:macro?macro.b:0,w100:macro?macro.w:0,t100:macro?macro.t:0,hasMacro:!!macro};
});
_edCtx={wk:S.wk,di:S.day,mi:i,ings:edIngs,origName:slot.name,origTime:DB_TIMES[i],origCls:'',origRecipe:slot.recipe||'',
_dbMode:true,_dbSlotIdx:i};
renderMealEditorForBuilder();
}

function dbSave(permanent){
var wk=parseInt((document.getElementById('dbWk')||{}).value)||0;
var di=parseInt((document.getElementById('dbDi')||{}).value)||0;
var filled=_dbSlots.filter(function(s){return s!==null});
if(!filled.length){toast('Dodaj min. 1 posi\u0142ek',false);return}
_dbSlots.forEach(function(slot,mi){
if(!slot)return;
var key=permanent?'p-w'+wk+'-d'+di+'-m'+mi:'t-'+mealKey(0)+'-w'+wk+'-d'+di+'-m'+mi;
S.mealOverrides[key]={name:slot.name,ing:slot.ing,recipe:slot.recipe||'',kcal:slot.kcal,b:slot.b,w:slot.w,t:slot.t};
});
save();modalClose();_dbSlots=[null,null,null,null];
renPlan();updDash();
toast(permanent?'Dzie\u0144 zapisany na sta\u0142e \u2713':'Dzie\u0144 zapisany jednorazowo \u2713');
vib(HAP.done);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KALKULATOR MAKRO (standalone section)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var _calcTab='api';
var _calcBasket=[];

function calcTab(t){
_calcTab=t;
['api','plan','custom','hist'].forEach(function(x){
var el=document.getElementById('calcTab'+x.charAt(0).toUpperCase()+x.slice(1));
if(el)el.className='tab'+(x===t?' on':'');
});
var addBox=document.getElementById('calcAddCustom');
if(addBox)addBox.style.display=t==='custom'?'block':'none';
if(t==='plan')renderCalcPlan();
else if(t==='custom')renderCalcCustom();
else if(t==='hist')renderCalcHist();
else document.getElementById('calcResults').innerHTML='<div style="color:var(--t3);font-size:.82em;text-align:center;padding:10px">Wpisz nazw\u0119 i kliknij \ud83d\udd0d</div>';
}

async function calcSearch(){
var q=document.getElementById('calcQ').value.trim();
if(!q){toast('Wpisz nazw\u0119',false);return}
if(_calcTab!=='api'){_calcTab='api';calcTab('api')}
document.getElementById('calcResults').innerHTML='<div class="al info">\u23f3 Szukam online...</div>';
try{
var r=await fetch('https://world.openfoodfacts.org/cgi/search.pl?search_terms='+encodeURIComponent(q)+'&json=1&page_size=15&fields=product_name,brands,nutriments,code,image_front_small_url');
var d=await r.json();
if(d.products&&d.products.length){
var h='';d.products.forEach(function(p){
var n=p.nutriments||{};
var kcal=Math.round(n['energy-kcal_100g']||0);
var b=+(n.proteins_100g||0).toFixed(1);
var w=+(n.carbohydrates_100g||0).toFixed(1);
var t=+(n.fat_100g||0).toFixed(1);
var nm=(p.product_name||'?').substring(0,45);
var brand=p.brands||'';
var img=p.image_front_small_url||'';
h+='<div class="calc-prod" onclick="calcAddToBasket(\''+nm.replace(/'/g,"\\'")+'\''+','+kcal+','+b+','+w+','+t+')">';
if(img)h+='<img src="'+img+'">';
h+='<div><span class="cp-name">'+nm+'</span>'+(brand?'<div style="font-size:.7em;color:var(--t3)">'+brand+'</div>':'')+'</div>';
h+='<span class="cp-macro">'+kcal+'/'+b+'B/'+w+'W/'+t+'T</span></div>';
});
document.getElementById('calcResults').innerHTML=h;
}else{document.getElementById('calcResults').innerHTML='<div class="al warn">Brak wynik\u00f3w</div>';}
}catch(e){document.getElementById('calcResults').innerHTML='<div class="al err">B\u0142\u0105d API</div>';}
}

function calcScanEan(){go('scan');toast('Zeskanuj kod, potem wr\u00f3\u0107 do kalkulatora');}

function renderCalcPlan(){
var h='';Object.entries(PROD_DB).forEach(function(e){
var name=e[0],m=e[1];
h+='<div class="calc-prod" onclick="calcAddToBasket(\''+name.replace(/'/g,"\\'")+'\''+','+m.kcal+','+m.b+','+m.w+','+m.t+')"><span class="cp-name">'+name+'</span><span class="cp-macro">'+m.kcal+'/'+m.b+'B/'+m.w+'W/'+m.t+'T</span></div>';
});
(S.customProducts||[]).forEach(function(cp){
h+='<div class="calc-prod" onclick="calcAddToBasket(\''+cp.name.replace(/'/g,"\\'")+'\''+','+cp.kcal+','+cp.b+','+cp.w+','+cp.t+')"><span class="cp-name">'+cp.name+' <span style="color:var(--cy);font-size:.7em">\u2605</span></span><span class="cp-macro">'+cp.kcal+'/'+cp.b+'B/'+cp.w+'W/'+cp.t+'T</span></div>';
});
document.getElementById('calcResults').innerHTML=h||'<div style="color:var(--t3);text-align:center;padding:10px">Brak</div>';
}

function renderCalcCustom(){
var el=document.getElementById('customProdList');
if(!el)return;
if(!S.customProducts||!S.customProducts.length){el.innerHTML='<div style="color:var(--t3);font-size:.82em;text-align:center;padding:10px">Brak w\u0142asnych produkt\u00f3w.</div>';document.getElementById('calcResults').innerHTML=el.innerHTML;return;}
var h='';S.customProducts.forEach(function(cp,i){
h+='<div class="calc-prod"><span class="cp-name">'+cp.name+'</span><span class="cp-macro">'+cp.kcal+'/'+cp.b+'B/'+cp.w+'W/'+cp.t+'T</span><button class="pi-btn" onclick="calcDelCustomProduct('+i+')" style="color:var(--rd)">\u2715</button></div>';
});
el.innerHTML=h;document.getElementById('calcResults').innerHTML=h;
}

function renderCalcHist(){
if(!S.scanHist||!S.scanHist.length){document.getElementById('calcResults').innerHTML='<div style="color:var(--t3);text-align:center;padding:10px">Brak historii</div>';return;}
var h='';S.scanHist.forEach(function(r){
h+='<div class="calc-prod" onclick="calcAddToBasket(\''+((r.name||'').replace(/'/g,"\\'"))+'\''+','+r.kcal+','+r.b+','+r.w+','+r.t+')"><span class="cp-name">'+r.name+'</span><span class="cp-macro">'+r.kcal+'/'+r.b+'B/'+r.w+'W/'+r.t+'T</span></div>';
});
document.getElementById('calcResults').innerHTML=h;
}

function calcAddToBasket(name,kcal,b,w,t){
modalOpen('<h3>Dodaj: '+name+'</h3><div class="mbody">'+
'<div style="font-size:.82em;color:var(--t3);margin-bottom:8px">Per 100g: '+kcal+' kcal | '+b+'g B | '+w+'g W | '+t+'g T</div>'+
'<div class="fr"><div class="ig"><label>Ilo\u015b\u0107</label><input type="number" id="cbAmt" value="100" step="10"></div>'+
'<div class="ig"><label>Jedn.</label><select id="cbUnit"><option value="g">g</option><option value="ml">ml</option><option value="szt">szt</option></select></div></div>'+
'</div><div class="mbtns"><button class="btn" onclick="calcBasketC(\''+name.replace(/'/g,"\\'")+'\''+','+kcal+','+b+','+w+','+t+')">\u2705 Dodaj</button><button class="btn out" onclick="modalClose()">Anuluj</button></div>');
}

function calcBasketC(name,kcal100,b100,w100,t100){
var amt=parseFloat(document.getElementById('cbAmt').value)||100;
var unit=document.getElementById('cbUnit').value;
_calcBasket.push({name:name,amt:amt,unit:unit,kcal100:kcal100,b100:b100,w100:w100,t100:t100});
modalClose();renderCalcBasket();toast(name+' dodane \u2713');
}

function renderCalcBasket(){
var el=document.getElementById('calcBasket');
var cntEl=document.getElementById('calcBasketCount');
if(!el)return;
if(!_calcBasket.length){
el.innerHTML='<div style="color:var(--t3);font-size:.82em;text-align:center;padding:10px">Dodaj produkty</div>';
if(cntEl)cntEl.textContent='(0)';
document.getElementById('calcTotals').innerHTML='';
document.getElementById('calcBalWarn').innerHTML='';
return;
}
if(cntEl)cntEl.textContent='('+_calcBasket.length+')';
var h='',totK=0,totB=0,totW=0,totT=0;
_calcBasket.forEach(function(item,i){
var f=item.unit==='g'?item.amt/100:item.unit==='ml'?item.amt/100:item.amt;
var k=Math.round(item.kcal100*f);var b=Math.round(item.b100*f*10)/10;var w=Math.round(item.w100*f*10)/10;var t=Math.round(item.t100*f*10)/10;
totK+=k;totB+=b;totW+=w;totT+=t;
h+='<div class="basket-item"><span class="bi-n">'+item.name+'</span><span class="bi-a">'+item.amt+item.unit+'</span><span class="bi-m">'+k+'/'+Math.round(b)+'B/'+Math.round(w)+'W</span><button class="pi-btn" onclick="calcBasketRemove('+i+')" style="color:var(--rd)">\u2715</button></div>';
});
el.innerHTML=h;
document.getElementById('calcTotals').innerHTML='<div class="bt '+balClass(totK,'kcal')+'"><div class="v">'+Math.round(totK)+'</div><div class="l">Kcal</div></div><div class="bt '+balClass(Math.round(totB),'b')+'"><div class="v">'+Math.round(totB)+'g</div><div class="l">Bia\u0142ko</div></div><div class="bt '+balClass(Math.round(totW),'w')+'"><div class="v">'+Math.round(totW)+'g</div><div class="l">W\u0119gle</div></div><div class="bt '+balClass(Math.round(totT),'t')+'"><div class="v">'+Math.round(totT)+'g</div><div class="l">T\u0142uszcz</div></div>';
var warns=[];
if(totB>130)warns.push({lvl:totB>182?'rd':'or',msg:'\u26a0\ufe0f Du\u017co bia\u0142ka: '+Math.round(totB)+'g'});
if(totK>1200)warns.push({lvl:'rd',msg:'\u26a0\ufe0f Wysoka kaloryczno\u015b\u0107: '+Math.round(totK)+' kcal'});
if(!warns.length)warns.push({lvl:'ok',msg:'\u2705 Zbilansowane'});
var wh='';warns.forEach(function(w){wh+='<div class="bal-warn '+w.lvl+'">'+w.msg+'</div>'});
document.getElementById('calcBalWarn').innerHTML=wh;
}

function calcBasketRemove(i){_calcBasket.splice(i,1);renderCalcBasket();}
function calcClearBasket(){_calcBasket=[];renderCalcBasket();toast('Koszyk wyczyszczony');}

function calcSaveAsMeal(){
if(!_calcBasket.length){toast('Koszyk pusty',false);return}
modalOpen('<h3>\ud83d\udcbe Zapisz jako danie</h3><div class="mbody">'+
'<div class="ig"><label>Nazwa</label><input type="text" id="csMealName" placeholder="np. M\u00f3j lunch"></div>'+
'<div class="ig"><label>Kt\u00f3ry posi\u0142ek?</label><select id="csMealSlot"><option value="0">Posi\u0142ek 1 (04:00)</option><option value="1">Posi\u0142ek 2 (10:00)</option><option value="2">Posi\u0142ek 3 (16:00)</option><option value="3">Posi\u0142ek 4 (19:00)</option></select></div>'+
'<div class="ig"><label>Typ</label><select id="csSaveType"><option value="temp">Jednorazowo</option><option value="perm">Na sta\u0142e</option></select></div>'+
'</div><div class="mbtns"><button class="btn" onclick="calcSaveMealC()">\ud83d\udcbe Zapisz</button><button class="btn out" onclick="modalClose()">Anuluj</button></div>');
}

function calcSaveMealC(){
var name=document.getElementById('csMealName').value.trim()||'W\u0142asny posi\u0142ek';
var mi=parseInt(document.getElementById('csMealSlot').value);
var perm=document.getElementById('csSaveType').value==='perm';
var wk=getCurWk();var di=getCurDi();
var totK=0,totB=0,totW=0,totT=0;var parts=[];
_calcBasket.forEach(function(item){
var f=item.unit==='g'?item.amt/100:item.unit==='ml'?item.amt/100:item.amt;
totK+=Math.round(item.kcal100*f);totB+=Math.round(item.b100*f);totW+=Math.round(item.w100*f);totT+=Math.round(item.t100*f);
parts.push(item.amt+item.unit+' '+item.name);
// Auto-save unknown products
if(!getProductMacro(item.name))calcSaveCustomProduct(item.name,item.kcal100,item.b100,item.w100,item.t100);
});
var key=perm?'p-w'+wk+'-d'+di+'-m'+mi:'t-'+mealKey(0)+'-w'+wk+'-d'+di+'-m'+mi;
S.mealOverrides[key]={name:name,ing:parts.join(' \u00b7 '),kcal:totK,b:totB,w:totW,t:totT,recipe:''};
save();modalClose();_calcBasket=[];renderCalcBasket();renPlan();updDash();renPantry();
toast('Zapisano \u2713');vib(HAP.done);
}

function calcShowAddCustom(){
document.getElementById('calcAddCustom').style.display='block';calcTab('custom');
}
function calcAddCustomProduct(){
var name=document.getElementById('cpName').value.trim();
var kcal=parseFloat(document.getElementById('cpKcal').value)||0;
var b=parseFloat(document.getElementById('cpB').value)||0;
var w=parseFloat(document.getElementById('cpW').value)||0;
var t=parseFloat(document.getElementById('cpT').value)||0;
if(!name){toast('Wpisz nazw\u0119',false);return}
calcSaveCustomProduct(name,kcal,b,w,t);
['cpName','cpKcal','cpB','cpW','cpT'].forEach(function(id){var el=document.getElementById(id);if(el)el.value=''});
renderCalcCustom();toast(name+' dodany \u2713');
}
function calcSaveCustomProduct(name,kcal,b,w,t){
if(!S.customProducts)S.customProducts=[];
var idx=S.customProducts.findIndex(function(p){return dePolish(p.name.toLowerCase())===dePolish(name.toLowerCase())});
if(idx>=0){S.customProducts[idx]={name:name,kcal:kcal,b:b,w:w,t:t}}
else{S.customProducts.push({name:name,kcal:kcal,b:b,w:w,t:t})}
// Also ensure pantry can find this product: if not in pantry yet, don't auto-add but make it available
save();
}
function calcDelCustomProduct(i){S.customProducts.splice(i,1);save();renderCalcCustom();toast('Usuni\u0119to');}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const NOTIF_TIMES=[
{h:4,m:0,msg:'ü•§ Czas na shake! Wsta≈Ñ i wstrzƒÖ≈õnij.'},
{h:9,m:50,msg:'üíß Za 10 min elektrolity! Przygotuj shaker.'},
{h:15,m:45,msg:'üçó Czas gotowaƒá obiad! Sprawd≈∫ plan.'},
{h:21,m:0,msg:'üåô MSM + Glicyna shot. Przygotuj na noc.'},
{h:22,m:0,msg:'üò¥ Melatonina + PROZMA+. Dobranoc!'}
];
function notifReq(){
if(!('Notification' in window)){toast('Brak wsparcia',false);return}
Notification.requestPermission().then(p=>{
if(p==='granted'){S.notifOn=true;save();document.getElementById('notifBar').style.display='none';toast('Powiadomienia w≈ÇƒÖczone üîî');startNotifCheck();}
else{toast('Odm√≥wiono',false)}
});
}
function notifDismiss(){S.notifDismissed=true;save();document.getElementById('notifBar').style.display='none'}
function startNotifCheck(){
if(!S.notifOn)return;
setInterval(()=>{
const now=new Date();const h=now.getHours(),m=now.getMinutes();
const key='notif-'+now.toDateString()+'-'+h+'-'+m;
if(S.notifSent&&S.notifSent[key])return;
NOTIF_TIMES.forEach(nt=>{
if(h===nt.h&&m===nt.m){
try{new Notification('Diet Master V7',{body:nt.msg,icon:'üî•',tag:'dm-'+nt.h})}catch(e){}
if(!S.notifSent)S.notifSent={};S.notifSent[key]=true;save();
}});
},30000); // check every 30s
}
function initNotif(){
if(S.notifOn&&Notification.permission==='granted'){
document.getElementById('notifBar').style.display='none';
startNotifCheck();
}else if(!S.notifDismissed&&'Notification' in window){
document.getElementById('notifBar').style.display='flex';
}else{
document.getElementById('notifBar').style.display='none';
}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init(){
load();
if(!S.mealChk)S.mealChk={};
if(!S.notifSent)S.notifSent={};
if(!S.scanHist)S.scanHist=[];
document.getElementById('dIn').value=new Date().toISOString().split('T')[0];
loadTheme();initPWA();initNotif();initOffline();initShake();awUpdate();
updDash();renPlan();renShop();renWaga();renWat();renSupp();renPsmf();renPrep();updCompliance();renScanHist();sgInit();renPantry();renderCalcCustom();
updBadge();checkPersist();updPwaStatus();
initPhotoDB().then(()=>photoRender()).catch(()=>{});
}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
